!function(a){a.fn.ajaxProxy=function(b){var c=this;if("IFRAME"!==this.get(0).tagName)throw"You can only apply ajaxProxy on an iframe";var d=a.extend({},a.fn.ajaxProxy.defaults,b),e={},f=this.attr("src").match(/^https?\:\/\/([^\/?#]+)/i)[0],g=d.uid?d.uid:0,h=/^https?:\/\//i,i=/^get|post$/i;window.addEventListener("message",function(b){var c=JSON.parse(b.data);if(b.origin!=f||!e[c.uid])return void(d.log&&(b.origin!=f?console.log("Received message from wrong origin : "+b.origin!=f):console.log('Received message for an already processed ajax query. Uid is "'+c.uid+'".')));d.log&&console.log('Received message for uid "'+c.uid+'"');var g=e[c.uid].complete,h=e[c.uid].userType;"timeout"!==c.message&&"error"!==c.message||(d.log&&console.log("The request has timedout or was in error."),g(c.code,c.message,c.response,c.allResponseHeaders));var i=c.code,j=c.message,k={text:c.response};try{if("html"===h||/text\/html/i.test(c.contentType))k.html=c.response;else if("json"===h||"text"!==h&&/\/json/i.test(c.contentType))try{k.json=a.parseJSON(c.response)}catch(b){i=500,j="parseerror"}else if("xml"===h||"text"!==h&&/\/xml/i.test(c.contentType)){var l=new ActiveXObject("Microsoft.XMLDOM");l.async=!1;try{l.loadXML(c.response)}catch(b){l=void 0}if(!l||!l.documentElement||l.getElementsByTagName("parsererror").length)throw i=500,j="parseerror","Invalid XML: "+c.response;k.xml=l}}catch(m){throw m}finally{d.log&&console.log("The request has been completed."),g(i,j,k,c.allResponseHeaders),delete e[c.uid]}},!1),a.ajaxTransport("* text html xml json",function(b,f,j){if(d.log&&console.log("Transporting."),b.async&&i.test(b.type)&&h.test(b.url))return g+=1,d.log&&console.log('UID reserved is "'+g+'".'),{send:function(h,i){d.log&&console.log('Sending ajax requesting via proxy. Uid is "'+g+'".');var j="",k=null,l=(f.dataType||"").toLowerCase();if(e[g]={complete:i,userType:l},f.data&&(j="string"===a.type(f.data)?f.data:a.param(f.data)),/^\d+$/.test(f.timeout)&&(k=f.timeout),c.get(0).contentWindow.postMessage(JSON.stringify({uid:g,action:"send",type:b.type,url:b.url,timeout:k,data:j}),c.attr("src")),d.retryCount){var m=0;!function n(){setTimeout(function(){m===d.retryCount?(console.warn("AJAX query could not be processed by proxy after `"+m+"` tries... aborting !"),delete e[g],c.get(0).contentWindow.postMessage(JSON.stringify({uid:g,action:"abort"}),c.attr("src"))):e[g]&&(c.get(0).contentWindow.postMessage(JSON.stringify({uid:g,action:"send",type:b.type,url:b.url,timeout:k,data:j}),c.attr("src")),n())},1e3)}()}},abort:function(){d.log&&console.log("The request was aborted by jquery. Uid is "+g+'".'),c.get(0).contentWindow.postMessage(JSON.stringify({uid:g,action:"abort"}),c.attr("src")),delete e[g]}}})},a.fn.ajaxProxy.defaults={uid:0,retryCount:5,log:!1}}(jQuery);
//# sourceMappingURL=proxy-client.min.js.map