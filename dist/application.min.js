function View(){this._view="",this._id=!1,this._uri_params={},this._controls={},this._redrawn=!1}function EditView(){this._can_save=!0,this._modified=!1,this._soft_modified=!1,this._wasClosing=!1,this.validation_rules={},this.validation_conditions={}}var app={view_fetching:!1,debug:!1,sendErrors:!1,sendErrorsOnUnload:!1,silent:!1,trace_retirement:!1,_errors:[],ajaxQueryLoading:!1,pingInterval:!1,messages:!1,JS_PATH:"/",IMG_PATH:"/",VIRTUALPATH:"/",SESSION_KEY:!1,hash:!1,_resume_hash:"",_observerInterval:0,_history:[],userName:"",cpanelUserName:"",userVersion:0,menus:!1,views:!1,default_view:"",default_goal_death:"",default_goal_disability:"",fna_expiration:365,currentView:!1,_view_cache:{},_loadingDelay:3e3,_loadingTimeout:0,_view_objects:{},_messages:{},emailRegex:new RegExp("^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.(?:[a-zA-Z]{2}|com|org|net|gov|mil|biz|info|mobi|name|aero|jobs|museum)$"),_visualization_ready:!1,init:function(){var t=this;window.console&&window.console.firebug||(window.console?window.console.debug||(window.console.debug=function(info){window.console.log(info)}):window.console={log:function(){},debug:function(){}}),$(document).ajaxStart(function(){t.ajaxQueryLoading=!0}),$(document).ajaxStop(function(){t.ajaxQueryLoading=!1}),this.pingInterval&&setInterval(function(){t.ajaxQueryLoading||t.get("CPanel/View","ping","",function(){console.debug("session is still alive")},!1,function(){console.debug("got an error while doing a ping ?")})},this.pingInterval),this._iPad="iPad"==navigator.userAgent.match(/iPad/),this._iPod="iPod"==navigator.userAgent.match(/iPod/),this._iPhone="iPhone"==navigator.userAgent.match(/iPhone/),this._blackberry="BlackBerry"==navigator.userAgent.match("/BlackBerry/")&&$.browser.webkit,this._palm_pre="webOS"==navigator.userAgent.match("/webOS/")&&$.browser.webkit,this._mobile=this._iPad||this._iPod||this._iPhone||this._blackberry||this._palm_pre,this._webkit=$.browser.webkit,this._opera=$.browser.opera,this._msie=$.browser.msie,this._mozilla=$.browser.mozilla;var t=this;window.onerror=function(description,page,line){return t._onError(description,page,line)},window.onbeforeunload=function(){return t._beforeUnload()},this.sprintf=this._sprintfWrapper.init,Date.prototype.getDayOfYear=function(){var onejan=new Date(this.getFullYear(),0,1);return Math.ceil((this-onejan)/864e5)},Date.prototype.getDaysInYear=function(){var firstdate=new Date(this.getFullYear(),0,1),lastdate=new Date(this.getFullYear(),11,31);return Math.ceil((lastdate-firstdate)/864e5+1)},$("<div></div>").ajaxSend(function(e,xhr){xhr&&"undefined"!=typeof xhr&&"function"==typeof xhr.setRequestHeader&&xhr.setRequestHeader("X-Kronos-Ajax",1)}).ajaxError(function(e,xhr){return $.app.validateXHR(xhr)?void 0:!1}),jQuery.fn.extend({alternateText:function(value,alternate_value){return this.text(value&&""!=value?value:alternate_value),this},numberText:function(value){var text=t.formatNumber(value);return this.text(""==text?"0":text),this},moneyText:function(value){return this.text(t.formatMoney(value)),this},dateText:function(value){return this.text(t.date.format(value)),this},durationVal:function(months_duration){if(isFinite(months_duration)){var sign=0>months_duration?"-":"",years=Math.floor(Math.abs(months_duration)/12),months=Math.abs(months_duration)-12*years;text=sign+(0==years?"":(1==years?$.app._("YEARD").replace("%{years}",years):$.app._("YEARSD").replace("%{years}",years))+" ")+(0==months?"":1==months?$.app._("MONTHD").replace("%{months}",months):$.app._("MONTHSD").replace("%{months}",months))}else var text="";return this.val(text),this},booleanText:function(value){return value="YES"==value?$.app._("YES"):"NO"==value?$.app._("NO"):"-",this.text(value),this},dateVal:function(value){return this.val(t.date.format(value,"input")),this},safeClick:function(fn){return this.click(function(eventObject){if(this.__clicked)$.app.debug&&console.debug("catched double click");else{this.__clicked=!0,fn.call(this,eventObject);var t=this;setTimeout(function(){t.__clicked=!1},500)}}),this},numberVal:function(value,opts){if(arguments.length>0)return $(this).val(t.formatNumber(value,opts));var val=$.app.parseFloat(this.val());return $(this).hasClass("positive")&&$(this).hasClass("number")&&0>val?0:val},number:function(opts){return $(this).each(function(){$(this).addClass("number"),$(this).val($.app.formatNumber($(this).val(),opts)),$(this).blur(function(){$(this).val($.app.formatNumber($(this).val(),opts))})})},moneyVal:function(value,opts){if(arguments.length>0)return $(this).hasClass("money")?($(this).data("val",$.app.parseFloat(value.replace("$",""))),$(this).val(t.formatMoney(value,opts))):$(this).val(t.formatMoney(value,opts));if($(this).hasClass("money")){var val=$(this).data("val");return $(this).hasClass("positive")&&0>val?0:val}return $.app.parseFloat($(this).val().replace("$",""))},money:function(opts){return $(this).each(function(){var $t=$(this);$t.addClass("money"),$t.focus(function(){return console.debug($(this).data("val")),$(this).val($(this).data("val")),console.debug($(this).val()),this}),$(this).click(function(){$(this).select()}),$(this).blur(function(){var value=$(this).val();if(opts&&opts.canBeNull&&(""===value||null===value))var val="";else val=$.app.parseFloat(value.replace("$","")),opts&&opts.true_precision&&(val=opts.rounded?Math.round(val*Math.pow(10,opts.true_precision))/Math.pow(10,opts.true_precision):Math.floor(val*Math.pow(10,opts.true_precision))/Math.pow(10,opts.true_precision));return $(this).data("val",val),$(this).val($.app.formatMoney(val,opts)),this}),""!=$t.val()&&$t.blur()})},percentVal:function(value,opts){if(arguments.length>0)return $(this).val(t.formatPercent(value,opts));var val=$.app.parseFloat(this.val().replace("%",""));return $(this).hasClass("positive")&&$(this).hasClass("percent")&&0>val?0:val},percent:function(opts){return $(this).each(function(){$(this).addClass("percent"),$(this).val($.app.formatPercent($(this).val(),opts)),$(this).blur(function(){$(this).val($.app.formatPercent($(this).val(),opts))})})},SIN:function(){return $(this).each(function(){$(this).val($.app.formatSIN($(this).val())),$(this).blur(function(){$(this).val($.app.formatSIN($(this).val()))})})},datepickerInput:function(interval){return $(this).each(function(){var $this=$(this),$calendar_button=$this.next(".btn.calendar");if(0==$this.next(".btn.calendar").length&&($calendar_button=$('<a href="javascript:void(0);" class="btn calendar" tabindex=-1><span class="icon"></span></a>')),$this.after($calendar_button),$.browser.msie&&$this.before($('<div class="clear"></div>')),$this.width()&&$this.css("width","-="+$calendar_button.outerWidth(!0)).attr("autocomplete","off"),"undefined"!=typeof interval){var config=$.extend({dateFormat:"yy-mm-dd",onClose:function(value){try{var parsed_date=$.datepicker.parseDate("yymmdd",value);$(this).val($.datepicker.formatDate("yy-mm-dd",parsed_date))}catch(e){$(this).val(value)}}},interval);$this.datepicker(config)}else $this.datepicker({dateFormat:"yy-mm-dd",onClose:function(value){try{var parsed_date=$.datepicker.parseDate("yymmdd",value);$(this).val($.datepicker.formatDate("yy-mm-dd",parsed_date))}catch(e){$(this).val(value)}}});$calendar_button.bind("click",function(e){e.preventDefault(),$this.datepicker("widget").is(":hidden")&&$this.datepicker("show")})})},hint:function(text,width){var w=Math.max(parseInt(width,10),200);return $(this).wrap('<span class="hinted"></span>').after('<span class="hint" style="width: '+w+"px; right: -"+(w+50)+'px;">'+text+'<span class="hint-pointer sprite">&nbsp;</span></span>').focus(function(){var t=this;t._focus_timeout=setTimeout(function(){$(t).next(".hint").fadeIn()},1e3)}).blur(function(){this._focus_timeout&&clearTimeout(this._focus_timeout),$(this).next(".hint").fadeOut()}).keypress(function(){this._focus_timeout&&clearTimeout(this._focus_timeout),$(this).next(".hint").fadeOut()})},unhint:function(){return $(this).parent().hasClass("hinted")?($(this).next(".hint").remove(),$(this).unwrap()):$(this).parent().find(".hinted")&&$(this).next(".hint").remove(),this},hintError:function(text,width,dont_show){var target=$(this),t=this;if(target.data("blur-field"))var blurFocusTarget=$("#"+target.data("blur-field"));else blurFocusTarget=target;var hintedWrapperClasses=new Array("hinted");return $(this).data("is-textbox")&&(target=$(this).next().is(".hinted")?$(this).next().find(".textboxlist"):$(this).next(".textboxlist")),($(this).data("is-textbox")||target.hasClass("textboxlist"))&&(hintedWrapperClasses.push("contain-textbox"),blurFocusTarget=target.find(".textboxlist-bit-editable-input")),target.unhint(),target.addClass("save_warning"),target.data("no-hinted-span")||target.wrap('<span class="'+hintedWrapperClasses.join(" ")+'"></span>'),target.after('<span class="hint">'+text+'<span class="hint-pointer sprite">&nbsp;</span></span>'),blurFocusTarget.blur(function(){target.next(".hint").fadeOut()}).focus(function(){target.next(".hint").fadeIn()}).change(function(){console.log($(target)),t.handleHintErrorChange.apply(target)}),target.data("hint",target.next(".hint")),target.setHintErrorWidth(width),target.setHintErrorPosition(),target.data("extra-hint-classes")&&target.parents(".hinted").addClass(target.data("extra-hint-classes")),target.data("hint").click(function(e){e.preventDefault(),e.stopPropagation(),$(this).fadeOut()}),dont_show||target.data("hint").fadeIn(),target},handleHintErrorChange:function(){$(this).unhint().removeClass("save_warning")},setHintErrorWidth:function(width){var w=Math.max(parseInt(width,10),200);return $(this).next(".hint").css({width:w}),$(this)},setHintErrorPosition:function(){var r=-(parseInt($(this).data("hint").css("width"))+50);return $(this).data("hint").css({right:r}),$(this)},tooltip:function(text,width){var w=Math.max(parseInt(width,10),200);return $(this).wrap('<span class="hinted"></span>').after('<span class="hint" style="width: '+w+"px; right: -"+(w+50)+'px;">'+text+'<span class="hint-pointer sprite">&nbsp;</span></span>').mouseenter(function(){$(this).next(".hint").fadeIn()}).mouseleave(function(){$(this).next(".hint").fadeOut()})},signal:function(length){return length=parseInt(length),0>=length&&(length=500),$(this).each(function(){$(this).addClass("signal");var t=this;setTimeout(function(){$(t).removeClass("signal")},length)})},checkVal:function(){if(arguments.length>0){var checked=!1;return("YES"==arguments[0]||arguments[0]===!0)&&(checked=!0),this.prop("checked",checked),this}return this.val()},getClasses:function(){var all_classes=[];return $(this).each(function(){var classes=$(this).attr("class").split(" ");for(var k in classes){var found=!1;for(var i in all_classes)all_classes[i]==classes[k]&&(found=!0);found||all_classes.push(classes[k])}}),all_classes}}),$.extend({geocoding:function(address,callback){if($.app.geolocation){var geocoder=new google.maps.Geocoder;geocoder.geocode({address:address,language:$.app.lang},function(results,status){if("OK"==status)if(results.length>1){for(var pop=0,i=0;i<results.length;i++)("APPROXIMATE"==results[i].geometry.location_type||"GEOMETRIC_CENTER"==results[i].geometry.location_type)&&(results[i]=!1,pop++);for(i=0;pop>i;i++){for(var j=0;j<results.length-1;j++)0==results[j]&&(results[j]=results[j+1],results[j+1]=!1);results.pop()}results.length>1?callback("ERROR","MULTIPLE",0,0,results):0==results.length?callback("ERROR","ZERO_RESULTS",0,0,results):callback("SUCCESS",status,results[0].geometry.location.lat(),results[0].geometry.location.lng(),results)}else"APPROXIMATE"==results[0].geometry.location_type||"GEOMETRIC_CENTER"==results[0].geometry.location_type?callback("ERROR","INACCURATE",0,0,results):callback("SUCCESS",status,results[0].geometry.location.lat(),results[0].geometry.location.lng(),results);else"ZERO_RESULTS"==status?callback("ERROR",status,0,0,results):callback("TOPROCESS",status,0,0,results)})}else callback("TOPROCESS","ZERO_RESULTS",0,0,!1)}}),String.prototype.htmlEntity=function(){return $.app.htmlEntity(this.toString())},String.prototype.nl2br=function(){return this.replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g,"$1<br />$2")},$("#hook_confidentiality_policy,#hook_usage_policy").safeClick(function(){$.app.showMessage($(this).text(),$.app._("AVAILABLE_SOON"))}),this._init()},_init:function(){},configure:function(config){if(config.debug&&(this.debug=!0),config.sendError&&(this.sendErrors=!0),config.sendErrorsOnUnload&&(this.sendErrorsOnUnload=!0),config.silent&&(this.silent=!0),config.trace_retirement&&(this.trace_retirement=!0),config.jqueryui&&config.jqueryui.startingday&&(this.startingDay=config.jqueryui.startingday),this.JS_PATH=config.JS_PATH,this.IMG_PATH=config.IMG_PATH,this.VIRTUALPATH=config.VIRTUALPATH,this.SESSION_KEY=config.SESSION_KEY,!config.application_version)throw this._throw("Applicaiton version not defined in configuration",!0);if(this._application_version=config.application_version,"object"!=typeof config.user)throw"No user info in application configuration";this._configure(config),this.setUserConfig(config.user),config.geolocation?(this.geolocation={},this.geolocation.url="http://maps.google.com/maps/api/geocode/json?"):this.geolocation=!1;for(var k in this.views){var view=this.views[k];"1"==view["default"]&&(this.default_view=k)}},_configure:function(){},getApplicationVersion:function(){return this._application_version},setUserConfig:function(user_config){var t=this;t.userVersion=user_config.version,t.userName=user_config.name,t.userEmail=user_config.email,t.userType=user_config.type,t.menus=user_config.menus,t.views=user_config.views,t.userIsAssumed=user_config.assumed,t.userIsCpanelAssumed=user_config.cpanel_assumed,t.cpanelUserName=user_config.cpanel_user_name,t.setLocale(user_config.locale),t._setUserConfig(user_config),this._buildHeader()},_setUserConfig:function(){},setLocale:function(locale){if(this.locale!=locale){this.locale=locale,this.lang=-1!=locale.indexOf("fr")?"fr":"en",this._messages[this.lang]||$.ajax({url:this.JS_PATH+this.lang+".js",data:!1,dataType:"script",async:!1,cache:!0});var defaults=$.extend($.datepicker.regional[this.lang],{dateFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0,gotoCurrent:!0,yearRange:"-90:+10"});this.startingDay&&(defaults.firstDay=this.startingDay),$.datepicker.setDefaults(defaults),$(".localeBound").trigger("setLocaleEvent"),this._setLocale(locale)}},_:function(message_id){if(!this._messages[this.lang])return message_id;var msg=this._messages[this.lang][message_id];return msg?msg:message_id},start:function(){this.hook(),this._observe(),this._checkGears()&&this._initGears()},hook:function(){var t=this;"function"==typeof this._hook&&this._hook(),$(".hook_question_comments").click(function(){t.showQuestionCommentDialog()})},loadMessages:function(lang,messages){this._messages[lang]=messages},_beforeUnload:function(){(this.sendErrors||this.sendErrorsOnUnload)&&this._sendErrors()},_throw:function(message,fatal){return $.toJSON({message:message,type:fatal?"fatal":"error"})},_onError:function(description,page,line){this.debug&&console.debug(description+" ("+page+":"+line+")");try{var error=$.secureEvalJSON(description.replace("uncaught exception: ",""));"fatal"==error.type&&this._showFatalError(error.message),description=error.message,delete error}catch(e){}return this.sendErrors&&(this._errors.push({description:description,page:page,line:line}),this._errors.length>10&&this._sendErrors()),this.silent},_sendErrors:function(){var t=this;if(this._errors.length>0){for(var errors=[],i=0;i<this._errors.length;i++)for(var k in this._errors[i])errors.push("error["+i+"]["+k+"]="+encodeURIComponent(this._errors[i][k]));$.ajax({async:!1,url:"index.php?k="+t.SESSION_KEY+"&action=error&"+errors.join("&")}),delete this._errors,this._errors=[]}},_showFatalError:function(error){var t=this;this.showModalDialog("<h2>"+$.app._("ERROR")+"</h2>						<p>							<strong>"+$.app._("FATAL_ERROR_OCCURED")+"</strong>							<br />							"+$.app._("CONTACT_SUPPORT_PERSIST")+'						</p>						<p class="submit">							'+$.app._("FATAL_ERROR__YOU_CAN")+" <a href=\"javascript:$.app._hideFatalError('reload');\">"+$.app._("FATAL_ERROR__RELOAD_PAGE")+"</a> "+$.app._("OR")+" <a href=\"javascript:$.app._hideFatalError('stepback');\">"+$.app._("FATAL_ERROR__GO_BACK")+"</a>						</p>","fast",function(){t._errors.push({description:error,page:"$.app.js",line:0})})},_hideFatalError:function(action){this.hideModalDialog("fast",function(){$.app.hideOverlay(),$("#fatal_error").remove(),"reload"==action?location.reload():"stepback"==action&&$.app.forceStepBack()})},_observe:function(){this.debug&&console.debug("Observing hash from now on");var t=this;this._observerInterval=setInterval(function(){t._checkHash()},250),this._checkHash()},_stopObservation:function(){this._observerInterval&&(this.debug&&console.debug("Stopped hash observation"),clearInterval(this._observerInterval),this._observerInterval=0)},_checkHash:function(){if(!this.view_fetching&&this.hash!==location.hash){if(this.debug&&console.debug("Hash changed"),this.hash=location.hash,this.hash&&"#"!=this.hash){var splits=this.hash.substring(1).split("&");view=splits.shift();var pos=view.indexOf("/");if(pos>0){var next=view.indexOf("/",pos+1);next>0&&(pos=next,view=view.substring(0,pos))}delete splits,""==view&&(view=this.default_view)}else var view=this.default_view;var fetch=!0;if(this.currentView&&view==this.currentView&&(object=this._getViewObject(this.currentView),object&&object.onHashChange(this.hash)&&(fetch=!1)),fetch&&this.currentView&&!this._resume_hash){var object=this._getViewObject(this.currentView);if(object){if(!object.close(this.hash))return this.debug&&console.debug("View coulnd't close"),this._stopObservation(),this._resume_hash=this.hash,this.hash=this.stepBack(),void this._observe();this.debug&&console.debug("Closed view")}}this._resume_hash=!1,this._force_clear?(this.addHistory(this.hash),this._force_clear=!1):this._detectStepBack(this.hash)||this.addHistory(this.hash),fetch&&(this.debug&&console.debug("View : "+view),this.hideModalDialogNow(),this._selectViewMenu(view),this._fetchView(view))}},goTo:function(hash,force_clear){this.debug&&console.debug('Go To "'+hash+'"'),force_clear&&(this._force_clear=!0),location.hash=hash},navigateBackTo:function(hash){this._history.length>1&&this._history[this._history.length-2].hash==hash?history.back():(this._history.pop(),this.replace(hash))},replace:function(hash){return hash||(hash=""),this.isOpera()?void location.replace(location.protocol+"//"+location.hostname+location.pathname+hash):void location.replace(hash)},forceGoTo:function(hash,force_clear){this._stopObservation(),this.debug&&console.debug('Force Go To "'+hash+'"'),force_clear&&(this._force_clear=!0),location=hash,location.reload()},resume:function(stay){if(this._resume_hash)if(stay||"undefined"==typeof stay)this.debug&&(this._resume_hash=!1,this.addHistory(location.hash),console.debug("View cancelled closing"));else{this.currentView=!1;var hash=this._resume_hash;this._resume_hash=!1,location.hash=hash,this.debug&&console.debug("View closed, resuming")}},getResumeHash:function(){return this._resume_hash},parseHash:function(hash){var infos={view:"",params:{}},splits=hash.split("&");infos.view=splits.shift().substr(1);for(var i=0;i<splits.length;i++){var info=splits[i].split("="),param=info.shift();infos.params[param]=info.join("=")}return infos},reload:function(hiddenParams){this._fetchView(this.currentView,hiddenParams)},_onFetchView:function(){},_onLoadView:function(){},_fetchView:function(view,hiddenParams){this.currentView=view;var t=this,cached=this._isViewCached(view);cached&&this.debug&&console.debug('View "'+view+'" is in cache ('+this.lang+")");var params=this._getViewParameters(location.hash);for(var k in params.params)params[k]=params.params[k];if(delete params.params,hiddenParams&&$.isPlainObject(hiddenParams))for(k in hiddenParams)params[k]=hiddenParams[k];params.k=t.SESSION_KEY,params.view=view,params.cmd="view",params.cached=cached,params.version=this.getApplicationVersion(),params.uv=t.userVersion;var param_string=$.param(params);this.view_fetching=!0,t._onFetchView(this._getViewObject(t.currentView)),$.ajax({url:"index.php?"+param_string,type:"POST",data:{context:$.app.getContext()},dataType:"json",success:function(response){if(t.view_fetching=!1,t._hideLoading(),"error"==response.status){var info=response.data;return 600==info.code?t._showFatalError('An error occured server side while fetching view data "'+view+'" (600)'):601==info.code||602==info.code?$.app.showModalDialog("<h2>"+$.app._("NAVIGATION_ERROR")+"</h2>										<p>											<strong>"+$.app._("INVALID_PAGE_REQUEST")+'</strong>											<br />										</p>										<p class="submit">											<input type="submit" id="hook_create_error_close" value="'+$.app._("OK")+'" />										</p>',"fast",function(){$("#hook_create_error_close").safeClick(function(){$.app.hideModalDialog("fast"),$.app._stopObservation(),$.app.hash=$.app.stepBack(),$.app._history.push($.app.hash),$.app._observe()})}):t._showFatalError('An unknwon error was sent from server while fetching view data "'+view+'" ('+info.error+")"),!1}t._onLoadView(t._getViewObject(t.currentView)),t._loadView(response.data)},error:function(xhr,status,error){return t.view_fetching=!1,t._hideLoading(),$.app.validateXHR(xhr)?(this.debug&&(console.debug("AJAX query error"),console.debug(status),console.debug(error)),void t._showFatalError('An error occured while fetching view data "'+view+'" ('+status+")")):!1}}),this._loadingTimeout=setTimeout(function(){t._showLoading()},this._loadingDelay)},_loadView:function(data){console.debug(data);var t=this;if(this.getApplicationVersion()!=data.version&&location.reload(),data.data&&(data=data.data),data.user&&t.userVersion!=data.user.version&&(t.clearViewCache(),t.setUserConfig(data.user)),this._initView(),this._getViewObject(this.currentView)._validateable=data.validateable,data.html)this.debug&&console.debug("Using recieved html"),this._loadContent(data.html),this._loadParams(data.params),this._setViewCache(this.currentView,data.html,data.params);else{if(!this._isViewCached(this.currentView))throw this._throw("View not cached and not recieved from html...",!0);this.debug&&console.debug("Using cached html"),this._loadContent(this._getViewCachedHTML(this.currentView)),this._loadParams(this._getViewCachedParams(this.currentView))}this._hookView(),this._loadModel(data.model),this._checkAnchor(),$("input").each(function(index,element){$(element).attr("maxlength")||$(element).attr("maxlength",255)})},_checkAnchor:function(){var params=this._getViewParameters(this.hash);if(params.params.anchor){var anchor_name=params.params.anchor,view=this._getViewObject(this.currentView),$element=$("[anchor="+anchor_name+"]");if(0==$element.length)return this.debug&&console.warn('GET parameter "anchor" found but there is no element associated with it!'),!1;$.isFunction(view.onScrollToAnchor)?view.onScrollToAnchor($element,anchor_name):this.debug&&console.warn('GET parameter "anchor" found but there is no `onScrollToAnchor` function on your view!')}},_initView:function(){if(!this.currentView)throw this._throw("No view to initialize",!0);var object=this._getViewObject(this.currentView);object&&object.init(location.hash)},_loadContent:function(html){var object=this._getViewObject(this.currentView);object&&"function"==typeof object.draw?object.draw(html):$("#content").html(html),scrollTo(0,0)},_loadParams:function(params){if(!this.currentView)throw this._throw("No view to load parameters from.",!0);var object=this._getViewObject(this.currentView);object&&object.load(params)},_hookView:function(){if(!this.currentView)throw this._throw("No view to hook",!0);var object=this._getViewObject(this.currentView);object&&("function"==typeof object._preHook&&object._preHook(),object.hook())},recursiveCleanFloats:function(model){if($.isArray(model))for(var i=0;i<model.length;i++)model[i]=$.app.recursiveCleanFloats(model[i]);else if("object"==typeof model)for(var k in model)model[k]=$.app.recursiveCleanFloats(model[k]);else if("string"==typeof model&&model.match(/^\d+\.\d+$/i)){var p=parseFloat(model);isNaN(p)||(model=p)}return model},_loadModel:function(model){var object=this._getViewObject(this.currentView);object?(model=$.app.recursiveCleanFloats(model),this.debug&&console.debug(model),object.inject(model),"function"==typeof object._postInject&&object._postInject()):this.debug&&console.debug("No view object, cannot inject model"),$(".page-title").length&&(window.document.title=$(".page-title").text())},clearViewCache:function(){this.debug&&console.log("Clearing view cache"),delete this._view_cache,this._view_cache=[]},_isViewCached:function(view){return this._view_cache[view]&&this._view_cache[view].html?!0:!1},_getViewCachedHTML:function(view){if(this._view_cache[view]&&this._view_cache[view].html)return this._view_cache[view].html;throw this._throw("View was supposed to be cached...",!0)},_getViewCachedParams:function(view){return this._view_cache[view].params},_setViewCache:function(view,html,params){delete this._view_cache[view],this._view_cache[view]={html:html,params:params?params:null},this.debug&&console.debug('Cached version of view "'+view+'"')},_getViewParameters:function(hash){var object=this._getViewObject(this.currentView);return object?object.parseHash(hash):{}},_showLoading:function(){if(this._loadingTimeout){if(clearTimeout(this._loadingTimeout),this._loadingTimeout=0,this.debug&&console.debug("Show loading overlay"),$("#loading-overlay").length>0)return;this.showOverlay(),$("body").append('<img id="loading-overlay-image" src="'+this.IMG_PATH+'ajax-loader-big.gif" /><div id="loading-overlay"></div>');var main_height=$("#main").height()+parseInt($("#main").css("padding-top"),10)+parseInt($("#main").css("padding-bottom"),10);$("#loading-overlay-image").css({top:$("#main").offset().top,paddingTop:parseInt(main_height/2,10)+"px",position:"absolute",left:Math.floor($("#main").width()/2),zIndex:89}),$("#loading-overlay").css({height:main_height,left:0,position:"absolute",top:$("#main").offset().top,width:"100%",zIndex:90,backgroundColor:"#000",opacity:.4}).fadeIn()}},beforeHideLoading:function(){},_hideLoading:function(){this.beforeHideLoading(),clearTimeout(this._loadingTimeout),this._loadingTimeout=0,this.debug&&console.debug("Hide loading overlay"),$("#loading-overlay").remove(),$("#loading-overlay-image").remove(),this.hideOverlay(),this.afterHideLoading()},afterHideLoading:function(){},showOverlay:function(color,opacity,id,zIndex){zIndex||(zIndex=500),id||(id="overlay"),this.debug&&console.debug("Show overlay"),$("#"+id).length>0||($("body").append('<div id="'+id+'"></div>'),color||(color="transparent"),opacity||(opacity="0"),$("#"+id).css({height:$(document).height(),left:0,position:"absolute",top:0,width:this._iPad?$("body").width():"100%",zIndex:zIndex,backgroundColor:color,opacity:opacity}).fadeIn())},hideOverlay:function(id){this.debug&&console.debug("Hide overlay"),id||(id="overlay"),$("#"+id).remove()},addHistory:function(hash){this._history[this._history.length-1]&&this._history[this._history.length-1].hash==hash||this._history.push({hash:hash,context:{}})},_detectStepBack:function(hash){return this._history[this._history.length-2]&&this._history[this._history.length-2].hash==hash?(this._history.pop(),!0):!1},stepBack:function(redirect){do{if(0==this._history.length){var hash="";break}if(hash=this._history.pop().hash,"undefined"==typeof hash){hash="";break}}while(hash==location.hash);return this.debug&&console.debug("Step back to : "+hash),(redirect||"undefined"==typeof redirect)&&(location.hash=hash),hash},forceReload:function(){location.reload()},forceStepBack:function(){this._stopObservation(),this.debug&&this._debugHistory();var hash=this.stepBack(!1);""!=hash?(location=hash,location.reload()):(history.back(),location.reload())},goBack:function(){if(this._history.length<2)var hash="";else this._history.pop().hash,hash=this._history.pop().hash;this.debug&&console.debug('Go back to "'+hash+'"'),location.hash=hash},forceGoBack:function(){if(this._stopObservation(),this._history.length<2)var hash="";else this._history.pop().hash,hash=this._history.pop().hash;this.debug&&console.debug('Force go back to "'+hash+'"'),location.hash=hash,location.reload()},setContextValue:function(key,value){this._history.length>0&&($.isPlainObject(this._history[this._history.length-1].context)||(this._history[this._history.length-1].context={}),this._history[this._history.length-1].context[key]=value)},getContextValue:function(key){return this._history.length>0&&$.isPlainObject(this._history[this._history.length-1].context)?this._history[this._history.length-1].context[key]:!1},getContext:function(){return this._history&&this._history.length>0&&$.isPlainObject(this._history[this._history.length-1].context)?this._history[this._history.length-1].context:{}},_debugHistory:function(){for(var i=0;i<this._history.length;i++)console.debug(i+" : "+this._history[i].hash),console.debug(this._history[i].state)},_arrayPop:function(array,index){if(array.length&&index>0&&index<array.length){for(var i=index;i<array.length-1;i++)array[i]=array[i+1];array.pop()}return array},_checkGears:function(){return window.google&&google.gears?(this.debug&&console.debug("Google Gears is installed"),!0):(this.debug&&console.debug("Google Gears is not installed"),!1)},_initGears:function(){return this._checkGears()?!0:!1},registerView:function(view,object){this.debug&&this._view_objects[view]&&console.debug("View "+view+" is already registered"),this.debug&&console.debug('Registered view "'+view+'"'),this._view_objects[view]=object},_getViewObject:function(view){return this._view_objects[view]},_scrollTop:function(){var win=window.pageYOffset?window.pageYOffset:0,doc=document.documentElement?document.documentElement.scrollTop:0,body=document.body?document.body.scrollTop:0,value=win?win:0;return value=doc&&(!value||value>doc)?doc:value,value=body&&(!value||value>body)?body:value},showModalDialog:function(content,speed,callback,width){$.app.debug&&console.debug("Show modal dialog"),this.showOverlay("#000",.4),$("body").append('			<div id="modal_dialog" class="modal" style="display: none; top : '+$.app._scrollTop()+'px">				<div class="modal-2" '+(width?'style="width: '+width+'px;"':"")+'>					<div class="sprite modal-3">						'+content+"					</div>				</div>			</div>"),$.app.isIE7()&&$("div.modal p.submit").prepend('<span style="width: 1px; display: inline-block;">&nbsp;</span>'),$("#modal_dialog").slideDown(speed,callback)},hideModalDialog:function(speed,callback,use_detach){$.app.debug&&console.debug("Hide modal dialog"),$("#modal_dialog").fadeOut(speed,function(){$.app.hideOverlay(),use_detach?$("#modal_dialog").detach():$("#modal_dialog").remove(),"function"==typeof callback&&callback()})},hideModalDialogNow:function(){$.app.debug&&console.debug("Hide modal dialog now!"),$("#modal_dialog").remove()},showError:function(message){$.app.showModalDialog("<h2>"+$.app._("ERROR")+"</h2>						<p>							<strong>"+(message?message:$.app._("FATAL_ERROR_OCCURED"))+"</strong>							<br />							"+$.app._("ERROR_TRY_AGAIN")+"							<br />							<br />							"+$.app._("CONTACT_SUPPORT_PERSIST")+'						</p>						<p class="submit">							<input type="submit" id="hook_create_error_close" value="'+$.app._("OK")+'" />						</p>',"fast",function(){$("#hook_create_error_close").safeClick(function(){$.app.hideModalDialog("fast")})})},showMessage:function(title,message,content){""==title&&this._throw("Missing title",!0),""==message&&this._throw("Missing message",!0),$.app.showModalDialog("<h2>"+title+"</h2>						<p>							<strong>"+message+"</strong>						</p>						"+(content?"<p>"+content+"</p>":"")+'						<p class="submit">							<input type="submit" id="hook_show_message_close" value="'+$.app._("OK")+'" />						</p>',"fast",function(){$("#hook_show_message_close").safeClick(function(){$.app.hideModalDialog("fast")})})},showQuestionCommentDialog:function(comment_type){var t=this,content="<h2>"+$.app._("QUESTION_COMMENT_SUGGESTION")+'</h2>		<div class="header_line"></div>		<div id="hook_question_comment_form">		<dl class="form left_form">		<dt><label style="width:100px">'+$.app._("COMMENT_TYPE")+'</label></dt>		<dd><select id="hook_question_comment_type">		<option value="QUESTION">'+$.app._("QUESTION")+'</option>		<option value="COMMENT">'+$.app._("COMMENT")+'</option>		<option value="SUGGESTION">'+$.app._("SUGGESTION")+'</option>		</select></dd>		<dt><label style="width:100px">'+$.app._("COMMENT_FROM")+'</label></dt>		<dd><input type="text" id="hook_question_comment_from" style="width:350px" disabled="disabled" /></dd>		<dt><label style="width:100px">'+$.app._("COMMENT_SUBJECT")+'</label></dt>		<dd><input type="text" id="hook_question_comment_subject" style="width:350px" /></dd>		<br />		<dd><textarea id="hook_question_comment_textarea" style="width:500px;height:150px"></textarea></dd>		</dl>		<p class="submit">		<input type="submit" id="hook_send_question_comment" value="'+$.app._("OK")+'" /> <a href="javascript:void(0);" id="hook_cancel_question_comment">'+$.app._("CANCEL")+'</a>		</p>		</div>		<div id="hook_question_comment_sent" style="display:none"><p>'+$.app._("THANK_YOU_FOR_YOUR_COMMENTS")+"</p></div>";
$.app.showModalDialog(content,"normal",function(){comment_type&&$("#hook_question_comment_type").val(comment_type),$("#hook_question_comment_from").val($.app.userEmail),$("#hook_send_question_comment").safeClick(function(){var type=$("#hook_question_comment_type").val(),subject=$("#hook_question_comment_subject").val(),from=$("#hook_question_comment_from").val(),message=$("#hook_question_comment_textarea").val();if(!subject)return $("#hook_question_comment_subject").hintError($.app._("FIELD_REQUIRED")).focus(),!1;if(!message)return $("#hook_question_comment_textarea").hintError($.app._("FIELD_REQUIRED")).focus(),!1;var postString="&type="+encodeURIComponent(type)+"&subject="+encodeURIComponent(subject)+"&from="+encodeURIComponent(from)+"&message="+encodeURIComponent(message);$.ajax({url:"index.php?k="+t.SESSION_KEY+"&sendComment",type:"POST",data:postString,dataType:"json",success:function(data){return data.status&&"error"==data.status?($.app.showError(),$.app.hideModalDialog("fast"),!1):(setTimeout(function(){$.app.hideModalDialog("fast")},2e3),!0)},error:function(xhr){return $.app.validateXHR(xhr)?($.app.showError(),$.app.hideModalDialog("fast"),!1):($.app.hideModalDialog("fast"),!1)}}),$("#hook_question_comment_form").fadeOut(function(){$("#hook_question_comment_sent").show()})}),$("#hook_cancel_question_comment").safeClick(function(){$.app.hideModalDialog("fast")}),$("#hook_question_comment_subject").focus()},550)},htmlEntity:function(value){return value?$("<div></div>").text(value).html():""},sleep:function(milliseconds){var d=new Date;do n=new Date;while(milliseconds>n-d)},isNumber:function(value){return"number"==typeof value&&isFinite(value)},parseFloat:function(value){if("float"==typeof value)return value;value+=";",value=value.replace(/[^\d\-.,]/g,""),"fr"==this.lang&&-1!=value.indexOf(",")&&(value=value.replace(/\./g,""),value=value.replace(/\,/g,".")),value=value.replace(/\,/g,"");var val=parseFloat(value);return isNaN(val)&&(val=0),val},parseInt:function(value){return value=parseInt(value,10),isNaN(value)&&(value=0),value},formatMoney:function(value,opts){if(opts&&opts.canBeNull&&(""===value||null===value))return"";if("fr"==this.lang)var currency_pos="right";else currency_pos="left";var result=this.formatNumber(value,opts);return result||(result="0"),"left"==currency_pos?opts&&opts.nbsp?"$"+result:"$"+result:opts&&opts.nbsp?result+"&nbsp;$":result+" $"},formatPercent:function(value,opts){if(opts&&opts.canBeNull&&!value)return"";if("fr"==this.lang)if(opts&&opts.nbsp)var separator="&nbsp";else separator=" ";else separator="";var result=this.formatNumber(value,opts);return result||(result="0"),result+separator+"%"},formatNumber:function(value,opts){if(0==arguments.length)return"";if(!value&&0!==value)return"";var default_options={precision:2,facultative_decimals:!0,positive:!1,nbsp:!1,rounded:!0};default_options="fr"==this.lang?$.extend({decimal_separator:",",thousand_separator:" "},default_options):$.extend({decimal_separator:".",thousand_separator:","},default_options);var options=$.extend(default_options,opts);value+="";var neg=!1;if("-"==value.charAt(0)&&(options.positive?value="0":(neg=!0,value=value.substr(1))),value=value.replace(/[^\d\-.,]/g,""),","==options.decimal_separator&&-1!=value.indexOf(options.decimal_separator)&&(value=value.replace(/\./g,""),value=value.replace(/,/g,".")),""==value&&(value="0"),value=value.replace(/,/g,""),value=parseFloat(value)+"",value==Number.NaN&&(value=""),0==options.precision)var rounded=$.app.parseFloat(value).toFixed(0),tmp=rounded;else rounded=options.rounded?(Math.round(value*Math.pow(10,options.precision))/Math.pow(10,options.precision)).toFixed(options.precision):(Math.floor(value*Math.pow(10,options.precision))/Math.pow(10,options.precision)).toFixed(options.precision),tmp=rounded.substr(0,rounded.indexOf("."));var integer="",pos=tmp.length;if(pos>3){do{pos-=3;var size=3;0>pos&&(size=3+pos,pos=0),integer=""!=integer?tmp.substr(pos,size)+options.thousand_separator+integer:tmp.substr(pos,size)}while(pos>0)}else integer=tmp;if(0==options.precision||options.facultative_decimals&&0==parseInt(rounded.substr(rounded.indexOf(".")+1)))var result=integer;else integer+=options.decimal_separator,result=integer+rounded.substr(rounded.indexOf(".")+1);return options.end_space&&(result+=" "),options.nbsp&&(result=result.replace(/ /g,"&nbsp;")),neg?"-"+result:result},formatSIN:function(sin){var old_sin=sin;old_sin=old_sin.replace(new RegExp("[^\\d]","g"),"");var new_sin=old_sin.substr(0,3)+" "+old_sin.substr(3,3)+" "+old_sin.substr(6,3);return $.trim(new_sin)},isSINValid:function(sin){if(""==sin)return!0;if("*** *** ***"==sin)return!0;if(sin=sin.replace(new RegExp("[^\\d]","g"),""),9!=sin.length)return!1;for(var total=parseInt(sin.charAt(0))+parseInt(sin.charAt(2))+parseInt(sin.charAt(4))+parseInt(sin.charAt(6)),i=1;7>=i;i+=2){var tmp=2*parseInt(sin.charAt(i));tmp>=10&&(tmp-=9),total+=tmp}return total+=parseInt(sin.charAt(8)),total%10!=0?!1:!0},formatFieldValue:function(fieldValue){var t=this;if(!fieldValue)return"";if("object"==typeof fieldValue){var val=fieldValue["value_"+t.lang];return"undefined"==typeof val?"":val}return fieldValue},parsePhone:function(phone){if(/(,|ext|poste|#)/.test(phone)){var coma=phone.indexOf(","),ext=phone.indexOf("ext"),poste=phone.indexOf("poste"),square=phone.indexOf("#"),pos=Math.max(coma,ext,poste,square);if(-1!=pos){var extension=phone.substr(pos).replace(/[^\d]/g,"");phone=phone.substr(0,pos)}}else extension="";if(phone=phone.replace(/[^\d]/g,""),"1"==phone[0]&&phone.length>=11){var formatted="1 "+phone.substr(1,3)+" "+phone.substr(4,3)+"-"+phone.substr(7,4);phone.length>11&&(extension=phone.substr(11))}else phone.length>=10?(formatted=phone.substr(0,3)+" "+phone.substr(3,3)+"-"+phone.substr(6,4),phone.length>10&&(extension=phone.substr(10))):formatted=7==phone.length?phone.substr(0,3)+"-"+phone.substr(3):phone;return extension&&(formatted+=$.app._("PHONE_EXTENSION")+extension),formatted},formatPostalCode:function(code){return/^[a-zA-Z]\d[a-zA-Z]\d[a-zA-Z]\d$/.test(code)?(code.substr(0,3)+" "+code.substr(3)).toUpperCase():code},pad:function(number,length){for(var str=""+number;str.length<length;)str="0"+str;return str},validateXHR:function(xhr){if(!xhr||"undefined"==typeof xhr||"function"!=typeof xhr.getResponseHeader)return!0;var redirect_to=xhr.getResponseHeader("X-Kronos-Ajax-Goto");return redirect_to?(document.location=redirect_to,!1):!0},get:function(view,cmd,paramsString,callback,loading,errorCallback,button,skipOverlayHandling){loading||skipOverlayHandling||this.showOverlay(),button&&$(button).prop("disabled",!0);var t=this;paramsString.length>0&&"&"!=paramsString[0]&&(paramsString="&"+paramsString);var xhrRequest=$.ajax({url:"index.php?k="+t.SESSION_KEY+"&view="+view+"&cmd="+cmd+paramsString,type:"GET",dataType:"json",success:function(response){if(skipOverlayHandling||(t.hideOverlay(),t._hideLoading()),button&&$(button).prop("disabled",!1),"undefined"!=typeof response.data)var data=response.data;else var data=response;response.status&&"error"==response.status?"function"==typeof errorCallback?errorCallback(data):"undefined"!=typeof data.message?$.app.showError(data.message):$.app.showError():"function"==typeof callback&&callback(data)},error:function(xhr,status,error){return skipOverlayHandling||(t.hideOverlay(),t._hideLoading()),console.debug(xhr),"abort"!=status&&$.app.validateXHR(xhr)?(button&&$(button).prop("disabled",!1),this.debug&&(console.debug("AJAX query error"),console.debug(status),console.debug(error)),void("function"==typeof errorCallback?errorCallback():$.app.showError())):!1}});return loading&&(this._loadingTimeout=setTimeout(function(){t._showLoading()},this._loadingDelay)),xhrRequest},post:function(view,cmd,paramsString,postString,callback,loading,errorCallback,button){var t=this;button&&$(button).prop("disabled",!0),paramsString.length>0&&"&"!=paramsString[0]&&(paramsString="&"+paramsString);var xhrRequest=$.ajax({url:"index.php?k="+t.SESSION_KEY+"&view="+view+"&cmd="+cmd+paramsString,type:"POST",data:postString,dataType:"json",success:function(response){if(loading&&(t.hideOverlay(),t._hideLoading()),button&&$(button).prop("disabled",!1),"undefined"!=typeof response.data)var data=response.data;else data=response;response.status&&"error"==response.status?"function"==typeof errorCallback?errorCallback(data):"undefined"!=typeof data.message?$.app.showError(data.message):$.app.showError():"function"==typeof callback&&callback(data)},error:function(xhr,status,error){return t.hideOverlay(),t._hideLoading(),"abort"!=status&&$.app.validateXHR(xhr)?(button&&$(button).prop("disabled",!1),this.debug&&(console.debug("AJAX query error"),console.debug(status),console.debug(error)),void("function"==typeof errorCallback?errorCallback():$.app.showError())):!1},ajaxStop:function(){t.ajaxQueryLoading=!1}});return loading&&(this._loadingTimeout=setTimeout(function(){t._showLoading()},this._loadingDelay)),xhrRequest},date:{_date_regex:new RegExp(/^(\d{4})-{0,1}(\d{2})-{0,1}(\d{2})(| (\d{2}):(\d{2}):(\d{2}))$/),isDate:function(date){var m=this._date_regex.exec(date);return null!=m},parse:function(date){if(null===date)return!1;if("object"==typeof date){if("undefined"==typeof date.date)return date;date=date.date}var m=this._date_regex.exec(date);if(null==m)return $.app.debug&&console.debug('Could not parse date "'+date+'"'),!1;var obj=new Date;return obj.setDate(1),obj.setYear(m[1]),obj.setMonth(parseInt(m[2],10)-1),obj.setDate(m[3]),m[4]?(obj.setHours(m[5]),obj.setMinutes(m[6]),obj.setSeconds(m[7])):(obj.setHours("0"),obj.setMinutes("0"),obj.setSeconds("0")),obj},format:function(date,format){if("undefined"==typeof format&&(format="long"),date=this.parse(date),!date)return"";if("input"==format)return date.getFullYear()+"-"+$.app.pad(date.getMonth()+1,2)+"-"+$.app.pad(date.getDate(),2);if("long"==format)return date.getDate()+" "+this.getMonthName(date.getMonth())+" "+date.getFullYear();if("longtime"==format)return date.getDate()+" "+this.getMonthName(date.getMonth())+" "+date.getFullYear()+" "+$.app._("AT")+" "+date.getHours()+":"+$.app.pad(date.getMinutes(),2);if("short"==format)return date.getDate()+" "+this.getMonthName(date.getMonth());if("longabbrmonth"==format){var monthName,month=date.getMonth(),rData=$.datepicker.regional[$.app.lang];return monthName=rData?rData.monthNamesShort[month]:this.getMonthName(month).substring(0,3),date.getDate()+" "+monthName+". "+date.getFullYear()}return $.app.debug&&console.debug('Unknown date format "'+format+'"'),""},getMonthName:function(month){switch("undefined"==typeof month&&0==arguments.length&&(month=(new Date).getMonth()),month){case 0:return $.app._("JANUARY");case 1:return $.app._("FEBRUARY");case 2:return $.app._("MARCH");case 3:return $.app._("APRIL");case 4:return $.app._("MAY");case 5:return $.app._("JUNE");case 6:return $.app._("JULY");case 7:return $.app._("AUGUST");case 8:return $.app._("SEPTEMBER");case 9:return $.app._("OCTOBER");case 10:return $.app._("NOVEMBER");case 11:return $.app._("DECEMBER");default:$.app._throw('Unknown month "'+month+'"')}},getAge:function(date){if(date=this.parse(date)){var now=new Date,age=now.getFullYear()-date.getFullYear();return(now.getMonth()<date.getMonth()||now.getMonth()==date.getMonth()&&now.getDate()<date.getDate())&&age--,delete date,age}return 0},getFakeBirthdate:function(age){if(age=parseInt(age),!age)return"";var now=new Date;return now.getFullYear()-age+"-01-01"},getInsuranceAge:function(date){var date_obj=this.parse(date);if(date_obj){var age=this.getAge(date),lastBirthday=new Date,now=new Date,nextBirthday=new Date;return lastBirthday.setMonth(date_obj.getMonth()),lastBirthday.setDate(date_obj.getDate()),nextBirthday.setMonth(date_obj.getMonth()),nextBirthday.setDate(date_obj.getDate()),lastBirthday>now&&lastBirthday.setFullYear(lastBirthday.getFullYear()-1),nextBirthday.setFullYear(lastBirthday.getFullYear()+1),Math.abs(now-nextBirthday)<Math.abs(now-lastBirthday)&&age++,delete date_obj,delete lastBirthday,delete now,delete nextBirthday,age}return 0},getYear:function(date){return date=this.parse(date),date?date.getFullYear():0}},datepicker:function(selector,options){return $(selector).bind("change",function(){this.value=$.app.date.format(this.value,"input")}).datepicker(options)},_formatAddress:function(line1,line2,city,state,country,postalCode){var address="",f=!0;return""!=line1&&(f=!1,address+=this.htmlEntity(line1)),""!=line2&&(f||(address+=", "),f=!1,address+=this.htmlEntity(line2)),""!=city&&(f||(address+=", "),f=!1,address+=this.htmlEntity(city)),""!=state&&"QC"!=state&&(f||(address+=", "),f=!1,address+=this.htmlEntity(state)),""!=postalCode&&(f||(address+=", "),f=!1,address+=this.htmlEntity(postalCode)),""!=country&&"Canada"!=country&&(f||(address+=", "),f=!1,address+=this.htmlEntity(country)),address},formatAddress:function(line1,line2,city,state,country,postalCode){return this._formatAddress(line1,line2,city,state,country,postalCode)},formatGMapAddress:function(line1,line2,city,state,country,postalCode){return line1=$.trim(line1),line2=$.trim(line2),city=$.trim(city),country=$.trim(country),postalCode=$.trim(postalCode),line1=line1.replace(/\bboul\./i,"Boulevard"),line1=line1.replace(/,\s?\b(bur|bureau|app|appartement|appartment|local|office|porte|door)\b\.?\s*\d*/i,""),(line1?line1+", ":"")+(line2?line2+", ":"")+(city?city+", ":"")+(state?state+", ":"")+(postalCode?postalCode+", ":"")+country},isMobile:function(){return navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/Pre/i)||navigator.userAgent.match(/Android/i)},_sprintfWrapper:{init:function(){if("undefined"==typeof arguments)return null;if(arguments.length<1)return null;if("string"!=typeof arguments[0])return null;if("undefined"==typeof RegExp)return null;for(var string=arguments[0],exp=new RegExp(/(%([%]|(\-)?(\+|\x20)?(0)?(\d+)?(\.(\d)?)?([bcdfosxX])))/g),matches=new Array,strings=new Array,convCount=0,stringPosStart=0,stringPosEnd=0,matchPosEnd=0,newString="",match=null;match=exp.exec(string);)match[9]&&(convCount+=1),stringPosStart=matchPosEnd,stringPosEnd=exp.lastIndex-match[0].length,strings[strings.length]=string.substring(stringPosStart,stringPosEnd),matchPosEnd=exp.lastIndex,matches[matches.length]={match:match[0],left:match[3]?!0:!1,sign:match[4]||"",pad:match[5]||" ",min:match[6]||0,precision:match[8],code:match[9]||"%",negative:parseInt(arguments[convCount])<0?!0:!1,argument:String(arguments[convCount])};if(strings[strings.length]=string.substring(matchPosEnd),0==matches.length)return string;if(arguments.length-1<convCount)return null;match=null;var i=null;for(i=0;i<matches.length;i++){if("%"==matches[i].code)var substitution="%";else"b"==matches[i].code?(matches[i].argument=String(Math.abs(parseInt(matches[i].argument,10)).toString(2)),substitution=$.app._sprintfWrapper.convert(matches[i],!0)):"c"==matches[i].code?(matches[i].argument=String(String.fromCharCode(parseInt(Math.abs(parseInt(matches[i].argument,10))))),substitution=$.app._sprintfWrapper.convert(matches[i],!0)):"d"==matches[i].code?(matches[i].argument=String(Math.abs(parseInt(matches[i].argument,10))),substitution=$.app._sprintfWrapper.convert(matches[i])):"f"==matches[i].code?(matches[i].argument=String(Math.abs(parseFloat(matches[i].argument,10)).toFixed(matches[i].precision?matches[i].precision:6)),substitution=$.app._sprintfWrapper.convert(matches[i])):"o"==matches[i].code?(matches[i].argument=String(Math.abs(parseInt(matches[i].argument,10)).toString(8)),substitution=$.app._sprintfWrapper.convert(matches[i])):"s"==matches[i].code?(matches[i].argument=matches[i].argument.substring(0,matches[i].precision?matches[i].precision:matches[i].argument.length),substitution=$.app._sprintfWrapper.convert(matches[i],!0)):"x"==matches[i].code?(matches[i].argument=String(Math.abs(parseInt(matches[i].argument,10)).toString(16)),substitution=$.app._sprintfWrapper.convert(matches[i])):"X"==matches[i].code?(matches[i].argument=String(Math.abs(parseInt(matches[i].argument,10)).toString(16)),substitution=$.app._sprintfWrapper.convert(matches[i]).toUpperCase()):substitution=matches[i].match;newString+=strings[i],newString+=substitution}return newString+=strings[i]},convert:function(match,nosign){match.sign=nosign?"":match.negative?"-":match.sign;var l=match.min-match.argument.length+1-match.sign.length,pad=new Array(0>l?0:l).join(match.pad);return match.left?"0"==match.pad||nosign?match.sign+match.argument+pad.replace(/0/g," "):match.sign+match.argument+pad:"0"==match.pad||nosign?match.sign+pad+match.argument:pad+match.sign+match.argument}},downloadFile:function(url){var t=this;if(t._iPad){var content="<h2>"+$.app._("DOWNLOAD_FILE_DIALOG_TITLE")+'</h2>			<div class="header_line"></div>			<a id="hook_download_file" href="javascript:void(0);">'+t._("DOWNLOAD_FILE")+"</a>			<br /><br />";$.app.showModalDialog(content,"normal",function(){$("#hook_download_file").click(function(){window.open(url,"_blank"),$.app.hideModalDialog("fast")})})}else{var frameId="download_iframe",io=document.getElementById(frameId);if(!io){var io=document.createElement("iframe");io.id=frameId,io.name=frameId,io.style.position="absolute",io.style.top="-1000px",io.style.left="-1000px",document.body.appendChild(io)}io.src=url}},sprintf:function(){},isIE7:function(){var rv=999;if("Microsoft Internet Explorer"==navigator.appName){var ua=navigator.userAgent,re=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})");null!=re.exec(ua)&&(rv=parseFloat(RegExp.$1))}return 8>rv},isOpera:function(){return"Opera"==navigator.appName},autocompleter:function(selector,view,command,callback,config){var autocompleter={selector:!1,selectorIsDomRef:!1,view:"",command:"",callback:!1,width:300,matchContains:!1,listSize:10,minChars:2,showAll:!1,showDescription:!1,_doHighlight:!1,_customHighlight:!1,_customItemFormat:!1,_customDescriptionFormat:!1,_filters:[],_init:function(selector,view,command,callback,config){this.selector=selector,this.view=view,this.command=command,this.callback=callback,config.width&&(this.width=config.width),"boolean"==typeof config.matchContains&&(this.matchContains=config.matchContains),config.listSize&&(this.listSize=parseInt(config.listSize,10)),config.minChars&&(this.minChars=parseInt(config.minChars,10)),"boolean"==typeof config.showAll&&(this.showAll=config.showAll),"boolean"==typeof config.showDescription&&(this.showDescription=config.showDescription),"boolean"==typeof config.highlight&&(this._doHighlight=config.highlight),"function"==typeof config.customHighlight&&(this._customHighlight=config.customHighLight),"function"==typeof config.itemFormat&&(this._customItemFormat=config.itemFormat),"function"==typeof config.descriptionFormat&&(this._customDescriptionFormat=config.descriptionFormat),"function"==typeof config.parse&&(this.parse=config.parse),"boolean"==typeof config.selectorIsDomRef&&(this.selectorIsDomRef=config.selectorIsDomRef),"string"==typeof config.query_string_param_name&&""!=$.trim(config.query_string_param_name)&&(this.queryStringParamName=config.query_string_param_name),config.params&&(this.params=config.params)},_build:function(){var t=this,options={};return options.width=this.width,options.position="fixed",options.max=this.listSize,options.matchContains=this.matchContains,options.minChars=this.minChars,options.selectFirst=!1,options.scrollHeight=450,options.queryStringParamName=this.queryStringParamName,options.formatItem=function(data,position,length,term){return t._formatItem(data,position,length,term)},options.highlight=function(label,term){return t._highlight(label,term)},options.extraParams=function(){return t._extraParams()},this.parse&&(options.parse=this.parse),options},_formatItem:function(data,position,length,term){if(this._filtered(data[2]))return!1;if("function"==typeof this._customItemFormat)var label=this._customItemFormat(data,position,length,term);else label=data[2];return this.showDescription&&(label+="function"==typeof this._customDescriptionFormat?this._customDescriptionFormat(data,position,length,term):'<br /><span class="description">'+data[3]+"</span>"),label},_filtered:function(value){for(var i=0;i<this._filters.length;i++)if(this._filters[i]==value)return!0;return!1},_highlight:function(label,term){return this._doHighlight?"function"==typeof this.custom_highlight?this.custom_highlight(label,term):label.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+term.replace(/([\^\$\(\)\[\]\{\}\*\.\+\?\|\\])/gi,"\\$1")+")(?![^<>]*>)(?![^&;]+;)","gi"),'<span class="ac_match">$1</span>'):label},_extraParams:function(){var params={};if(this.matchContains&&(params.contains="true"),this.params)if("function"==typeof this.params){var url_params=this.params();"object"==typeof url_params?$.each(url_params,function(key,param){params[key]=param}):params.param=this.params}else"object"==typeof this.params?$.each(this.params,function(key,param){params[key]=param}):params.param=this.params;return params.view=this.view,params.cmd=this.command,params.k=$.app.SESSION_KEY,params},_result:function(event,data){"function"==typeof this.callback&&this.callback(data)},filterValue:function(value,filter){for(var found=!1,i=0;i<this._filters.length;i++)if(value==this._filters[i]){if(!filter&&"undefined"!=typeof filter){delete this._filters[i];for(var j=i+1;j<this._filters.length;j++)this._filters[j-1]=this._filters[j];return this._filters.pop(),!0}found=!0}return!filter&&"undefined"!=typeof filter||found?!1:(this._filters.push(value),!0)}};autocompleter._init(selector,view,command,callback,config);var options=autocompleter._build(),mySelector=!1;return mySelector=options.selectorIsDomRef?selector:$(selector),mySelector.autocomplete("index.php",options).bind("result",function(event,data,label){autocompleter._result(event,data,label)}),autocompleter},visualizationReady:function(){this.debug&&console.debug("Google Visualization API ready"),this._visualization_ready=!0},isVisualizationReady:function(){return this._visualization_ready||google&&google.visualization&&(this._visualization_ready=!0),this._visualization_ready},getByKey:function(obj,key){for(var nav=obj,tokens=key.split("."),i=0;i<tokens.length;i++){if("object"!=typeof nav)return void 0;nav=nav[tokens[i]]}return nav}};$.extend({app:app}),Function.prototype.inherits=function(parent){return this.prototype&&(this.own_prototype=this.prototype,delete this.prototype),parent.constructor==Function?(this.prototype={},this.prototype=new parent,this.prototype.constructor=this,this.prototype.parent=parent.prototype):(this.prototype=parent,this.prototype.constructor=this,this.prototype.parent=parent),this.own_prototype&&(this.extend(this.own_prototype),delete this.own_prototype),this},Function.prototype.extend=function(object){for(var k in object)this.prototype[k]=object[k]},Array.prototype.reduce||(Array.prototype.reduce=function(fun){var len=this.length;if("function"!=typeof fun)throw new TypeError;if(0==len&&1==arguments.length)throw new TypeError;var i=0;if(arguments.length>=2)var rv=arguments[1];else for(;;){if(i in this){rv=this[i++];break}if(++i>=len)throw new TypeError}for(;len>i;i++)i in this&&(rv=fun.call(null,rv,this[i],i,this));return rv}),Function.prototype.method=function(name,func){return this.prototype[name]?void 0:(this.prototype[name]=func,this)},Array.method("sum",function(){return this.reduce(function(a,b){return a+b},0)}),Array.prototype.extend=function(a){var t=this;return a.map(function(e,i){return t.hasOwnProperty(i)?t[i]:e})},"indexOf"in Array.prototype||(Array.prototype.indexOf=function(find,i){void 0===i&&(i=0),0>i&&(i+=this.length),0>i&&(i=0);for(var n=this.length;n>i;i++)if(i in this&&this[i]===find)return i;return-1}),"lastIndexOf"in Array.prototype||(Array.prototype.lastIndexOf=function(find,i){for(void 0===i&&(i=this.length-1),0>i&&(i+=this.length),i>this.length-1&&(i=this.length-1),i++;i-->0;)if(i in this&&this[i]===find)return i;return-1}),"forEach"in Array.prototype||(Array.prototype.forEach=function(action,that){for(var i=0,n=this.length;n>i;i++)i in this&&action.call(that,this[i],i,this)}),"map"in Array.prototype||(Array.prototype.map=function(mapper,that){for(var other=new Array(this.length),i=0,n=this.length;n>i;i++)i in this&&(other[i]=mapper.call(that,this[i],i,this));return other}),"filter"in Array.prototype||(Array.prototype.filter=function(filter,that){for(var v,other=[],i=0,n=this.length;n>i;i++)i in this&&filter.call(that,v=this[i],i,this)&&other.push(v);return other}),"every"in Array.prototype||(Array.prototype.every=function(tester,that){for(var i=0,n=this.length;n>i;i++)if(i in this&&!tester.call(that,this[i],i,this))return!1;return!0}),"some"in Array.prototype||(Array.prototype.some=function(tester,that){for(var i=0,n=this.length;n>i;i++)if(i in this&&tester.call(that,this[i],i,this))return!0;return!1}),$.range=function(a,b){var r=[],i=0;if(b>=a)for(i=a;b>=i;i++)r.push(i);if(a>b)for(i=b;i>a;i--)r.push(i);return r},$.zeros=function(a){return $.range(1,a).map(function(){return 0})},View.prototype={parseHash:function(hash){var uri=$.app.parseHash(hash),pos=uri.view.indexOf("/");if(pos>0){var next=uri.view.indexOf("/",pos+1);next>0&&(pos=next,uri.id=uri.view.substr(pos+1),uri.view=uri.view.substr(0,pos))}else uri.id=!1;return uri},onHashChange:function(hash){var uri=this.parseHash(hash);return this._onHashChange(hash,uri)},_onHashChange:function(){return!1},onScrollToAnchor:function($element){$element.focus();var element_offset=$element.offset();window.scrollTo(element_offset.left,element_offset.top)},init:function(hash){var uri=this.parseHash(hash);this._uri=uri,this._view=uri.view,this._id=uri.id,this._uri_params=uri.params,this._controls={},this._init(hash)},_init:function(){$.app.debug&&$.app._throw("View does not implement _init function")},load:function(params){this._load(params)},_load:function(params){this.params=params},draw:function(html){if(this._onBeforeDraw(),this._canRedraw()){for(var selectors=this._getRedrawingSelectors(),can_redraw=!0,i=0;can_redraw&&i<selectors.length;i++)$(selectors[i]).length||(can_redraw=!1);if(delete selectors,can_redraw)return this._redrawn=!0,$.app.debug&&console.debug("Redrawing content"),void this._onDraw(!0)}this._redrawn=!1,$.app.debug&&console.debug("Drawing view"),$("#content").html(html),this._onDraw()},_canRedraw:function(){return!1},_getRedrawingSelectors:function(){return[]},_onBeforeDraw:function(){},_onDraw:function(){},hook:function(hash){var t=this;t._redrawn||($.app.debug&&console.debug("Hooking view"),this._hook(hash),t.updateReturnToParentView())},_hook:function(){$.app.debug&&$.app._throw("View does not implement _hook function")},inject:function(model){$.app.debug&&console.debug("Injecting model"),this._inject(model)},_inject:function(){$.app.debug&&$.app._throw("View does not implement _inject function")},close:function(hash){var canClose=this._canClose(hash);return canClose||this._onCancelClose(),canClose},_canClose:function(){return!0},_onCancelClose:function(){$.app.debug&&$.app._throw("View does not implement _onCancelClose function")},pushParentView:function(view_name){var t=this,ret="";return t._uri_params.parent_view&&(ret+=t._uri_params.parent_view+"|"),ret+=view_name},popParentView:function(include_id){"undefined"==typeof include_id&&(include_id=!0);var t=this;if(!t._uri_params.parent_view)return!1;var views=t._uri_params.parent_view.split("|"),parent_view=views.pop(),url="";return url=include_id?"#"+parent_view+"/"+t._id:"#"+parent_view,views.length>0&&(url+="&parent_view="+views.join("|")),url},getParentView:function(){var t=this;if(!t._uri_params.parent_view)return!1;var views=t._uri_params.parent_view.split("|");return views.pop()},updateReturnToParentView:function(){var t=this,parent_view=t.getParentView();if(parent_view){var translate_key="BACK_TO_"+parent_view.toUpperCase().split("/").splice(0,2).join("_"),label=$.app._(translate_key);$(".hook_back_to_parent_view").text(label)}}},EditView.prototype={init:function(hash){this._wasClosing=!1,View.prototype.init.call(this,hash)},changed:function(){$.app.debug&&console.debug("changed"),this._modified||(this._modified=!0)},softModified:function(){$.app.debug&&console.debug("soft modified"),this._soft_modified||(this._soft_modified=!0)},hook:function(hash){if(!this._redrawn){$.app.debug&&console.debug("Hooking view");var t=this;$("#content form").delegate(":input[name]:not(.no-form-change)","change",function(){t.changed()}),$("#content form").delegate(":input[type=text]:not(.no-form-change)","keypress",function(){t.changed()}),$(".number:not(.positive)").number(),$(".number.positive").number({positive:!0}),this._hook(hash),t.updateReturnToParentView(),"Microsoft Internet Explorer"==navigator.appName&&($(window).data("beforeunload",window.onbeforeunload),$(document).on("mouseenter",'a[href^="javascript:"]',function(){window.onbeforeunload=null}).on("mouseleave",'a[href^="javascript:"]',function(){window.onbeforeunload=$(window).data("beforeunload")})),window.onbeforeunload=function(){return t._modified?$.app._("SAVE_CHANGES_MESSAGE"):void 0}}},inject:function(model){$.app.debug&&console.debug("Injecting model"),this._soft_modified=!1,this._inject(model),this._modified=!1},close:function(hash){if($("#edit_form").off("**"),this._modified&&this._can_save)return this._wasClosing=!0,this.showSaveDialog(),!1;var canClose=this._canClose(hash);return canClose?this._onClose():this._onCancelClose(),canClose},showSaveDialog:function(){var t=this;$.app.showModalDialog("<h2>"+$.app._("SAVE_CHANGES_TITLE")+"</h2><p>"+$.app._("SAVE_CHANGES_MESSAGE")+'</p><p class="submit"><input type="submit" id="hook_do_save_changes" value="'+$.app._("YES")+'" /> <input type="submit" id="hook_do_not_save_changes" value="'+$.app._("NO")+'" /> <a href="javascript:void(0);" id="hook_cancel_save_changes">'+$.app._("CANCEL")+"</a></p>","normal",function(){$("#hook_do_save_changes").safeClick(function(){t.hideSaveDialog("save")}),$("#hook_do_not_save_changes").safeClick(function(){t.hideSaveDialog("resume")}),$("#hook_cancel_save_changes").safeClick(function(){t.hideSaveDialog()})})},hideSaveDialog:function(action){var t=this;$.app.hideModalDialog("normal",function(){if("save"==action){var saved=t.save(function(){t.resume()});saved||t.stop()}else"resume"==action?(window.onbeforeunload=function(){},t._canClose()?t.resume():(t._onCancelClose(),t.stop())):t.stop()})},save:function(hash,success_callback,error_callback,stay){if(!this._can_save)return this._saveRedirect(hash,stay);if(!this._canSave())return this._onCancelSave(),!1;if(this._wasClosing&&!this._canClose())return this._onCancelClose(),!1;if("function"==typeof hash&&("function"==typeof success_callback&&(error_callback=success_callback),success_callback=hash,hash=!1),this._wasClosing&&(hash=$.app.getResumeHash()),!this._modified&&!this._soft_modified)return"function"==typeof success_callback&&(success_callback({},!1),delete success_callback),this._saveRedirect(hash,stay),!0;$("input[type=submit],input[type=button]").prop("disabled",!0);var t=this;$.app.showOverlay();var params=this._onSave();return window.onbeforeunload=function(){},$.ajax({url:"index.php?k="+$.app.SESSION_KEY+"&view="+this._view+"&cmd=save&id="+this._id+params,type:"POST",data:this._saveBuildPost(),dataType:"json",success:function(data){return data||(data={}),data.data&&(data=data.data),$.app.hideOverlay(),$("input[type=submit],input[type=button]").prop("disabled",!1),data.validation_errors&&data.validation_errors.length?void $.each(data.validation_errors,function(i,err){$("#"+err.field).hintError(err.message)}):"error"==data.status?($.app.debug&&console.debug("Save failed with error : "+data.message),void("function"==typeof error_callback?(error_callback(data),delete error_callback):$.app.showError($.app._("SAVE_ERROR_OCCURED")))):(t._modified=!1,t._afterSave(),"function"==typeof success_callback&&(success_callback(data,!0),delete success_callback),void t._saveRedirect(hash,stay))},error:function(xhr,status,error){t._saveErrorHandler(xhr,status,error,error_callback)}}),!0
},_saveRedirect:function(hash,stay){stay||(this._onClose(),"string"==typeof hash?$.app.goTo(hash):$.app.goBack())},_saveErrorHandler:function(xhr,status,error,error_callback){return $.app.validateXHR(xhr)?($.app.debug&&console.debug("error..."),"function"==typeof error_callback&&(error_callback(!1),delete error_callback),$.app.hideOverlay(),$("input[type=submit]").prop("disabled",!1),void $.app.showError($.app._("SAVE_ERROR_OCCURED"))):!1},_saveBuildPost:function(){return"&model="+encodeURIComponent($.toJSON(this.createModel()))},_canSave:function(){return $.app.debug&&$.app._throw("View does not implement _canSave function"),!0},_onCancelSave:function(){},_onSave:function(){return""},_afterSave:function(){},_onClose:function(){},createModel:function(){var model={};return $("form input[name],select[name],textarea[name]").each(function(index,element){var value=element.value;"radio"==element.type||"checkbox"==element.type?element.checked&&(model[element.name]="on"==value?"YES":value):model[element.name]=$(element).hasClass("money")?$(element).moneyVal():$(element).hasClass("percent")?$.app.parseFloat(value.replace("%","")):$(element).hasClass("number")?$.app.parseFloat(value):value}),this._onCreateModel&&(model=this._onCreateModel(model)),model=this._removeNullValue(model)},_onCreateModel:function(model){return model},alternateCreateModel:function(model){var alternateModel={};for(var key in model)if(model.hasOwnProperty(key)){var path=key.split("[").map(function(t){return t.replace("]","")}),element=path.reduceRight(function(previous,current){var n={};return n[current]=previous,n},model[key]);$.extend(!0,alternateModel,element)}return alternateModel},_removeNullValue:function(model){if("object"==typeof model)for(var index in model)model[index]=this._removeNullValue(model[index]);else model||(model="");return model},cancel:function(hash){$("input[type=submit],input[type=button]").prop("disabled",!0),this._modified=!1,"undefined"==typeof hash&&(hash=$.app.navigateBackTo("")),$("input[type=submit],input[type=button]").prop("disabled",!1),hash?$.app.navigateBackTo(hash):history.back()},resume:function(){$.app.resume(!1)},stop:function(){$.app.resume(!0)}},EditView.inherits(View),$.app.lang="fr";
//# sourceMappingURL=application.min.map