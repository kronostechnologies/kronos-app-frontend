!function(e){function t(i){if(n[i])return n[i].exports;var o=n[i]={exports:{},id:i,loaded:!1};return e[i].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}var o=n(1),a=i(o),r=n(2),s=i(r),u=n(3),l=i(u),h=n(4),c=i(h);window.BaseApplication=n(5),window.View=n(7),window.EditView=n(8);var p=new BaseApplication;p.lang="fr",p.autocompleter=a.default,p.sprintf=s.default,p.date=new l.default,jQuery.extend({app:p}),jQuery.fn.extend(c.default),Date.prototype.getDayOfYear=function(){var e=new Date(this.getFullYear(),0,1);return Math.ceil((this-e)/864e5)},Date.prototype.getDaysInYear=function(){var e=new Date(this.getFullYear(),0,1),t=new Date(this.getFullYear(),11,31);return Math.ceil((t-e)/864e5+1)},String.prototype.htmlEntity=function(){return $.app.htmlEntity(this.toString())},String.prototype.nl2br=function(){return this.replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g,"$1<br />$2")}},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),a=function(){function e(t,i,o,a,r){n(this,e);var s=this;this.view=i,this.callback=a,this._filters=[],o.constructor===Object?(this.command=o.command,this.handler=o.handler,this.action=o.action):this.command=o,r.width?this.width=r.width:this.width=300,"boolean"==typeof r.matchContains?this.matchContains=r.matchContains:this.matchContains=!1,r.listSize?this.listSize=parseInt(r.listSize,10):this.listSize=10,r.minChars?this.minChars=parseInt(r.minChars,10):this.minChars=2,"boolean"==typeof r.showAll?this.showAll=r.showAll:this.showAll=!1,"boolean"==typeof r.showDescription?this.showDescription=r.showDescription:this.showDescription=!1,"boolean"==typeof r.highlight?this._doHighlight=r.highlight:this._doHighlight=!1,"function"==typeof r.customHighlight?this._customHighlight=r.customHighLight:this._customHighlight=!1,"function"==typeof r.itemFormat?this._customItemFormat=r.itemFormat:this._customItemFormat=!1,"function"==typeof r.descriptionFormat?this._customDescriptionFormat=r.descriptionFormat:this._customDescriptionFormat=!1,"function"==typeof r.parse&&(this.parse=r.parse),"string"==typeof r.query_string_param_name&&""!==$.trim(r.query_string_param_name)&&(this.queryStringParamName=r.query_string_param_name),r.params?this.params=r.params:this.params={},"boolean"==typeof r.selectorIsDomRef?this.selectorIsDomRef=r.selectorIsDomRef:this.selectorIsDomRef=!1,this.selectorIsDomRef?this.$selector=t:this.$selector=$(t),this.$selector.autocomplete("index.php",this._getAutocompleteOptions()).bind("result",function(e,t,n){s._result(e,t,n)})}return o(e,[{key:"_getAutocompleteOptions",value:function(){var e=this,t={};return t.width=this.width,t.position="fixed",t.max=this.listSize,t.matchContains=this.matchContains,t.minChars=this.minChars,t.selectFirst=!1,t.scrollHeight=450,t.queryStringParamName=this.queryStringParamName,t.formatItem=function(t,n,i,o){return e._formatItem(t,n,i,o)},t.highlight=function(t,n){return e._highlight(t,n)},t.extraParams=e._extraParams(),this.parse&&(t.parse=this.parse),t}},{key:"_formatItem",value:function(e,t,n,i){if(this._filtered(e[2]))return!1;var o=void 0;return o="function"==typeof this._customItemFormat?this._customItemFormat(e,t,n,i):e[2],this.showDescription&&(o+="function"==typeof this._customDescriptionFormat?this._customDescriptionFormat(e,t,n,i):'<br /><span class="description">'+e[3]+"</span>"),o}},{key:"_filtered",value:function(e){for(var t=0;t<this._filters.length;t++)if(this._filters[t]==e)return!0;return!1}},{key:"_highlight",value:function(e,t){return this._doHighlight?"function"==typeof this.custom_highlight?this.custom_highlight(e,t):e.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+t.replace(/([\^\$\(\)\[\]\{\}\*\.\+\?\|\\])/gi,"\\$1")+")(?![^<>]*>)(?![^&;]+;)","gi"),'<span class="ac_match">$1</span>'):e}},{key:"_extraParams",value:function(){var e={};if(this.matchContains&&(e.contains="true"),this.params)if("function"==typeof this.params){var t=this.params();"object"==("undefined"==typeof t?"undefined":i(t))?$.each(t,function(t,n){e[t]=n}):e.param=this.params}else"object"==i(this.params)?$.each(this.params,function(t,n){e[t]=n}):e.param=this.params;return e.view=this.view,e.cmd=this.command,e.k=$.app.SESSION_KEY,""!==this.handler&&(e.handler=this.handler),""!==this.action&&(e.action=this.action),e}},{key:"_result",value:function(e,t,n){"function"==typeof this.callback&&this.callback(t)}},{key:"filterValue",value:function(e,t){for(var n=!1,i=0;i<this._filters.length;i++)if(e==this._filters[i]){if(!t&&"undefined"!=typeof t){delete this._filters[i];for(var o=i+1;o<this._filters.length;o++)this._filters[o-1]=this._filters[o];return this._filters.pop(),!0}n=!0}return!(!t&&"undefined"!=typeof t||n)&&(this._filters.push(e),!0)}}]),e}();t.default=a},function(e,t){"use strict";function n(e,t){t?e.sign="":e.sign=e.negative?"-":e.sign;var n=e.min-e.argument.length+1-e.sign.length,i=new Array(n<0?0:n).join(e.pad);return e.left?"0"==e.pad||t?e.sign+e.argument+i.replace(/0/g," "):e.sign+e.argument+i:"0"==e.pad||t?e.sign+i+e.argument:i+e.sign+e.argument}function o(){if("undefined"==typeof arguments)return null;if(arguments.length<1)return null;if("string"!=typeof arguments[0])return null;if("undefined"==typeof RegExp)return null;for(var e=arguments[0],t=new RegExp(/(%([%]|(\-)?(\+|\x20)?(0)?(\d+)?(\.(\d)?)?([bcdfosxX])))/g),o=[],a=[],r=0,s=0,u=0,l=0,h="",c=null;c=t.exec(e);)c[9]&&(r+=1),s=l,u=t.lastIndex-c[0].length,a[a.length]=e.substring(s,u),l=t.lastIndex,o[o.length]={match:c[0],left:!!c[3],sign:c[4]||"",pad:c[5]||" ",min:c[6]||0,precision:c[8],code:c[9]||"%",negative:parseInt(arguments[r])<0,argument:String(arguments[r])};if(a[a.length]=e.substring(l),0===o.length)return e;if(arguments.length-1<r)return null;c=null;for(var p=0;p<o.length;p++){var d=void 0;"%"==o[p].code?d="%":"b"==o[p].code?(o[p].argument=String(Math.abs(parseInt(o[p].argument,10)).toString(2)),d=n(o[p],!0)):"c"==o[p].code?(o[p].argument=String(String.fromCharCode(parseInt(Math.abs(parseInt(o[p].argument,10))))),d=n(o[p],!0)):"d"==o[p].code?(o[p].argument=String(Math.abs(parseInt(o[p].argument,10))),d=n(o[p])):"f"==o[p].code?(o[p].argument=String(Math.abs(parseFloat(o[p].argument,10)).toFixed(o[p].precision?o[p].precision:6)),d=n(o[p])):"o"==o[p].code?(o[p].argument=String(Math.abs(parseInt(o[p].argument,10)).toString(8)),d=n(o[p])):"s"==o[p].code?(o[p].argument=o[p].argument.substring(0,o[p].precision?o[p].precision:o[p].argument.length),d=n(o[p],!0)):"x"==o[p].code?(o[p].argument=String(Math.abs(parseInt(o[p].argument,10)).toString(16)),d=n(o[p])):"X"==o[p].code?(o[p].argument=String(Math.abs(parseInt(o[p].argument,10)).toString(16)),d=n(o[p]).toUpperCase()):d=o[p].match,h+=a[p],h+=d}return h+=a[i]}Object.defineProperty(t,"__esModule",{value:!0}),t.default=o},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),a=function(){function e(){n(this,e),this._date_regex=new RegExp(/^([1-9]{1}\d{3})-{0,1}([0]{1}[1-9]{1}|[1]{1}[0-2]{1})-{0,1}([0-2]{1}[1-9]{1}|[1-2]{1}[0]{1}|[3]{1}[0-1]{1})(| (\d{2}):(\d{2}):(\d{2})(|\.\d+))$/)}return o(e,[{key:"isDate",value:function(e){var t=this._date_regex.exec(e);return null!=t}},{key:"parse",value:function(e){if(null===e)return!1;if("object"==("undefined"==typeof e?"undefined":i(e))){if("undefined"==typeof e.date)return e;e=e.date}var t=this._date_regex.exec(e);if(null==t)return $.app.debug&&console.debug('Could not parse date "'+e+'"'),!1;var n=new Date;return n.setDate(1),n.setYear(t[1]),n.setMonth(parseInt(t[2],10)-1),n.setDate(t[3]),t[4]?(n.setHours(t[5]),n.setMinutes(t[6]),n.setSeconds(t[7])):(n.setHours("0"),n.setMinutes("0"),n.setSeconds("0")),n}},{key:"format",value:function(e,t){if(e=this.parse(e),!e)return"";if("undefined"==typeof t&&(t="long"),"input"==t)return moment(e).format("YYYY-MM-DD");if("long"==t)return moment(e).format("LL");if("longtime"==t)return moment(e).format("LLL");if("short"==t)return"en"===$.app.lang?moment(e).format("MMMM D"):moment(e).format("D MMMM");if("longabbrmonth"==t)return moment(e).format("ll");if("time"==t){var n="LT";return $.isPlainObject($.app.config)&&"string"==typeof $.app.config.time_format&&(n="24h"===$.app.config.time_format?"HH:mm":"hh:mm A"),moment(e).format(n)}return"dashboard"==t?"en"===$.app.lang?moment(e).format("dddd, MMMM D"):moment(e).format("dddd, D MMMM"):($.app.debug&&console.debug('Unknown date format "'+t+'"'),"")}},{key:"getMonthName",value:function(e){"undefined"==typeof e&&0===arguments.length&&(e=moment().month());var t=moment.months(e);return $.isArray(t)?void $.app._throw('Unknown month "'+e+'"'):t}},{key:"getAge",value:function(e,t){return e=this.parse(e),t=this.parse(t)||new Date,parseInt(moment(t).diff(e,"years"))}},{key:"getFakeBirthdate",value:function(e){return e=parseInt(e),e?moment().subtract(e,"years").startOf("year").format("YYYY-MM-DD"):""}},{key:"getInsuranceAge",value:function(e){var t=this.parse(e);if(t){var n=this.getAge(e),i=new Date,o=new Date,a=new Date;return i.setMonth(t.getMonth()),i.setDate(t.getDate()),a.setMonth(t.getMonth()),a.setDate(t.getDate()),o<i&&i.setFullYear(i.getFullYear()-1),a.setFullYear(i.getFullYear()+1),Math.abs(o-a)<Math.abs(o-i)&&n++,t=null,i=null,o=null,a=null,n}return 0}},{key:"getYear",value:function(e){return e=this.parse(e),e?moment(e).year():0}}]),e}();t.default=a},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.jQueryExtend={alternateText:function(e,t){return this.text(e&&""!==e?e:t),this},numberText:function(e){var t=self.formatNumber(e);return this.text(""===t?"0":t),this},moneyText:function(e){return this.text(self.formatMoney(e)),this},dateText:function(e){return this.text(self.date.format(e)),this},durationVal:function(e){var t=void 0;if(isFinite(e)){var n=e<0?"-":"",i=Math.floor(Math.abs(e)/12),o=Math.abs(e)-12*i;t=n+(0===i?"":(1===i?$.app._("YEARD").replace("%{years}",i):$.app._("YEARSD").replace("%{years}",i))+" ")+(0===o?"":1===o?$.app._("MONTHD").replace("%{months}",o):$.app._("MONTHSD").replace("%{months}",o))}else t="";return this.val(t),this},booleanText:function(e){return e="YES"===e?$.app._("YES"):"NO"===e?$.app._("NO"):"-",this.text(e),this},dateVal:function(e){return this.val(self.date.format(e,"input")),this},safeClick:function(e){return this.click(function(t){var n=this;this.__clicked?$.app.debug&&console.debug("catched double click"):!function(){n.__clicked=!0,e.call(n,t);var i=n;setTimeout(function(){i.__clicked=!1},500)}()}),this},numberVal:function(e,t){if(arguments.length>0)return $(this).val(self.formatNumber(e,t));var n=$.app.parseFloat(this.val());return $(this).hasClass("positive")&&$(this).hasClass("number")&&n<0?0:n},number:function(e){return $(this).each(function(){$(this).addClass("number"),$(this).val($.app.formatNumber($(this).val(),e)),$(this).blur(function(){$(this).val($.app.formatNumber($(this).val(),e))})})},moneyVal:function(e,t){if(arguments.length>0)return $(this).hasClass("money")?($(this).data("val",$.app.parseFloat(e.replace("$",""))),$(this).val(self.formatMoney(e,t))):$(this).val(self.formatMoney(e,t));if($(this).hasClass("money")){var n=$(this).data("val");return $(this).hasClass("positive")&&n<0?0:n}return $.app.parseFloat($(this).val().replace("$",""))},money:function(e){return $(this).each(function(){var t=$(this);t.addClass("money"),t.focus(function(){return $(this).val($(this).data("val")),this}),$(this).click(function(){$(this).select()}),$(this).blur(function(){var t=void 0,n=$(this).val();return e&&e.canBeNull&&(""===n||null===n)?t="":(t=$.app.parseFloat(n.replace("$","")),e&&e.true_precision&&(t=e.rounded?Math.round(t*Math.pow(10,e.true_precision))/Math.pow(10,e.true_precision):Math.floor(t*Math.pow(10,e.true_precision))/Math.pow(10,e.true_precision))),$(this).data("val",t),$(this).val($.app.formatMoney(t,e)),this}),""!==t.val()&&t.blur()})},percentVal:function(e,t){if(arguments.length>0)return $(this).val(self.formatPercent(e,t));var n=$.app.parseFloat(this.val().replace("%",""));return $(this).hasClass("positive")&&$(this).hasClass("percent")&&n<0?0:n},percent:function(e){return $(this).each(function(){$(this).addClass("percent"),$(this).val($.app.formatPercent($(this).val(),e)),$(this).blur(function(){$(this).val($.app.formatPercent($(this).val(),e))})})},SIN:function(){return $(this).each(function(){$(this).val($.app.formatSIN($(this).val())),$(this).blur(function(){this.value=$.app.formatSIN($(this).val())})})},datepickerInput:function(e){return $(this).each(function(){var t=$(this),n=t.next(".btn.calendar");if(0===t.next(".btn.calendar").length&&(n=$('<a href="javascript:void(0);" class="btn calendar" tabindex=-1><span class="icon"></span></a>')),t.after(n),$.browser.msie&&t.before($('<div class="clear"></div>')),t.width()&&t.css("width","-="+n.outerWidth(!0)).attr("autocomplete","off"),"undefined"!=typeof e){var i=$.extend({dateFormat:"yy-mm-dd",onClose:function(e){try{var t=$.datepicker.parseDate("yymmdd",e);$(this).val($.datepicker.formatDate("yy-mm-dd",t))}catch(t){$(this).val(e)}}},e);t.datepicker(i)}else t.datepicker({dateFormat:"yy-mm-dd",onClose:function(e){try{var t=$.datepicker.parseDate("yymmdd",e);$(this).val($.datepicker.formatDate("yy-mm-dd",t))}catch(t){$(this).val(e)}}});n.bind("click",function(e){e.preventDefault(),t.datepicker("widget").is(":hidden")&&t.datepicker("show")})})},hint:function(e,t){var n=Math.max(parseInt(t,10),200);return $(this).wrap('<span class="hinted"></span>').after('<span class="hint" style="width: '+n+"px; right: -"+(n+50)+'px;">'+e+'<span class="hint-pointer sprite">&nbsp;</span></span>').focus(function(){var e=this;e._focus_timeout=setTimeout(function(){$(e).next(".hint").fadeIn()},1e3)}).blur(function(){this._focus_timeout&&clearTimeout(this._focus_timeout),$(this).next(".hint").fadeOut()}).keypress(function(){this._focus_timeout&&clearTimeout(this._focus_timeout),$(this).next(".hint").fadeOut()})},unhint:function(){return $(this).parent().hasClass("hinted")?($(this).next(".hint").remove(),$(this).unwrap()):$(this).parent().find(".hinted")&&$(this).next(".hint").remove(),this},hintError:function(e,t,n){var i=void 0,o=$(this);o.combobox&&void 0!==o.combobox("instance")&&(o=o.combobox("instance").input,o.data("isCombobox",!0));var a=o;i=a.data("blur-field")?$("#"+a.data("blur-field")):a;var r=["hinted"];return o.data("is-textbox")&&(a=o.next().is(".hinted")?o.next().find(".textboxlist"):o.next(".textboxlist"),a.find(".textboxlist-bit-box-deletable").blur(function(){a.next(".hint").fadeOut()}).focus(function(){a.next(".hint").fadeIn()}).change(function(){$(a).handleHintErrorChange()})),(o.data("is-textbox")||a.hasClass("textboxlist"))&&(r.push("contain-textbox"),i=a.find(".textboxlist-bit-editable-input")),a.unhint(),a.addClass("save_warning"),a.data("no-hinted-span")||a.wrap('<span class="'+r.join(" ")+'"></span>'),a.after('<span class="hint">'+e+'<span class="hint-pointer sprite">&nbsp;</span></span>'),i.blur(function(){a.next(".hint").fadeOut()}).focus(function(){a.next(".hint").fadeIn()}).change(function(){$(a).handleHintErrorChange()}),a.data("hint",a.next(".hint")),a.setHintErrorWidth(t),a.setHintErrorPosition(),a.data("extra-hint-classes")&&a.parents(".hinted").addClass(a.data("extra-hint-classes")),a.data("hint").click(function(e){e.preventDefault(),e.stopPropagation(),$(this).fadeOut()}),n||a.data("hint").fadeIn(),a},handleHintErrorChange:function(){$(this).unhint().removeClass("save_warning")},setHintErrorWidth:function(e){var t=Math.max(parseInt(e,10),200);return $(this).next(".hint").css({width:t}),$(this)},setHintErrorPosition:function(){var e=-(parseInt($(this).data("hint").css("width"))+50);return $(this).data("hint").css({right:e}),$(this)},signal:function(e){return e=parseInt(e),e<=0&&(e=500),$(this).each(function(){$(this).addClass("signal");var t=this;setTimeout(function(){$(t).removeClass("signal")},e)})},checkVal:function(){if(arguments.length>0){var e=!1;return"YES"!=arguments[0]&&arguments[0]!==!0||(e=!0),this.prop("checked",e),this}return this.val()},toggleDisabled:function(e,t){void 0===t&&(t=!0),e?(this.attr("disabled","disabled"),t&&this.addClass("disabled")):(this.removeAttr("disabled"),t&&this.removeClass("disabled"))},getClasses:function(){var e=[];return $(this).each(function(){var t=$(this).attr("class").split(" ");for(var n in t){var i=!1;for(var o in e)e[o]==t[n]&&(i=!0);i||e.push(t[n])}}),e}}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),l=n(6),h=i(l),c=function(e){function t(){o(this,t);var e=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.view_fetching=!1,e.debug=!1,e.sendErrors=!1,e.sendErrorsOnUnload=!1,e.silent=!1,e.trace_retirement=!1,e._errors=[],e.ajaxQueryLoading=!1,e.pingInterval=!1,e.messages=!1,e.JS_PATH="/",e.IMG_PATH="/",e.VIRTUALPATH="/",e.SESSION_KEY=!1,e._is_observing_hash=!1,e._hash_changed_while_not_observing=!0,e.hash=!1,e._resume_hash="",e._history=[],e.userName="",e.cpanelUserName="",e.userVersion=0,e.menus=!1,e.views=!1,e.default_view="",e.default_goal_death="",e.default_goal_disability="",e.fna_expiration=365,e.currentView=!1,e._view_cache={},e._loadingDelay=3e3,e._loadingTimeout=0,e._view_objects={},e._messages={},e.emailRegex=/^[a-zA-Z0-9!#$%&'*+\-\/=?^_`{|}~]+(?:\.[a-zA-Z0-9!#$%&'*+\-\/=?^_`{|}~]+)*@[a-zA-Z0-9-]+(\.[a-zA-Z0-9-]+)*$/,e.currencyRegex=/^[0-9.,\s]+$/,e.percentageRegex=/^[0-9.,]+$/,e._ongoing_xhrs=[],e.unmounts=[],e}return r(t,e),u(t,[{key:"init",value:function(){var e=this;window.console&&window.console.firebug||(window.console?window.console.debug||(window.console.debug=function(e){window.console.log(e)}):window.console={log:function(){},debug:function(){}}),$(document).ajaxStart(function(){e.ajaxQueryLoading=!0}),$(document).ajaxStop(function(){e.ajaxQueryLoading=!1}),this.pingInterval&&setInterval(function(){e.ajaxQueryLoading||e.get("CPanel/View","ping","",function(){console.debug("session is still alive")},!1,function(){console.debug("got an error while doing a ping ?")})},this.pingInterval),this._iPad="iPad"===navigator.userAgent.match(/iPad/),this._iPod="iPod"===navigator.userAgent.match(/iPod/),this._iPhone="iPhone"===navigator.userAgent.match(/iPhone/),this._blackberry="BlackBerry"===navigator.userAgent.match("/BlackBerry/")&&$.browser.webkit,this._palm_pre="webOS"===navigator.userAgent.match("/webOS/")&&$.browser.webkit,this._mobile=this._iPad||this._iPod||this._iPhone||this._blackberry||this._palm_pre,this._webkit=$.browser.webkit,this._opera=$.browser.opera,this._msie=$.browser.msie,this._mozilla=$.browser.mozilla,window.onerror=function(t,n,i){return"undefined"!=typeof window.UEInfo&&(window.errors.push(arguments),window.UEInfo.run()),e._onError(t,n,i)},window.onbeforeunload=function(){return e._beforeUnload()},window.name.match(/^GUID-/)||(window.name="GUID-"+$.app.generateGUID()),$("#hook_confidentiality_policy,#hook_usage_policy").safeClick(function(){$.app.showMessage($(this).text(),$.app._("AVAILABLE_SOON"))}),$.ajaxSetup({beforeSend:function(t){if(!this.crossDomain){var n=e.getXSRFHeaders();$.each(n,function(e,n){t.setRequestHeader(e,n)})}}}),this._init()}},{key:"_init",value:function(){}},{key:"configure",value:function(e){if(e.debug&&(this.debug=!0),e.sendError&&(this.sendErrors=!0),e.sendErrorsOnUnload&&(this.sendErrorsOnUnload=!0),e.silent&&(this.silent=!0),e.trace_retirement&&(this.trace_retirement=!0),e.jqueryui&&e.jqueryui.startingday&&(this.startingDay=e.jqueryui.startingday),this.JS_PATH=e.JS_PATH,this.IMG_PATH=e.IMG_PATH,this.VIRTUALPATH=e.VIRTUALPATH,this.SESSION_KEY=e.SESSION_KEY,this.replaced_session_key=!1,this._xsrf_cookie_name=e.xsrf_cookie_name,this._xsrf_header_name=e.xsrf_header_name,this.checkStoredSession(),!e.application_version)throw this._throw("Applicaiton version not defined in configuration",!0);if(this._application_version=e.application_version,"object"!==s(e.user))throw"No user info in application configuration";e&&e.sentry&&(Raven.config("https://"+e.sentry.key+"@app.getsentry.com/"+e.sentry.project,{release:e.application_version}).install(),Raven.setTagsContext({version:e.application_version}),Raven.setUserContext({email:e.user.email,id:e.user.id,name:e.user.name}),Raven.setExtraContext({transaction:e.kronos_transaction_id})),this._configure(e),this.setUserConfig(e.user);for(var t in this.views){var n=this.views[t];"1"===n.default&&(this.default_view=t)}}},{key:"_configure",value:function(){}},{key:"getApplicationVersion",value:function(){return this._application_version}},{key:"getXSRFToken",value:function(){if(this._xsrf_cookie_name){var e=$.cookie(this._xsrf_cookie_name);return"undefined"!=typeof e&&e}return!1}},{key:"getXSRFHeaders",value:function(){var e=this,t={},n=e.getXSRFToken();return e._xsrf_header_name&&(t[e._xsrf_header_name]=n),t}},{key:"getXSRFData",value:function(){var e=this,t={},n=e.getXSRFToken();return e._xsrf_cookie_name&&(t[e._xsrf_cookie_name]=n),t}},{key:"setUserConfig",value:function(e){var t=this;t.userVersion=e.version,t.userName=e.name,t.userEmail=e.email,t.userType=e.type,t.menus=e.menus,t.views=e.views,t.userIsAssumed=e.assumed,t.userIsCpanelAssumed=e.cpanel_assumed,t.cpanelUserName=e.cpanel_user_name,t.setLocale(e.locale),t._setUserConfig(e),this._buildHeader()}},{key:"_setUserConfig",value:function(){}},{key:"setLocale",value:function(e){if(this.locale!=e){this.locale=e,e.indexOf("fr")!=-1?this.lang="fr":this.lang="en",moment.locale(this.lang),this._messages[this.lang]||$.ajax({url:this.JS_PATH+this.lang+".js",data:!1,dataType:"script",async:!1,cache:!0});var t=$.extend($.datepicker.regional[this.lang],{dateFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0,gotoCurrent:!0,yearRange:"-90:+10"});this.startingDay&&(t.firstDay=this.startingDay),$.datepicker.setDefaults(t),$(".localeBound").trigger("setLocaleEvent"),this._setLocale(e)}}},{key:"_",value:function(e){if(!this._messages[this.lang])return e;var t=this._messages[this.lang][e];return t?t:e}},{key:"start",value:function(){this.hook();var e=this;window.onhashchange=function(){e._is_observing_hash?e._checkHash():e._hash_changed_while_not_observing=!0},this._observe(),this._checkGears()&&this._initGears()}},{key:"hook",value:function(){var e=this;"function"==typeof this._hook&&this._hook(),$(".hook_question_comments").click(function(){e.showQuestionCommentDialog()})}},{key:"loadMessages",value:function(e,t){this._messages[e]=t}},{key:"_beforeUnload",value:function(e){(this.sendErrors||this.sendErrorsOnUnload)&&this._sendErrors(),this.abortOngoingXHR()}},{key:"_throw",value:function(e,t){return $.toJSON({message:e,type:t?"fatal":"error"})}},{key:"_onError",value:function(e,t,n){this.debug&&console.debug(e+" ("+t+":"+n+")");try{var i=$.secureEvalJSON(e.replace("uncaught exception: ",""));"fatal"==i.type&&this._showFatalError(i.message),e=i.message,i=null}catch(e){}return this.sendErrors&&(this._errors.push({description:e,page:t,line:n}),this._errors.length>10&&this._sendErrors()),this.silent}},{key:"_sendErrors",value:function(){var e=this;if(this._errors.length>0){for(var t=[],n=0;n<this._errors.length;n++)for(var i in this._errors[n])t.push("error["+n+"]["+i+"]="+encodeURIComponent(this._errors[n][i]));$.ajax({async:!1,url:"index.php?k="+e.SESSION_KEY+"&action=error&"+t.join("&")}),delete this._errors,this._errors=[]}}},{key:"_showNavigationError",value:function(){$.app.showModalDialog("<h2>"+$.app._("NAVIGATION_ERROR")+"</h2>\t\t\t\t\t\t\t\t\t\t\t<p>\t\t\t\t\t\t\t\t\t\t\t\t<strong>"+$.app._("INVALID_PAGE_REQUEST")+'</strong>\t\t\t\t\t\t\t\t\t\t\t\t<br />\t\t\t\t\t\t\t\t\t\t\t</p>\t\t\t\t\t\t\t\t\t\t\t<p class="submit">\t\t\t\t\t\t\t\t\t\t\t\t<input type="submit" id="hook_create_error_close" value="'+$.app._("OK")+'" />\t\t\t\t\t\t\t\t\t\t\t</p>',"fast",function(){$("#hook_create_error_close").safeClick(function(){$.app.hideModalDialog("fast"),$.app._stopObservation(),$.app.hash=$.app.stepBack(),$.app._history.push($.app.hash),$.app._observe()})})}},{key:"_showFatalError",value:function(e){var t=this;this.showModalDialog("<h2>"+$.app._("ERROR")+"</h2>\t\t\t\t\t\t\t<p>\t\t\t\t\t\t\t\t<strong>"+$.app._("FATAL_ERROR_OCCURED")+"</strong>\t\t\t\t\t\t\t\t<br />\t\t\t\t\t\t\t\t"+$.app._("CONTACT_SUPPORT_PERSIST")+'\t\t\t\t\t\t\t</p>\t\t\t\t\t\t\t<p class="submit">\t\t\t\t\t\t\t\t'+$.app._("FATAL_ERROR__YOU_CAN")+" <a href=\"javascript:$.app._hideFatalError('reload');\">"+$.app._("FATAL_ERROR__RELOAD_PAGE")+"</a> "+$.app._("OR")+" <a href=\"javascript:$.app._hideFatalError('stepback');\">"+$.app._("FATAL_ERROR__GO_BACK")+"</a>\t\t\t\t\t\t\t</p>","fast",function(){t._errors.push({description:e,page:"$.app.js",line:0})})}},{key:"_hideFatalError",value:function(e){this.hideModalDialog("fast",function(){$.app.hideOverlay(),$("#fatal_error").remove(),"reload"==e?location.reload():"stepback"==e&&$.app.forceStepBack()})}},{key:"_observe",value:function(){this.debug&&console.debug("Observing hash from now on"),this._is_observing_hash=!0,this._hash_changed_while_not_observing&&(this._hash_changed_while_not_observing=!1,this._checkHash())}},{key:"_stopObservation",value:function(){this.debug&&console.debug("Stopped hash observation"),this._is_observing_hash=!1}},{key:"_checkHash",value:function(){var e,t;if(!this.view_fetching&&this.hash!==location.hash){if(this.debug&&console.debug("Hash changed"),this.hash=location.hash,!this.hash||"#"==this.hash)return this.goTo(this.default_view),!1;var n=this.hash.substring(1).split("&");e=n.shift();var i=e.indexOf("/");if(i>0){var o=e.indexOf("/",i+1);o>0&&(i=o,e=e.substring(0,i))}n=null,""!==e&&null!==e||(e=this.default_view);var a=!0;if(this.currentView&&e==this.currentView&&(t=this._getViewObject(this.currentView),t&&t.onHashChange(this.hash)&&(a=!1)),a&&this.currentView&&!this._resume_hash&&(t=this._getViewObject(this.currentView))){if(!t.close(this.hash))return this.debug&&console.debug("View coulnd't close"),this._stopObservation(),this._resume_hash=this.hash,this.hash=this.stepBack(),void this._observe();this._onViewClose(t),this.debug&&console.debug("Closed view")}this._resume_hash=!1,this._force_clear?(this.addHistory(this.hash),this._force_clear=!1):this._detectStepBack(this.hash)||this.addHistory(this.hash),a&&(this.debug&&console.debug("View : "+e),this.hideModalDialogNow(),this._selectViewMenu(e),this._fetchView(e))}}},{key:"_onViewClose",value:function(e){}},{key:"goTo",value:function(e,t){this.debug&&console.debug('Go To "'+e+'"'),t&&(this._force_clear=!0),location.hash=e}},{key:"goToNoTriggerHashChange",value:function(e){$.app._stopObservation(),this.goTo(e),$.app._hash_changed_while_not_observing=!1,$.app.hash=e,$.app._observe()}},{key:"navigateBackTo",value:function(e){this._history.pop(),this.replace(e)}},{key:"replace",value:function(e){return e||(e=""),"#"!=e.charAt(0)&&(e="#"+e),this.isOpera()?void location.replace(location.protocol+"//"+location.hostname+location.pathname+e):void location.replace(e)}},{key:"forceGoTo",value:function(e,t){this._stopObservation(),this.debug&&console.debug('Force Go To "'+e+'"'),t&&(this._force_clear=!0),location.hash=e,location.reload()}},{key:"resume",value:function(e){if(this._resume_hash)if(e||"undefined"==typeof e)this._resume_hash=!1,this.addHistory(location.hash),this.debug&&console.debug("View cancelled closing");else{this._onViewClose(this._getViewObject(this.currentView)),this.currentView=!1;var t=this._resume_hash;this._resume_hash=!1,location.hash=t,this.debug&&console.debug("View closed, resuming")}}},{key:"getResumeHash",value:function(){return this._resume_hash}},{key:"parseHash",value:function(e){var t={view:"",params:{}},n=e.split("&");t.view=n.shift().substr(1);for(var i=0;i<n.length;i++){var o=n[i].split("="),a=o.shift();t.params[a]=decodeURIComponent(o.join("="))}return t}},{key:"reload",value:function(e,t){t&&this._setViewCache(this.currentView,!1,!1),this._fetchView(this.currentView,e)}},{key:"_onBeforeFetchView",value:function(e){}},{key:"_onFetchView",value:function(e){}},{key:"_onLoadView",value:function(e,t,n){}},{key:"_fetchView",value:function(e,t){this.currentView=e;var n=this;n._hideLoading(),n.abortOngoingXHR();var i=this._isViewCached(e);i&&this.debug&&console.debug('View "'+e+'" is in cache ('+this.lang+")"),this.view_fetching=!0,n._onBeforeFetchView(n.currentView),n._onFetchView(this._getViewObject(n.currentView));var o=this._getViewParameters(location.hash);for(var a in o.params)o[a]=o.params[a];if(delete o.params,t&&$.isPlainObject(t))for(a in t)o[a]=t[a];o.k=n.SESSION_KEY,o.view=n.currentView,o.cmd="view",o.cached=i,o.version=this.getApplicationVersion(),o.uv=n.userVersion,this.replaced_session_key&&(o.rk=this.replaced_session_key,this.replaced_session_key=!1);var r=$.param(o);$.ajax({url:"index.php?"+r,type:"POST",data:{context:$.app.getContext()},dataType:"json",headers:$.app.getXSRFHeaders(),success:function(i){if(n.view_fetching=!1,n._hideLoading(),"error"==i.status){var o=i.data;return 600==o.code?n._showFatalError('An error occured server side while fetching view data "'+e+'" (600)'):601==o.code||602==o.code?n._showNavigationError():n._showFatalError('An unknown error was sent from server while fetching view data "'+e+'" ('+o.error+")"),!1}n._onLoadView(n._getViewObject(n.currentView),i.data,t),n._loadView(i.data,t)},error:function(t,i,o){return n.view_fetching=!1,n._hideLoading(),!!$.app.validateXHR(t)&&(this.debug&&(console.debug("AJAX query error"),console.debug(i),console.debug(o)),void n._showFatalError('An error occured while fetching view data "'+e+'" ('+i+")"))}}),this._loadingTimeout=setTimeout(function(){n._showLoading()},this._loadingDelay)}},{key:"_loadView",value:function(e,t){var n,i=this;try{this.getApplicationVersion()!=e.version&&location.reload(),e.data&&(e=e.data),e.user&&i.userVersion!=e.user.version&&(i.clearViewCache(),i.setUserConfig(e.user)),this._initView();var o=this._getViewObject(this.currentView);if(!o)throw this._throw("View object not found : "+this.currentView,!0);
if(o._validateable=e.validateable||!1,e.html)this.debug&&console.debug("Using recieved html"),this._loadContent(e.html),this._setViewCache(this.currentView,e.html,!1);else{if(!this._isViewCached(this.currentView))throw this._throw("View not cached and not recieved from html...",!0);this.debug&&console.debug("Using cached html"),this._loadContent(this._getViewCachedHTML(this.currentView))}n=e.params?$.extend({},e.params,t):$.extend({},t),this._loadParams(n),this._hookView(),this._loadModel(e.model),this._checkAnchor(),this._checkOnLoadScroll(),$("input").each(function(e,t){$(t).attr("maxlength")||$(t).attr("maxlength",255)})}catch(e){throw this._stopObservation(),this._showFatalError(e),e}}},{key:"_checkAnchor",value:function(){var e=this._getViewParameters(this.hash);if(e.params.anchor){var t=e.params.anchor,n=this._getViewObject(this.currentView),i=$("[anchor="+t+"]");if(0===i.length)return this.debug&&console.warn('GET parameter "anchor" found but there is no element associated with it!'),!1;$.isFunction(n.onScrollToAnchor)?n.onScrollToAnchor(i,t):this.debug&&console.warn('GET parameter "anchor" found but there is no `onScrollToAnchor` function on your view!')}}},{key:"_checkOnLoadScroll",value:function(){var e=this.getOnLoadScroll();e&&this.isNumber(e.X)&&this.isNumber(e.Y)&&(window.scrollTo(e.X,e.Y),this.clearOnLoadScroll())}},{key:"setOnLoadScroll",value:function(e,t){this._onLoadScroll={X:this.parseInt(e),Y:this.parseInt(t)}}},{key:"getOnLoadScroll",value:function(){return this._onLoadScroll}},{key:"clearOnLoadScroll",value:function(){delete this._onLoadScroll}},{key:"_initView",value:function(){if(!this.currentView)throw this._throw("No view to initialize",!0);var e=this._getViewObject(this.currentView);window.view=e,e&&e.init(location.hash)}},{key:"_loadContent",value:function(e){var t=this._getViewObject(this.currentView);t&&"function"==typeof t.draw?t.draw(e):$("#content").html(e),scrollTo(0,0)}},{key:"_loadParams",value:function(e){if(!this.currentView)throw this._throw("No view to load parameters from.",!0);var t=this._getViewObject(this.currentView);t&&t.load(e)}},{key:"_hookView",value:function(){if(!this.currentView)throw this._throw("No view to hook",!0);var e=this._getViewObject(this.currentView);e&&("function"==typeof e._preHook&&e._preHook(),e.hook(),this._onViewHook(e))}},{key:"_onViewHook",value:function(e){}},{key:"recursiveCleanFloats",value:function(e){if($.isArray(e))for(var t=0;t<e.length;t++)e[t]=$.app.recursiveCleanFloats(e[t]);else if("object"==("undefined"==typeof e?"undefined":s(e)))for(var n in e)e[n]=$.app.recursiveCleanFloats(e[n]);else if("string"==typeof e&&e.match(/^\d+\.\d+$/i)){var i=parseFloat(e);isNaN(i)||(e=i)}return e}},{key:"_loadModel",value:function(e){var t=this._getViewObject(this.currentView);t?(e=$.app.recursiveCleanFloats(e),this.debug&&console.debug(e),this.emit("preInject"),t.inject(e),this.emit("postInject"),"function"==typeof t._postInject&&t._postInject(),this._onViewInject(t,e)):this.debug&&console.debug("No view object, cannot inject model"),$(".page-title").length&&(window.document.title=$(".page-title").text())}},{key:"_onViewInject",value:function(e,t){}},{key:"clearViewCache",value:function(){this.debug&&console.log("Clearing view cache"),delete this._view_cache,this._view_cache=[]}},{key:"_isViewCached",value:function(e){return!(!this._view_cache[e]||!this._view_cache[e].html)}},{key:"_getViewCachedHTML",value:function(e){if(this._view_cache[e]&&this._view_cache[e].html)return this._view_cache[e].html;throw this._throw("View was supposed to be cached...",!0)}},{key:"_getViewCachedParams",value:function(e){return this._view_cache[e].params}},{key:"_setViewCache",value:function(e,t,n){delete this._view_cache[e],this._view_cache[e]={html:t,params:n?n:null},this.debug&&console.debug('Cached version of view "'+e+'"')}},{key:"_getViewParameters",value:function(e){var t=this._getViewObject(this.currentView);return t?t.parseHash(e):{}}},{key:"_showLoading",value:function(){if(this._loadingTimeout){if(clearTimeout(this._loadingTimeout),this._loadingTimeout=0,this.debug&&console.debug("Show loading overlay"),$("#loading-overlay").length>0)return;this.showOverlay(),$("body").append('<img id="loading-overlay-image" src="'+this.IMG_PATH+'ajax-loader-big.gif" /><div id="loading-overlay"></div>');var e=$("#main").height()+parseInt($("#main").css("padding-top"),10)+parseInt($("#main").css("padding-bottom"),10);$("#loading-overlay-image").css({top:$("#main").offset().top,paddingTop:parseInt(e/2,10)+"px",position:"absolute",left:Math.floor($("#main").width()/2),zIndex:89}),$("#loading-overlay").css({height:e,left:0,position:"absolute",top:$("#main").offset().top,width:"100%",zIndex:90,backgroundColor:"#000",opacity:.4}).fadeIn()}}},{key:"beforeHideLoading",value:function(){}},{key:"_hideLoading",value:function(){this.beforeHideLoading(),clearTimeout(this._loadingTimeout),this._loadingTimeout=0,this.debug&&console.debug("Hide loading overlay"),$("#loading-overlay").remove(),$("#loading-overlay-image").remove(),this.hideOverlay(),this.afterHideLoading()}},{key:"afterHideLoading",value:function(){}},{key:"showOverlay",value:function(e,t,n,i){i||(i=500),n||(n="overlay"),this.debug&&console.debug("Show overlay"),$("#"+n).length>0||($("body").append('<div id="'+n+'"></div>'),e||(e="transparent"),t||(t="0"),$("#"+n).css({height:$(document).height(),left:0,position:"absolute",top:0,width:this._iPad?$("body").width():"100%",zIndex:i,backgroundColor:e,opacity:t}).fadeIn())}},{key:"hideOverlay",value:function(e){this.debug&&console.debug("Hide overlay"),e||(e="overlay"),$("#"+e).remove()}},{key:"addHistory",value:function(e){this._history[this._history.length-1]&&this._history[this._history.length-1].hash==e||this._history.push({hash:e,context:{}})}},{key:"_detectStepBack",value:function(e){return!(!this._history[this._history.length-2]||this._history[this._history.length-2].hash!=e)&&(this._history.pop(),!0)}},{key:"stepBack",value:function(e){var t;do{if(0===this._history.length){t="";break}if(t=this._history.pop().hash,"undefined"==typeof t){t="";break}}while(t==location.hash);return this.debug&&console.debug("Step back to : "+t),(e||"undefined"==typeof e)&&(location.hash=t),t}},{key:"forceReload",value:function(){location.reload()}},{key:"forceStepBack",value:function(){this._stopObservation(),this.debug&&this._debugHistory();var e=this.stepBack(!1);""!==e?(location.hash=e,location.reload()):(history.back(),location.reload())}},{key:"goBack",value:function(e){void 0===e&&(e=""),this._history.length>=2&&(this._history.pop(),e=this._history.pop().hash),this.debug&&console.debug('Go back to "'+e+'"'),location.hash=e}},{key:"forceGoBack",value:function(){var e;this._stopObservation(),this._history.length<2?e="":(this._history.pop(),e=this._history.pop().hash),this.debug&&console.debug('Force go back to "'+e+'"'),location.hash=e,location.reload()}},{key:"setContextValue",value:function(e,t){this._history.length>0&&($.isPlainObject(this._history[this._history.length-1].context)||(this._history[this._history.length-1].context={}),this._history[this._history.length-1].context[e]=t)}},{key:"getContextValue",value:function(e){return!!(this._history.length>0&&$.isPlainObject(this._history[this._history.length-1].context))&&this._history[this._history.length-1].context[e]}},{key:"getContext",value:function(){return this._history&&this._history.length>0&&$.isPlainObject(this._history[this._history.length-1].context)?this._history[this._history.length-1].context:{}}},{key:"_debugHistory",value:function(){for(var e=0;e<this._history.length;e++)console.debug(e+" : "+this._history[e].hash),console.debug(this._history[e].state)}},{key:"_arrayPop",value:function(e,t){if(e.length&&t>0&&t<e.length){for(var n=t;n<e.length-1;n++)e[n]=e[n+1];e.pop()}return e}},{key:"_checkGears",value:function(){return window.google&&google.gears?(this.debug&&console.debug("Google Gears is installed"),!0):(this.debug&&console.debug("Google Gears is not installed"),!1)}},{key:"_initGears",value:function(){return!!this._checkGears()}},{key:"registerView",value:function(e,t){this.debug&&this._view_objects[e]&&console.debug("View "+e+" is already registered"),this.debug&&console.debug('Registered view "'+e+'"'),this._view_objects[e]=t}},{key:"_getViewObject",value:function(e){return this._view_objects[e]}},{key:"_scrollTop",value:function(){var e=window.pageYOffset?window.pageYOffset:0,t=document.documentElement?document.documentElement.scrollTop:0,n=document.body?document.body.scrollTop:0,i=e?e:0;return i=t&&(!i||i>t)?t:i,i=n&&(!i||i>n)?n:i}},{key:"showModalDialog",value:function(e,t,n,i){$.app.debug&&console.debug("Show modal dialog"),this.showOverlay("#000",.4),$("body").append($("<div></div>").addClass("modal").attr("id","modal_dialog").css({display:"none",top:$.app._scrollTop()+"px"}).append($("<div></div>").addClass("modal-2").append($("<div></div>").addClass("sprite modal-3").append(e)))),i&&$("#modal_dialog .modal-2").css("width",i),$.app.isIE7()&&$("div.modal p.submit").prepend('<span style="width: 1px; display: inline-block;">&nbsp;</span>'),$("#modal_dialog").slideDown(t,n)}},{key:"hideModalDialog",value:function(e,t,n){$.app.debug&&console.debug("Hide modal dialog"),$("#modal_dialog").fadeOut(e,function(){$.app.hideOverlay(),n?$("#modal_dialog").detach():$("#modal_dialog").remove(),"function"==typeof t&&t()})}},{key:"hideModalDialogNow",value:function(){$.app.debug&&console.debug("Hide modal dialog now!"),$("#modal_dialog").remove()}},{key:"getShowErrorHTML",value:function(e){return'<div class="modal-dialog"><h2>'+$.app._("ERROR")+"</h2>\t\t\t\t\t\t\t<p>\t\t\t\t\t\t\t\t<strong>"+(e?$.app._(e):$.app._("FATAL_ERROR_OCCURED"))+"</strong>\t\t\t\t\t\t\t\t<br />\t\t\t\t\t\t\t\t"+$.app._("ERROR_TRY_AGAIN")+"\t\t\t\t\t\t\t\t<br />\t\t\t\t\t\t\t\t"+$.app._("CONTACT_SUPPORT_PERSIST")+'\t\t\t\t\t\t\t</p>\t\t\t\t\t\t\t<p class="submit">\t\t\t\t\t\t\t\t<input type="submit" id="hook_create_error_close" value="'+$.app._("OK")+'" />\t\t\t\t\t\t\t</p></div>'}},{key:"showError",value:function(e,t){$.app.showModalDialog($.app.getShowErrorHTML(e),"fast",function(){$("#hook_create_error_close").safeClick(function(){$.app.hideModalDialog("fast"),t&&t()})})}},{key:"getShowSessionExpiredError",value:function(){return'<div class="modal-dialog"><h2>'+$.app._("INVALID_CREDENTIAL_ERROR_TITLE")+"</h2>\t\t\t\t\t<p>\t\t\t\t\t\t<strong>"+$.app._("INVALID_CREDENTIAL_ERROR_BODY")+'</strong>\t\t\t\t\t\t<br />\t\t\t\t\t</p>\t\t\t\t\t<p class="submit">\t\t\t\t\t\t<input type="submit" id="hook_session_expired_error_close" value="'+$.app._("OK")+'" />\t\t\t\t\t</p>\t\t\t\t</div>'}},{key:"showSessionExpiredError",value:function(e){var t=this;e=e||t.VIRTUALPATH||"/?logout",$.app.showModalDialog($.app.getShowSessionExpiredError(),"fast",function(){$("#hook_session_expired_error_close").safeClick(function(){document.location=e})})}},{key:"getShowXHRNetworkError",value:function(){return'<div class="modal-dialog"><h2>'+$.app._("XHR_NETWORK_ERROR_TITLE")+"</h2>\t\t\t\t\t<p>\t\t\t\t\t\t<strong>"+$.app._("XHR_NETWORK_ERROR_BODY")+'</strong>\t\t\t\t\t\t<br />\t\t\t\t\t</p>\t\t\t\t\t<p class="submit">\t\t\t\t\t\t<input type="submit" id="hook_xhr_network_error_close" value="'+$.app._("OK")+'" />\t\t\t\t\t</p>\t\t\t\t</div>'}},{key:"showXHRNetworkErrorError",value:function(e){var t=this;e=e||t.VIRTUALPATH||"/?logout",t.showModalDialog(t.getShowXHRNetworkError(),"fast",function(){$("#hook_xhr_network_error_close").safeClick(function(){document.location=e})})}},{key:"getShowConfirmationHTML",value:function(e,t){return'<div class="modal-dialog"><h2>'+e+"</h2>\t\t\t\t\t\t\t\t<p>"+t+'</p>\t\t\t\t\t\t\t<p class="submit">\t\t\t\t\t\t\t\t<input type="button" id="hook_confirmation_yes" value="'+$.app._("YES")+'" />\t\t\t\t\t\t\t\t<input type="button" id="hook_confirmation_no" value="'+$.app._("NO")+'" />\t\t\t\t\t\t\t</p></div>'}},{key:"showConfirmation",value:function(e,t,n,i){$.app.showModalDialog($.app.getShowConfirmationHTML(e,t),"fast",function(){$("#hook_confirmation_yes").safeClick(function(){n&&n(),$.app.hideModalDialog("fast")}),$("#hook_confirmation_no").safeClick(function(){i&&i(),$.app.hideModalDialog("fast")})})}},{key:"showMessage",value:function(e,t,n){""===e&&this._throw("Missing title",!0),""===t&&this._throw("Missing message",!0),$.app.showModalDialog("<h2>"+e+"</h2>\t\t\t\t\t\t\t<p>\t\t\t\t\t\t\t\t<strong>"+t+"</strong>\t\t\t\t\t\t\t</p>\t\t\t\t\t\t\t"+(n?"<p>"+n+"</p>":"")+'\t\t\t\t\t\t\t<p class="submit">\t\t\t\t\t\t\t\t<input type="submit" id="hook_show_message_close" value="'+$.app._("OK")+'" />\t\t\t\t\t\t\t</p>',"fast",function(){$("#hook_show_message_close").safeClick(function(){$.app.hideModalDialog("fast")})})}},{key:"showQuestionCommentDialog",value:function(e){function t(){return $("#file_upload").ajaxUploader({url:"index.php?k="+o.SESSION_KEY+"&uploadFile&tmp_dir="+o.tmp_dir,autoUpload:!0,progressBarConfig:{barImage:"img/progressbg_orange.gif"},success:function(e,i){if(e.ajax_filename){var a=r++,s=e.ajax_filename;o.tmp_dir=e.tmp_dir,$("#uploaded_files_names").append('<li id="ajax_file_'+a+'" style="list-style:none;">'+s+'&nbsp&nbsp<span class="ico icon-cross" id="ajax_file_remove_'+a+'" style="position: absolute; margin-bottom:10px;"></span></li>'),$("#ajax_file_remove_"+a).on("click",function(){n(o.tmp_dir,s,a)}),o.QCS_uploader.push(t())}else e.error&&(console.debug(e.error),$.app.showMessage($.app._("ERROR"),$.app._("UPLOAD_FILE_ERROR_OCCURED")))},error:function(e,t,n){console.debug("Error uploading attachment."),$.app.showMessage($.app._("ERROR"),$.app._("UPLOAD_FILE_ERROR_OCCURED"))}})}function n(e,t,n){var i="&file="+encodeURIComponent(t)+"&fld="+encodeURIComponent(e);$.ajax({url:"index.php?k="+o.SESSION_KEY+"&removeQCSAjaxFile",type:"POST",data:i,dataType:"json",headers:$.app.getXSRFHeaders(),success:function(e){return $("#ajax_file_"+n).remove(),$("#ajax_file_remove_"+n).remove(),!0},error:function(e,t,n){return!!$.app.validateXHR(e)&&void console.debug("Error deleting attachment.")}})}function i(e){o.tmp_dir="",$.ajax({url:"index.php?k="+o.SESSION_KEY+"&removeQCSAjaxFolder",type:"POST",data:"&fld="+encodeURIComponent(e),dataType:"json",headers:$.app.getXSRFHeaders(),success:function(e){return!0},error:function(e,t,n){if(!$.app.validateXHR(e))return!1}})}var o=this,a="<h2>"+$.app._("QUESTION_COMMENT_SUGGESTION")+'</h2>\t\t\t<div class="header_line"></div>\t\t\t<div id="hook_question_comment_form">\t\t\t<dl class="form left_form">\t\t\t<dt><label style="width:100px">'+$.app._("COMMENT_TYPE")+'</label></dt>\t\t\t<dd><select id="hook_question_comment_type">\t\t\t<option value="QUESTION">'+$.app._("QUESTION")+'</option>\t\t\t<option value="COMMENT">'+$.app._("COMMENT")+'</option>\t\t\t<option value="SUGGESTION">'+$.app._("SUGGESTION")+'</option>\t\t\t</select></dd>\t\t\t<dt><label style="width:100px">'+$.app._("COMMENT_FROM")+'</label></dt>\t\t\t<dd><input type="text" id="hook_question_comment_from" style="width:350px" disabled="disabled" /></dd>\t\t\t<dt><label style="width:100px">'+$.app._("COMMENT_SUBJECT")+'</label></dt>\t\t\t<dd><input type="text" id="hook_question_comment_subject" style="width:350px" /></dd>\t\t\t<div id="hook_question_comment_attachement_div">\t\t\t<dt><label style="width:100px">'+$.app._("ATTACHMENT")+'</label></dt>\t\t\t<dd><div id="file_upload"></div></dd>\t\t\t<dd><ul style="margin-left:115px;" id="uploaded_files_names"></ul><dd>\t\t\t<br />\t\t\t</div>\t\t\t<dd><textarea id="hook_question_comment_textarea" style="width:500px;height:150px"></textarea></dd>\t\t\t</dl>\t\t\t<p class="submit">\t\t\t<input type="submit" id="hook_send_question_comment" value="'+$.app._("OK")+'" /> <a href="javascript:void(0);" id="hook_cancel_question_comment">'+$.app._("CANCEL")+'</a>\t\t\t</p>\t\t\t</div>\t\t\t<div id="hook_question_comment_sent" style="display:none"><p>'+$.app._("THANK_YOU_FOR_YOUR_COMMENTS")+"</p></div>",r=0;$.app.showModalDialog(a,"normal",function(){e&&$("#hook_question_comment_type").val(e),$("#hook_question_comment_from").val($.app.userEmail),$("#hook_send_question_comment").safeClick(function(){var e=$("#hook_question_comment_type").val(),t=$("#hook_question_comment_subject").val(),n=$("#hook_question_comment_from").val(),a=$("#hook_question_comment_textarea").val();if(!t)return $("#hook_question_comment_subject").hintError($.app._("FIELD_REQUIRED")).focus(),!1;if(!a)return $("#hook_question_comment_textarea").hintError($.app._("FIELD_REQUIRED")).focus(),!1;var r="&type="+encodeURIComponent(e)+"&subject="+encodeURIComponent(t)+"&from="+encodeURIComponent(n)+"&message="+encodeURIComponent(a)+"&tmp_dir="+encodeURIComponent(o.tmp_dir);$.ajax({url:"index.php?k="+o.SESSION_KEY+"&sendComment",type:"POST",data:r,dataType:"json",headers:$.app.getXSRFHeaders(),success:function(e){return e.status&&"error"==e.status?($.app.showError(),$.app.hideModalDialog("fast"),!1):(setTimeout(function(){$.app.hideModalDialog("fast")},2e3),i(o.tmp_dir),!0)},error:function(e,t,n){return $.app.validateXHR(e)?($.app.showError(),$.app.hideModalDialog("fast"),!1):($.app.hideModalDialog("fast"),!1)}}),$("#hook_question_comment_form").fadeOut(function(){$("#hook_question_comment_sent").show()})}),$("#hook_cancel_question_comment").safeClick(function(){o.tmp_dir="",$.app.hideModalDialog("fast")}),$("#hook_question_comment_subject").focus()},550),this.QCS_uploader=[],this.QCS_uploader.push(t())}},{key:"requestUnmount",value:function(e){this.unmounts.push(e)}},{key:"performUnmounts",value:function(){this.unmounts.forEach(function(e){e()}),this.unmounts=[]}},{key:"htmlEntity",value:function(e){return e||this.isNumber(e)?$("<div></div>").text(e).html():""}},{key:"sleep",value:function(e){var t,n=new Date;do t=new Date;while(t-n<e)}},{key:"generateGUID",value:function(){var e=function(){return Math.floor(65536*Math.random()).toString(16)};return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}},{key:"isNumber",value:function(e){return"number"==typeof e&&isFinite(e)}},{key:"parseFloat",value:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e){if("number"==typeof e)return e;e+=";",e=e.replace(/[^\d\-.,]/g,""),"fr"==this.lang&&e.indexOf(",")!=-1&&(e=e.replace(/\./g,""),e=e.replace(/\,/g,".")),e=e.replace(/\,/g,"");var t=parseFloat(e);return isNaN(t)&&(t=0),t})},{key:"parseInt",value:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e){return e=parseInt(e,10),isNaN(e)&&(e=0),e})},{key:"formatMoney",value:function(e,t){if(t&&t.canBeNull&&(""===e||null===e))return"";var n;n="fr"==this.lang?"right":"left";var i=this.formatNumber(e,t);return i||(i="0"),"left"==n?t&&t.nbsp?"$"+i:"$"+i:t&&t.nbsp?i+"&nbsp;$":i+" $"}},{key:"formatPercent",value:function(e,t){var n;if(t&&t.canBeNull&&!e)return"";n="fr"==this.lang?t&&t.nbsp?"&nbsp":" ":"";var i=this.formatNumber(e,t);return i||(i="0"),i+n+"%"}},{key:"formatNumber",value:function(e,t){if(0===arguments.length)return"";if(!e&&0!==e)return"";var n={precision:2,facultative_decimals:!0,positive:!1,nbsp:!1,rounded:!0};n="fr"==this.lang?$.extend({decimal_separator:",",thousand_separator:" "},n):$.extend({decimal_separator:".",thousand_separator:","},n);var i=$.extend(n,t);e+="";var o=!1;"-"==e.charAt(0)&&(i.positive?e="0":(o=!0,e=e.substr(1))),e=e.replace(/[^\d\-.,]/g,""),","==i.decimal_separator&&e.indexOf(i.decimal_separator)!=-1&&(e=e.replace(/\./g,""),e=e.replace(/,/g,".")),""===e&&(e="0"),e=e.replace(/,/g,""),e=parseFloat(e)+"",e==Number.NaN&&(e="");var a,r;0===i.precision?(a=$.app.parseFloat(e).toFixed(0),r=a):(a=i.rounded?(Math.round(e*Math.pow(10,i.precision))/Math.pow(10,i.precision)).toFixed(i.precision):(Math.floor(e*Math.pow(10,i.precision))/Math.pow(10,i.precision)).toFixed(i.precision),r=a.substr(0,a.indexOf(".")));var s="",u=r.length;if(u>3){do{u-=3;var l=3;u<0&&(l=3+u,u=0),s=""!==s?r.substr(u,l)+i.thousand_separator+s:r.substr(u,l)}while(u>0)}else s=r;var h;return 0===i.precision||i.facultative_decimals&&0===parseInt(a.substr(a.indexOf(".")+1))?h=s:(s+=i.decimal_separator,h=s+a.substr(a.indexOf(".")+1)),i.end_space&&(h+=" "),i.nbsp&&(h=h.replace(/ /g,"&nbsp;")),o?"-"+h:h}},{key:"formatSIN",value:function(e){var t=e;t=t.replace(new RegExp("[^\\d]","g"),"");var n=t.substr(0,3)+" "+t.substr(3,3)+" "+t.substr(6,3);return $.trim(n)}},{key:"isSINValid",value:function(e){if(""===e)return!0;if("*** *** ***"==e)return!0;if(e=e.replace(new RegExp("[^\\d]","g"),""),9!=e.length)return!1;for(var t=parseInt(e.charAt(0))+parseInt(e.charAt(2))+parseInt(e.charAt(4))+parseInt(e.charAt(6)),n=1;n<=7;n+=2){var i=2*parseInt(e.charAt(n));i>=10&&(i-=9),t+=i}return t+=parseInt(e.charAt(8)),t%10===0}},{key:"formatFieldValue",value:function(e){var t=this;if(!e)return"";if("object"==("undefined"==typeof e?"undefined":s(e))){var n=e["value_"+t.lang];return"undefined"==typeof n?"":n}return e}},{key:"parsePhone",value:function(e){var t;if(/(,|ext|poste|#)/.test(e)){var n=e.indexOf(","),i=e.indexOf("ext"),o=e.indexOf("poste"),a=e.indexOf("#"),r=Math.max(n,i,o,a);r!=-1&&(t=e.substr(r).replace(/[^\d]/g,""),e=e.substr(0,r))}else t="";e=e.replace(/[^\d]/g,"");var s;return"1"==e[0]&&e.length>=11?(s="1 "+e.substr(1,3)+" "+e.substr(4,3)+"-"+e.substr(7,4),e.length>11&&(t=e.substr(11))):e.length>=10?(s=e.substr(0,3)+" "+e.substr(3,3)+"-"+e.substr(6,4),e.length>10&&(t=e.substr(10))):s=7==e.length?e.substr(0,3)+"-"+e.substr(3):e,t&&(s+=$.app._("PHONE_EXTENSION")+t),s}},{key:"formatPostalCode",value:function(e){return/^[a-zA-Z]\d[a-zA-Z]\d[a-zA-Z]\d$/.test(e)?(e.substr(0,3)+" "+e.substr(3)).toUpperCase():e}},{key:"pad",value:function(e,t){for(var n=""+e;n.length<t;)n="0"+n;return n}},{key:"interpolate",value:function(e,t){var n;if(null!==t&&"object"===("undefined"==typeof t?"undefined":s(t)))for(;n=/{([a-z0-9._]+)}/gi.exec(e);)e=e.replace(n[0],t[n[1]]||"");return e}},{key:"validateXHR",value:function(e){var t=this;return!e||"undefined"==typeof e||"abort"!==e.statusText&&(0===e.status?(setTimeout(function(){return"abort"!==e.statusText&&void t.showXHRNetworkErrorError(!!e.responseJSON&&e.responseJSON.view)}),!1):401!=e.status||(t.showSessionExpiredError(!!e.responseJSON&&e.responseJSON.view),!1))}},{key:"getXHRRequest",value:function(e,t,n,i,o,a){var r=this,s=$.ajax({url:e,type:"GET",dataType:"json",success:function(e){a||(r.hideOverlay(),r._hideLoading()),o&&$(o).prop("disabled",!1);var n;n="undefined"!=typeof e.data?e.data:e,e.status&&"error"==e.status?"function"==typeof i?i(n):"undefined"!=typeof n.message?$.app.showError(n.message):$.app.showError():"function"==typeof t&&t(n)},error:function(e,t,n){return a||(r.hideOverlay(),r._hideLoading()),o&&$(o).prop("disabled",!1),!!$.app.validateXHR(e)&&(this.debug&&(console.debug("AJAX query error"),console.debug(t),console.debug(n)),void("function"==typeof i?i():$.app.showError()))}});return s}},{key:"registerXHR",value:function(e){this._ongoing_xhrs.push(e)}},{key:"unregisterXHR",value:function(e){var t=this._ongoing_xhrs.indexOf(e);t>=0&&this._ongoing_xhrs.splice(t,1)}},{key:"abortOngoingXHR",value:function(){$.each(this._ongoing_xhrs,function(e,t){void 0!==t&&t.abort()}),this._ongoing_xhrs=[]}},{key:"get",value:function(e,t,n,i,o,a,r,s){o||s||this.showOverlay(),r&&$(r).prop("disabled",!0);var u=this;n.length>0&&"&"!=n[0]&&(n="&"+n);var l=$.ajax({url:"index.php?k="+u.SESSION_KEY+"&view="+e+"&cmd="+t+n,type:"GET",dataType:"json",headers:u.getXSRFHeaders(),success:function(e){s||(u.hideOverlay(),u._hideLoading()),r&&$(r).prop("disabled",!1);var t;t="undefined"!=typeof e.data?e.data:e,e.status&&"error"==e.status?"function"==typeof a?a(t):"undefined"!=typeof t.message?$.app.showError(t.message):$.app.showError():"function"==typeof i&&i(t)},error:function(e,t,n){return s||(u.hideOverlay(),u._hideLoading()),r&&$(r).prop("disabled",!1),!!$.app.validateXHR(e)&&(this.debug&&(console.debug("AJAX query error"),console.debug(t),console.debug(n)),void("function"==typeof a?a():$.app.showError()))}});return u.registerXHR(l),l.done(function(e,t,n){u.unregisterXHR(n)}).fail(function(e){u.unregisterXHR(e)}),o&&(this._loadingTimeout=setTimeout(function(){u._showLoading()},this._loadingDelay)),l}},{key:"post",value:function(e,t,n,i,o,a,r,s){var u=this;s&&$(s).prop("disabled",!0),n.length>0&&"&"!=n[0]&&(n="&"+n);var l=$.ajax({url:"index.php?k="+u.SESSION_KEY+"&view="+e+"&cmd="+t+n,type:"POST",data:i,dataType:"json",headers:u.getXSRFHeaders(),success:function(e){a&&(u.hideOverlay(),u._hideLoading()),s&&$(s).prop("disabled",!1);var t;t="undefined"!=typeof e.data?e.data:e,e.status&&"error"==e.status?"function"==typeof r?r(t):"undefined"!=typeof t.message?$.app.showError(t.message):$.app.showError():"function"==typeof o&&o(t)},error:function(e,t,n){return u.hideOverlay(),u._hideLoading(),s&&$(s).prop("disabled",!1),!!$.app.validateXHR(e)&&(this.debug&&(console.debug("AJAX query error"),console.debug(t),console.debug(n)),void("function"==typeof r?r():$.app.showError()))},ajaxStop:function(){u.ajaxQueryLoading=!1}});return u.registerXHR(l),l.done(function(e,t,n){u.unregisterXHR(n)}).fail(function(e){u.unregisterXHR(e)}),a&&(this._loadingTimeout=setTimeout(function(){u._showLoading()},this._loadingDelay)),l}},{key:"datepicker",value:function(e,t){return $(e).bind("change",function(){this.value=$.app.date.format(this.value,"input")}).datepicker(t)}},{key:"_formatAddress",value:function(e,t,n,i,o,a){var r="",s=!0;return""!==e&&e!==!1&&(s=!1,r+=this.htmlEntity(e)),""!==t&&t!==!1&&(s||(r+=", "),s=!1,r+=this.htmlEntity(t)),""!==n&&n!==!1&&(s||(r+=", "),s=!1,r+=this.htmlEntity(n)),""!==i&&"QC"!=i&&(s||(r+=", "),s=!1,r+=this.htmlEntity(i)),""!==a&&a!==!1&&(s||(r+=", "),s=!1,r+=this.htmlEntity(a)),""!==o&&o!==!1&&"Canada"!=o&&(s||(r+=", "),s=!1,r+=this.htmlEntity(o)),r}},{key:"formatAddress",value:function(e,t,n,i,o,a){return this._formatAddress(e,t,n,i,o,a)}},{key:"formatGMapAddress",value:function(e,t,n,i,o,a){return e=$.trim(e),t=$.trim(t),n=$.trim(n),o=$.trim(o),a=$.trim(a),e=e.replace(/\bboul\./i,"Boulevard"),e=e.replace(/,\s?\b(bur|bureau|app|appartement|appartment|local|office|porte|door)\b\.?\s*\d*/i,""),(e?e+", ":"")+(t?t+", ":"")+(n?n+", ":"")+(i?i+", ":"")+(a?a+", ":"")+o}},{key:"isMobile",value:function(){return navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/Pre/i)||navigator.userAgent.match(/Android/i)}},{key:"downloadFile",value:function(e){var t=this;if(t._iPad){var n="<h2>"+$.app._("DOWNLOAD_FILE_DIALOG_TITLE")+'</h2>\t\t\t\t<div class="header_line"></div>\t\t\t\t<a id="hook_download_file" href="javascript:void(0);">'+t._("DOWNLOAD_FILE")+"</a>\t\t\t\t<br /><br />";$.app.showModalDialog(n,"normal",function(){$("#hook_download_file").click(function(){window.open(e,"_blank"),$.app.hideModalDialog("fast")})})}else{var i="download_iframe",o=document.getElementById(i);o||(o=document.createElement("iframe"),o.id=i,o.name=i,o.style.position="absolute",o.style.top="-1000px",o.style.left="-1000px",document.body.appendChild(o)),o.src=e}}},{key:"getIEVersion",value:function(){var e=null;if("Microsoft Internet Explorer"==navigator.appName){var t=navigator.userAgent,n=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})");null!=n.exec(t)&&(e=parseFloat(RegExp.$1))}return e}},{key:"isIE7",value:function(){var e=this.getIEVersion();return e=null!==e?e:999,e<8}},{key:"isIE9",value:function(){var e=this.getIEVersion();return e>=9&&e<10}},{key:"isOpera",value:function(){return"Opera"==navigator.appName}},{key:"checkStoredSession",value:function(){var e=this;if(this.canUseSessionStorage()){var t=e.getXSRFToken();if(!t||!e._xsrf_cookie_name)throw this._throw("Cannot check stored session without XSRF Token");window.opener&&sessionStorage.getItem("window-name")!=window.name&&(this.debug&&console.debug("Opened from another tab, clearing cloned stored session"),sessionStorage.clear(),sessionStorage.setItem(e._xsrf_cookie_name,t));var n=sessionStorage.getItem(e._xsrf_cookie_name);n&&n==t||(this.debug&&console.log("Session cookie changed, clearing stored session"),sessionStorage.clear(),sessionStorage.setItem(e._xsrf_cookie_name,t)),sessionStorage.getItem("window-name")||sessionStorage.setItem("window-name",window.name);var i=sessionStorage.getItem("SESSION_KEY");i?(this.replaced_session_key=this.SESSION_KEY,this.SESSION_KEY=i,this.debug&&console.log('Replaced given session key "'+this.replaced_session_key+'" for stored session key "'+this.SESSION_KEY+'"')):sessionStorage.setItem("SESSION_KEY",this.SESSION_KEY)}}},{key:"canUseSessionStorage",value:function(){try{return!!sessionStorage.getItem&&!!$.cookie}catch(e){return!1}}},{key:"forceElementRedraw",value:function(e){e.hide().show()}},{key:"getByKey",value:function(e,t){for(var n=e,i=t.split("."),o=0;o<i.length;o++){if("object"!=("undefined"==typeof n?"undefined":s(n)))return;n=n[i[o]]}return n}}]),t}(h.default);t.default=c},function(e,t){function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function i(e){return"function"==typeof e}function o(e){return"number"==typeof e}function a(e){return"object"==typeof e&&null!==e}function r(e){return void 0===e}e.exports=n,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(e){if(!o(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},n.prototype.emit=function(e){var t,n,o,s,u,l;if(this._events||(this._events={}),"error"===e&&(!this._events.error||a(this._events.error)&&!this._events.error.length)){if(t=arguments[1],t instanceof Error)throw t;var h=new Error('Uncaught, unspecified "error" event. ('+t+")");throw h.context=t,h}if(n=this._events[e],r(n))return!1;if(i(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:s=Array.prototype.slice.call(arguments,1),n.apply(this,s)}else if(a(n))for(s=Array.prototype.slice.call(arguments,1),l=n.slice(),o=l.length,u=0;u<o;u++)l[u].apply(this,s);return!0},n.prototype.addListener=function(e,t){var o;if(!i(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,i(t.listener)?t.listener:t),this._events[e]?a(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,a(this._events[e])&&!this._events[e].warned&&(o=r(this._maxListeners)?n.defaultMaxListeners:this._maxListeners,o&&o>0&&this._events[e].length>o&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace())),this},n.prototype.on=n.prototype.addListener,n.prototype.once=function(e,t){function n(){this.removeListener(e,n),o||(o=!0,t.apply(this,arguments))}if(!i(t))throw TypeError("listener must be a function");var o=!1;return n.listener=t,this.on(e,n),this},n.prototype.removeListener=function(e,t){var n,o,r,s;if(!i(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(n=this._events[e],r=n.length,o=-1,n===t||i(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(a(n)){for(s=r;s-- >0;)if(n[s]===t||n[s].listener&&n[s].listener===t){o=s;break}if(o<0)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(o,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},n.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[e],
i(n))this.removeListener(e,n);else if(n)for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},n.prototype.listeners=function(e){var t;return t=this._events&&this._events[e]?i(this._events[e])?[this._events[e]]:this._events[e].slice():[]},n.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(i(t))return 1;if(t)return t.length}return 0},n.listenerCount=function(e,t){return e.listenerCount(t)}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=n(5),s=(i(r),function(){function e(){o(this,e),this._view="",this._id=!1,this._uri_params={},this._redrawn=!1}return a(e,[{key:"changed",value:function(e){}},{key:"parseHash",value:function(e){var t=$.app.parseHash(e),n=t.view.indexOf("/");if(n>0){var i=t.view.indexOf("/",n+1);i>0&&(n=i,t.id=t.view.substr(n+1),t.view=t.view.substr(0,n))}else t.id=!1;return t}},{key:"onHashChange",value:function(e){var t=this.parseHash(e);return this._onHashChange(e,t)}},{key:"_onHashChange",value:function(e,t){return!1}},{key:"onScrollToAnchor",value:function(e,t){e.focus();var n=e.offset();window.scrollTo(n.left,n.top)}},{key:"init",value:function(e){var t=this.parseHash(e);this._uri=t,this._view=t.view,this._id=t.id,this._uri_params=t.params,this._controls={},this._init(e)}},{key:"_init",value:function(){$.app.debug&&$.app._throw("View does not implement _init function")}},{key:"load",value:function(e){$.app.performUnmounts(),this._load(e)}},{key:"_load",value:function(e){this.params=e}},{key:"draw",value:function(e){if($.app.performUnmounts(),this._onBeforeDraw(),this._canRedraw()){for(var t=this._getRedrawingSelectors(),n=!0,i=0;n&&i<t.length;i++)$(t[i]).length||(n=!1);if(t=null,n)return this._redrawn=!0,$.app.debug&&console.debug("Redrawing content"),void this._onDraw(!0)}this._redrawn=!1,$.app.debug&&console.debug("Drawing view"),$("#content").html(e),this._onDraw()}},{key:"_canRedraw",value:function(){return!1}},{key:"_getRedrawingSelectors",value:function(){return[]}},{key:"_onBeforeDraw",value:function(){}},{key:"_onDraw",value:function(e){}},{key:"hook",value:function(e){var t=this;t._redrawn||($.app.debug&&console.debug("Hooking view"),this._hook(e),t.updateReturnToParentView())}},{key:"_hook",value:function(e){$.app.debug&&$.app._throw("View does not implement _hook function")}},{key:"inject",value:function(e){$.app.debug&&console.debug("Injecting model"),this._inject(e)}},{key:"_inject",value:function(e){$.app.debug&&$.app._throw("View does not implement _inject function")}},{key:"close",value:function(e){var t=this._canClose();return t?this._onClose():this._onCancelClose(),"function"==typeof e&&e(),t}},{key:"_canClose",value:function(){return!0}},{key:"_onCancelClose",value:function(){$.app.debug&&$.app._throw("View does not implement _onCancelClose function")}},{key:"_onClose",value:function(){}},{key:"pushParentView",value:function(e){var t=this,n="";return t._uri_params.parent_view&&(n+=t._uri_params.parent_view+"|"),n+=encodeURIComponent(e)}},{key:"popParentView",value:function(e){if("undefined"==typeof e&&(e=!0),void 0===this._uri_params.parent_view)return!1;var t=this._uri_params.parent_view.split("|"),n=decodeURIComponent(t.pop());0===t.length?this._uri_params.parent_view=void 0:this._uri_params.parent_view=t.join("|");var i="";return i=n?e?"#"+n+"/"+this._id:"#"+n:"#",t.length>0&&(i+="&parent_view="+t.join("|")),i}},{key:"getParentView",value:function(){var e=this;if(void 0===e._uri_params.parent_view)return!1;if(""===e._uri_params.parent_view)return e._uri_params.parent_view;var t=e._uri_params.parent_view.split("|");return decodeURIComponent(t.pop())}},{key:"updateReturnToParentView",value:function(){var e=this,t=e.getParentView();if(t){var n="BACK_TO_"+t.toUpperCase().split("/").splice(0,2).join("_"),i=$.app._(n);$(".hook_back_to_parent_view").text(i)}}}]),e}());t.default=s},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),l=function e(t,n,i){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,n,i)}if("value"in o)return o.value;var r=o.get;if(void 0!==r)return r.call(i)},h=n(5),c=(i(h),n(7)),p=i(c),d=function(e){function t(){o(this,t);var e=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e._can_save=!0,e._modified=!1,e._soft_modified=!1,e._wasClosing=!1,e}return r(t,e),u(t,[{key:"init",value:function(e){l(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"init",this).call(this,e),this._wasClosing=!1}},{key:"changed",value:function(e){$.app.debug&&console.debug("changed"),this._modified||(this._modified=!0)}},{key:"softModified",value:function(){$.app.debug&&console.debug("soft modified"),this._soft_modified||(this._soft_modified=!0)}},{key:"hook",value:function(e){var t=this;this._redrawn||!function(){$.app.debug&&console.debug("Hooking view");var n=t;$("#content form").on("change",":input[name]:not(.no-form-change)",function(){n.changed(this)}),$("#content form").on("keypress",":input[type=text]:not(.no-form-change),:input[type=password]:not(.no-form-change)",function(){n.changed(this)}),$(".number:not(.positive)").number(),$(".number.positive").number({positive:!0}),t._hook(e),n.updateReturnToParentView(),"Microsoft Internet Explorer"===navigator.appName&&($(window).data("beforeunload",window.onbeforeunload),$(document).on("mouseenter",'a[href^="javascript:"]',function(){window.onbeforeunload=null}).on("mouseleave",'a[href^="javascript:"]',function(){window.onbeforeunload=$(window).data("beforeunload")})),window.onbeforeunload=function(e){if($.app._beforeUnload(e),n._modified)return $.app._("SAVE_CHANGES_MESSAGE")}}()}},{key:"inject",value:function(e){$.app.debug&&console.debug("Injecting model"),this._soft_modified=!1,this._inject(e),this._modified=!1}},{key:"close",value:function(e){return $("#edit_form").off("**"),this._modified&&this._can_save?(this._wasClosing=!0,this.showSaveDialog(e),!1):p.default.prototype.close.call(this,e)}},{key:"getSaveChangeDialogHtml",value:function(){return'<div class="modal-dialog"><h2>'+$.app._("SAVE_CHANGES_TITLE")+"</h2><p>"+$.app._("SAVE_CHANGES_MESSAGE")+'</p><p class="submit"><a href="javascript:void(0);" id="hook_cancel_save_changes">'+$.app._("CANCEL")+'</a><input type="submit" id="hook_do_not_save_changes" value="'+$.app._("NO")+'" /><input type="submit" id="hook_do_save_changes" value="'+$.app._("YES")+'" /></p></div>'}},{key:"showSaveDialog",value:function(e){var t=this;"function"!=typeof e&&(e=function(){}),$.app.showModalDialog(t.getSaveChangeDialogHtml(),"normal",function(){$("#hook_do_save_changes").safeClick(function(){$.app.hideModalDialog("normal",function(){var n=t.save(!1,function(){e("save"),t.resume()},!1,!0);n||(t.stop(),e("cancel"))})}),$("#hook_do_not_save_changes").safeClick(function(){$.app.hideModalDialog("normal",function(){window.onbeforeunload=function(e){return $.app._beforeUnload(e)},t._canClose()?(t._modified=!1,t.resume(),e("resume")):(t._onCancelClose(),t.stop(),e("cancel"))})}),$("#hook_cancel_save_changes").safeClick(function(){$.app.hideModalDialog("normal",function(){t.stop(),e("cancel")})})})}},{key:"save",value:function(e,t,n,i){if(!this.validate())return this._onValidateFail(),!1;if(!this._can_save)return this._saveRedirect(e,i);if(!this._canSave())return this._onCancelSave(),!1;if(this._wasClosing&&!this._canClose())return this._onCancelClose(),!1;if("function"==typeof e&&(i=n,"function"==typeof t&&(n=t),t=e,e=!1),this._wasClosing&&(e=$.app.getResumeHash()),!this._modified&&!this._soft_modified)return"function"==typeof t&&(t({},!1),t=null),this._saveRedirect(e,i),!0;this._onSaveStart(),$("input[type=submit],input[type=button]").prop("disabled",!0);var o=this;$.app.showOverlay();var a=this._onSave();return window.onbeforeunload=function(e){return $.app._beforeUnload(e)},$.ajax({url:"index.php?k="+$.app.SESSION_KEY+"&view="+this._view+"&cmd=save&id="+this._id+a,type:"POST",data:this._saveBuildPost(),dataType:"json",headers:$.app.getXSRFHeaders(),success:function(a){a||(a={}),$.app.hideOverlay(),$("input[type=submit],input[type=button]").prop("disabled",!1);var r=a.validation_errors;return void 0===r&&(r=a.data?a.data.validation_errors:r),r&&r.length?void $.each(r,function(e,t){$("#"+t.field).hintError(t.message)}):"error"===a.status?($.app.debug&&console.debug("Save failed with error : "+a.message),void("function"==typeof n?(n(a),n=null):$.app.showError($.app._("SAVE_ERROR_OCCURED")))):(o._modified=!1,o._afterSave(),"function"==typeof t&&(t(a,!0),t=null),void o._saveRedirect(e,i))},error:function(e,t,i){o._saveErrorHandler(e,t,i,n)}}),!0}},{key:"_saveRedirect",value:function(e,t){t||(this._onClose(),"string"==typeof e?$.app.goTo(e):$.app.goBack())}},{key:"_saveErrorHandler",value:function(e,t,n,i){$.app.hideOverlay(),$("input[type=submit]").prop("disabled",!1),$.app.validateXHR(e)&&("function"==typeof i?(i(!1),i=null):$.app.showError($.app._("SAVE_ERROR_OCCURED")))}},{key:"_saveBuildPost",value:function(){return"&model="+encodeURIComponent($.toJSON(this.createModel()))}},{key:"validate",value:function(){return!0}},{key:"_onValidateFail",value:function(){}},{key:"_onSaveStart",value:function(){}},{key:"_canSave",value:function(){return $.app.debug&&$.app._throw("View does not implement _canSave function"),!0}},{key:"_onCancelSave",value:function(){}},{key:"_onSave",value:function(){return""}},{key:"_afterSave",value:function(){}},{key:"_onClose",value:function(){}},{key:"createModel",value:function(){var e={};return $("form input[name],select[name],textarea[name]").each(function(t,n){var i=$(n).val();"radio"===n.type||"checkbox"===n.type?n.checked&&("on"===i?e[n.name]="YES":e[n.name]=i):$(n).hasClass("money")?e[n.name]=$(n).moneyVal():$(n).hasClass("percent")?e[n.name]=$.app.parseFloat(i.replace("%","")):$(n).hasClass("number")?e[n.name]=$.app.parseFloat(i):e[n.name]=i}),this._onCreateModel&&(e=this._onCreateModel(e)),e=this._removeNullValue(e)}},{key:"_onCreateModel",value:function(e){return e}},{key:"_getRedirectionView",value:function(e,t){return(e||"")+"/View/"+(t||"")}},{key:"alternateCreateModel",value:function(e){var t={},n=function(e){return e.replace("]","")},i=function(e,t){var n={};return n[t]=e,n};for(var o in e)if(e.hasOwnProperty(o)){var a=o.split("[").map(n),r=a.reduceRight(i,e[o]);$.extend(!0,t,r)}return t}},{key:"_removeNullValue",value:function(e){if("object"===("undefined"==typeof e?"undefined":s(e)))for(var t in e)e[t]=this._removeNullValue(e[t]);else e||(e="");return e}},{key:"cancel",value:function(e){this._modified=!1,$("input[type=submit],input[type=button]").prop("disabled",!1),$.app.goBack(e)}},{key:"cancelTo",value:function(e){this._modified=!1,$("input[type=submit],input[type=button]").prop("disabled",!1),e=e||"",$.app.navigateBackTo(e)}},{key:"resume",value:function(){$.app.resume(!1)}},{key:"stop",value:function(){$.app.resume(!0)}}]),t}(p.default);t.default=d}]);