function AsyncTask(a){var b=this;this.options=$.extend({},this.defaults,a),this.options.pollDelay=Math.max(this.options.pollDelay,100),this._ajaxTimeoutId=0,this.retryCount=0,this._reset(),this._onWebSocketUpdate=function(a){b._update(a)},this._onAjaxUpdate=function(a){b._ajaxTimeoutId=0,b._update(a),(b.isPending()||b.isProcessing())&&b._pollServer()},this._onAjaxError=function(a){b._ajaxTimeoutId=0,b.inError=!0,b._notifyError(a.status,a.responseText)},this._ajaxUpdate=function(){$.ajax(b.queueUrl,{contentType:"application/json",error:b._onAjaxError,success:b._onAjaxUpdate})}}AsyncTask.prototype={defaults:{url:"",update:!1,error:!1,success:!1,cancel:!1,pollDelay:500,websocket:!1},_reset:function(){this.lastStatus={status:"pending",percentage:0,current:0,steps:0},this.started=!1,this.inError=!1,this.cancelled=!1,this.queueUrl=!1,this.result=!1},getStatus:function(){return this.lastStatus.status},isCompleted:function(){return"completed"==this.lastStatus.status},isPending:function(){return"pending"==this.lastStatus.status},isProcessing:function(){return"processing"==this.lastStatus.status},isCancelled:function(){return this.cancelled},isInError:function(){return this.inError},getPercentage:function(){return this.lastStatus.percentage},getCurrentStep:function(){return this.lastStatus.current},getSteps:function(){return this.lastStatus.steps},getResult:function(){return this.result},cancel:function(){return this.isPending()||this.isProcessing()?(this.options.websocket?this.sendWebSocketCancel():this._ajaxCancel(),!0):!1},_ajaxCancel:function(){clearTimeout(this._ajaxTimeoutId),this._ajaxTimeoutId=0,this.cancelled=!0;var a=this;$.ajax(this.queueUrl,{type:"DELETE",error:this._onAjaxError,success:function(){$.isFunction(a.options.cancel)&&a.options.cancel.call({},this)}})},retry:function(){return this.isCompleted()||this.isInError()?(this.retryCount++,this._reset(),this.start(),!0):!1},getRetryCount:function(){return this.retryCount},start:function(){if(this.started)return!1;this.started=!0;var a=this;return $.ajax(this.options.url,{error:this._onAjaxError,headers:{Accept:"poll"},success:function(b,c,d){202==d.status?(a.queueUrl=b.data.location,a._pollServer()):a._notifyError(d.status,d.responseText)}}),!0},_pollServer:function(){this._ajaxTimeoutId=setTimeout(this._ajaxUpdate,this.options.pollDelay)},_update:function(a){if((this.isPending()||this.isProcessing())&&this._statusChanged(a))switch(this.lastStatus=a,a.status){case"pending":case"processing":$.isFunction(this.options.update)&&this.options.update.call({},this,a.status,a.data.percentage,a.data.current,a.data.steps);break;case"completed":$.isFunction(this.options.success)&&this.options.success.call({},this,a.data.location,a.data.expires),this._close();break;case"cancelled":this.cancelled=!0,$.isFunction(this.options.cancel)&&this.options.cancel.call({},this),this._close();break;case"error":this.inError=!0,this._notifyError(500,"");break;default:console.debug("Unknown task status : ".statusUpdate.status)}},_statusChanged:function(a){return this.lastStatus.status!=a.status||this.lastStatus.data.percentage!=a.data.percentage||this.lastStatus.data.current!=a.data.current},_close:function(){this.websocket},_notifyError:function(a,b){$.isFunction(this.options.error)&&this.options.error.call({},this,a,b)}};
//# sourceMappingURL=async-api-task.min.map