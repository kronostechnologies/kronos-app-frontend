!function(a){var b={onStart:function(b){var c="jUploadPG"+b.id,d=a('<span id="'+c+'" style="display:none"></span>');return a(b.uploader).empty().append(d),d.progressBar(b.config.progressBarConfig),d},onProgress:function(a){a.node.progressBar(a.percentage)},onEnd:function(b){b.node.progressBar(100).slideToggle("slow",function(){a(this).progressBar(0)})}};a.extend({ajaxUploader:new function(){this.defaults={uploadFileName:"upload_file",uploadButtonLabel:"Upload",dataType:"json",autoUpload:!1,progressBarConfig:{},validateFileName:function(){return!0},passedInput:!1,callbacks:b,data:{}},this.construct=function(b){var c=b;return this.each(function(b){function d(b,c){var d="jUploadFrame"+b;if(a.browser.msie&&a.browser.version<9){var e=document.createElement('<iframe id="'+d+'" name="'+d+'" />');"boolean"==typeof c?e.src="javascript:false":"string"==typeof c&&(e.src=c)}else{var e=document.createElement("iframe");e.id=d,e.name=d}return e.style.position="absolute",e.style.top="-1000px",e.style.left="-1000px",document.body.appendChild(e),e}function e(b,c){var d="jUploadForm"+b,e="jUploadFile"+b,f="jApcProgress"+b,g=a('<form  action="" method="POST" name="'+d+'" id="'+d+'" enctype="multipart/form-data"></form>');if(a('<input id="'+f+'" name="APC_UPLOAD_PROGRESS" value="'+b+'"></input>').appendTo(g),"object"==typeof i.data)for(var h in i.data)i.data.hasOwnProperty(h)&&a("<input></input>").attr("name",h).val(i.data[h]).appendTo(g);var j=a("#"+c),k=a(j).clone();return a(j).attr("id",e),a(j).before(k),a(j).appendTo(g),a(g).css("position","absolute"),a(g).css("top","-1200px"),a(g).css("left","-1200px"),a(g).appendTo("body"),g}function f(b){if(b=jQuery.extend({},jQuery.ajaxSettings,b),!b.validateFileName(a("#"+b.uploadFileName).val()))return!1;var c=(new Date).getTime()+""+Math.round(1e4*Math.random()),f=e(c,b.uploadFileName),j=(d(c,b.secureuri),"jUploadFrame"+c),k="jUploadForm"+c,l=i.callbacks.onStart({config:i,uploader:h,id:c});b.global&&!jQuery.active++&&jQuery.event.trigger("ajaxStart");var m=!1,n={};b.global&&jQuery.event.trigger("ajaxSend",[n,b]);var o=function(c){var d=document.getElementById(j);try{d.contentWindow?(n.responseText=d.contentWindow.document.body?d.contentWindow.document.body.innerHTML:null,n.responseXML=d.contentWindow.document.XMLDocument?d.contentWindow.document.XMLDocument:d.contentWindow.document):d.contentDocument&&(n.responseText=d.contentDocument.document.body?d.contentDocument.document.body.innerHTML:null,n.responseXML=d.contentDocument.document.XMLDocument?d.contentDocument.document.XMLDocument:d.contentDocument.document)}catch(e){a.ajaxUploader.catchError(e)}if(n||"timeout"==c){m=!0;var h;try{if(h="timeout"!=c?"success":"error","error"!=h){var k=g(n,b.dataType);a.ajaxUploader.stopMonitorAjaxUpload(),i.callbacks.onEnd({node:l}),b.success&&b.success(k,h),b.global&&jQuery.event.trigger("ajaxSuccess",[n,b])}else a.ajaxUploader.catchError(e)}catch(e){a.ajaxUploader.stopMonitorAjaxUpload(),l.hide().progressBar(0),h="error",a.ajaxUploader.catchError(e)}b.global&&jQuery.event.trigger("ajaxComplete",[n,b]),b.global&&!--jQuery.active&&jQuery.event.trigger("ajaxStop"),b.complete&&b.complete(n,h),jQuery(d).unbind(),setTimeout(function(){try{a(d).remove(),a(f).remove()}catch(b){a.ajaxUploader.catchError(b)}},100),n=null}};b.timeout>0&&setTimeout(function(){m||o("timeout")},b.timeout),l.show(),a.ajaxUploader.monitorAjaxUpload(c,l,i);try{var f=a("#"+k);a(f).attr("action",b.url),a(f).attr("method","POST"),a(f).attr("target",j),f.encoding?f.encoding="multipart/form-data":f.enctype="multipart/form-data",a(f).submit()}catch(p){a.ajaxUploader.catchError(p)}return window.attachEvent?document.getElementById(j).attachEvent("onload",o):document.getElementById(j).addEventListener("load",o,!1),{abort:function(){}}}function g(a,b){var c=!b;return c="xml"==b||c?a.responseXML:a.responseText,"script"==b&&jQuery.globalEval(c),"json"==b&&(c=jQuery.secureEvalJSON(c)),"html"==b&&jQuery("<div>").html(c).evalScripts(),c}var h=this,i={};if(null!=h.config?null!=c&&(h.config=a.extend(!0,h.config,c)):i=a.extend(!0,{},a.ajaxUploader.defaults,c),i.passedInput)i.uploadFileName=i.passedInput.attr("id"),i.passedInput.change(function(){f(i)});else{var j=i.uploadFileName+"_button",k='<input id="'+i.uploadFileName+'" name="'+i.uploadFileName+'" type="file" size="45" class="input">';i.autoUpload||(k+='<a id="'+j+'" href="javascript:void(0);">'+i.uploadButtonLabel+"</a>"),a(h).html(k),i.autoUpload?a("#"+i.uploadFileName).change(function(){f(i)}):a("#"+j).click(function(){f(i)})}})},this.monitorAjaxUpload=function(b,c,d){var e=this;a.get("index.php?k="+a.app.SESSION_KEY+"&apcStat&apcUID="+b,function(b){if(b){var f=a.secureEvalJSON(b);if(f){var g=Math.floor(100*parseInt(f.current)/parseInt(f.total));d.callbacks.onProgress({percentage:g,node:c}),f.done&&e.stopMonitorAjaxUpload()}}}),e.lastAjaxMonitorTimeout=setTimeout(function(){a.ajaxUploader.monitorAjaxUpload(b,c,d)},500)},this.stopMonitorAjaxUpload=function(){var a=this;a.lastAjaxMonitorTimeout&&(clearTimeout(a.lastAjaxMonitorTimeout),a.lastAjaxMonitorTimeout=!1)},this.catchError=function(a){console.debug(a.message+" || stack : "+a.stack)}}}),a.fn.extend({ajaxUploader:a.ajaxUploader.construct})}(jQuery);
//# sourceMappingURL=jquery.ajaxUploader.min.map