!function($){var methods={init:function(options){var i=0;return this.each(function(){var $this=$(this),list={};if($.extend(!0,list,$.fn.list.defaults,options),list.ignoreLocaleEvent||($this.addClass("localeBound"),$this.bind("setLocaleEvent",function(){$.app.debug&&console.log("Locale event triggered element : ",this),$this.find(".pagination .prev").text($.app._("PREVIOUS")),$this.find(".pagination .next").text($.app._("NEXT"))})),0!=i&&(list.name+="."+i),i++,!list.name)throw"jQuery.list requires a name to be specified";if(!$.isArray(list.headers))throw"jQuery.list requires headers to be specified, must be an array";if(list.headers.length<1)throw"jQuery.list headers must contain at least one item, header can be a string or an object { field : string, label : string, sortable : boolean (default : false), escape : boolean (default : true), format : forgetrmatting function }";if(!$.isFunction(list.source))throw"jQuery.list requires a source callback";if(list.group&&!$.isPlainObject(list.group))throw'jQuery.list group option must be an object { field : "field_name", groupClass : "css-class", reset : boolean}';list.selector=$this,0==list.nbPages&&(list.nbPages=1),list.page>=list.nbPages&&(list.page=list.nbPages-1),list.pagingOptions.pages.current_page=list.page,list.pagingOptions.pages.items_per_page=0,list.pagingOptions.pages.link_to="javascript:void(0);",list.pagingOptions.pages.callback||(list.pagingOptions.pages.callback=function(page_index){list.setPage(page_index,list.nbPages)},list.pagingOptions.pages.callback(0,!1));var state=$.app.getContextValue("list."+list.name);if($.isPlainObject(state)){list.page=state.page,list.pagingOptions.pages.current_page=state.page,list.sort=state.sort,list.asc=state.asc;for(var k in state)k.substr(0,list.subContextPrefix.length+1)==list.subContextPrefix+"."&&(list.subContext[k.substr(list.subContextPrefix.length+1)]=state[k])}list.buildTable($this),list.pagination&&"undefined"!=typeof list.updatePagination[list.pagination]&&(list.updatePagination[list.pagination].call(list),$this.trigger("setLocaleEvent")),list.draw(),$this.data("list",list)})},options:function(){if(0==arguments.length||1==arguments.length&&"string"==typeof arguments[0]){var opts=new Array,args=arguments;return this.each(function(){var list=$(this).data("list");list&&opts.push({selector:this,options:list.getOptions.apply(list,args)})}),1==opts.length?opts[0].options:opts}return args=arguments,this.each(function(){var list=$(this).data("list");list&&list.setOptions.apply(list,args)})},update:function(type,params){return this.each(function(){var list=$(this).data("list");list&&list.update[type].call(list,params)})},fetch:function(){return this.each(function(){var list=$(this).data("list");list&&list.fetchData()})},data:function(data){if(0==arguments.length){var datas=new Array;return this.each(function(){var list=$(this).data("list");list&&datas.push({selector:this,data:list.data})}),1==datas.length?datas[0].data:datas}return this.each(function(){var list=$(this).data("list");list&&list.setData(data)})},sort:function(header,asc,update){if(0==arguments.length){var sorts=new Array;return this.each(function(){var list=$(this).data("list");list&&sorts.push({selector:this,sort:{field:list.sort,asc:list.asc}})}),1==sorts.length?sorts[0].sort:sorts}return this.each(function(){var list=$(this).data("list");list&&list.sortHeader(header,asc,update)})},page:function(page,update){if(0==arguments.length){var pages=new Array;return this.each(function(){var list=$(this).data("list");list&&pages.push({selector:this,page:{page:list.page,nbPages:list.nbPages}})}),1==pages.length?pages[0].page:pages}return this.each(function(){var list=$(this).data("list");list&&list.setPage(page,list.nbPages,update)})},setContextValue:function(key,value,update){return this.each(function(){var list=$(this).data("list");list&&list.setContextValue(key,value,update)})},getContextValue:function(key){var contexts=new Array;return this.each(function(){var list=$(this).data("list");list&&contexts.push({selector:this,context:list.getContextValue(key)})}),1==contexts.length?contexts[0].context:contexts},updateOddClasses:function(){return this.each(function(){var $this=$(this),list=$this.data("list"),$all_rows=$this.find("tbody tr");list.data&&$.isArray(list.data)&&0!=list.data.length&&(list.group&&list.group.groupClass&&($all_rows=$all_rows.not("."+list.group.groupClass)),$all_rows.each(function(i){var $this=$(this);list.oddClass&&$this.removeClass(list.oddClass),list.evenClass&&$this.removeClass(list.evenClass),i%2!=0&&list.oddClass?$this.addClass(list.oddClass):i%2==0&&list.evenClass&&$this.addClass(list.evenClass)}))})}};$.fn.list=function(method){if(!$.app)throw"jQuery.list cannot be used outside kronos-libs framework";return methods[method]?methods[method].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof method&&method?void $.error("Method "+method+" does not exist on jQuery.list"):methods.init.apply(this,arguments)},$.fn.list.defaults={headerClass:"",evenClass:"",oddClass:"",tableClass:"",data:!1,group:!1,pagination:!1,pagingOptions:{pages:{callback:!1,current_page:0,num_pages:0,items_per_page:1,link_to:"javascript:void(0);",num_display_entries:11,next_text:function(){return $.app._("NEXT")},next_show_always:!0,prev_text:function(){return $.app._("PREVIOUS")},prev_show_always:!0,num_edge_entries:1,ellipse_text:"...",autoHidePagination:!1},more:{text:$.app._("SHOW_MORE"),click:null}},page:0,nbPages:1,hasMore:!1,sort:!1,asc:!0,sortSafeClick:!0,subContext:{},subContextPrefix:"sub",ignoreLocaleEvent:!1,buildTable:function(){var html="<table"+(this.tableClass?' class="'+this.tableClass+'"':"")+">";html+="<thead><tr>";for(var i=0;i<this.headers.length;i++)html+='<th id="'+this.name+"_header_"+i+'" />';html+='</tr></thead><tbody></tbody></table><div id = "'+this.name+'_pagination" class="pagination-wrapper"></div>',this.selector.html(html),this.tableClass&&this.selector.find("table").addClass(this.tableClass),this.headerClass&&this.selector.find("thead tr").addClass(this.headerClass);for(var t=this,i=0;i<this.headers.length;i++)if($.isPlainObject(this.headers[i])&&this.headers[i].sortable){this.headers[i].sortField||(this.headers[i].sortField=this.headers[i].name);var $tmp_header=$("#"+this.name+"_header_"+i);$tmp_header.data("sortField",this.headers[i].sortField),$tmp_header.addClass("sortable"),this.sortSafeClick?$tmp_header.safeClick(function(){t.setPage(0,t.nbPages,!1),t.sortHeader($(this).data("sortField"))}):$tmp_header.click(function(){t.setPage(0,t.nbPages,!1),t.sortHeader($(this).data("sortField"))})}this.updateHeader()},updateHeader:function(){for(var currentHeader,i=0;i<this.headers.length;i++)if(currentHeader=$("#"+this.name+"_header_"+i),$.isPlainObject(this.headers[i])){var content=this.headers[i].label;if(1==this.headers[i].sortable){var lastSpace=content.lastIndexOf(" "),before=content.substring(0,lastSpace),after='<span class="nowrap">'+content.substring(lastSpace)+'<span class="sort-arrow"></span></span>';content=before+after}this.sort==this.headers[i].sortField?(currentHeader.addClass("sorted"),this.asc?currentHeader.addClass("asc"):currentHeader.removeClass("asc")):currentHeader.hasClass("sorted")&&currentHeader.removeClass("sorted"),this.headers[i].headerClasses&&currentHeader.addClass(this.headers[i].headerClasses),this.headers[i].nbsp&&(content=content.replace(" ","&nbsp;")),currentHeader.html(content)}else currentHeader.text($.app.htmlEntity(this.headers[i]))},sortHeader:function(header,asc,update){for(var i=0;i<this.headers.length;i++)if(this.headers[i].sortField==header)return this.asc="undefined"==typeof asc?this.sort==this.headers[i].sortField?!this.asc:!0:asc,this.sort=header,this.updateContext(),this.updateHeader(),(update||"undefined"==typeof update)&&this.fetchData(),!1;this.asc="undefined"==typeof asc?this.sort==header?!this.asc:!0:asc,this.sort=header,this.updateHeader(),(update||"undefined"==typeof update)&&this.fetchData()},fetchData:function(){0==this.page&&"more"==this.pagination&&this.clear(),this.source(this,this.page,this.sort,this.asc,this.subContext)},setData:function(data){this.data=data,this.draw()},draw:function(append){if(append||this.clear(),this.data&&$.isArray(this.data)&&0!=this.data.length)for(var previous_group=null,odd=!1,tbody=this.selector.find("tbody"),actual_rows_length=tbody.find("tr").length,t=this,i=0;i<this.data.length;i++){var current_i=actual_rows_length+i;if(this.group&&$.isPlainObject(this.group)){if(this.group.dotSeperatedKey===!0)var group_value=$.app.getByKey(this.data[i],this.group.field);else var group_value=this.data[i][this.group.field];group_value!=previous_group&&(tbody.append(this.drawGroup(group_value,this.data[i],this.group.field)),previous_group=group_value,(this.group.reset||"undefined"==typeof this.group.reset)&&(odd=!1))}tbody.append(this.drawRow(this.data[i],current_i,odd)),this.attachRowClick(i),odd=!odd,$.isFunction(this.click)&&$("#"+this.name+"_row_"+current_i).data("index",current_i).data("record",this.data[i]).safeClick(function(e){var $this=$(this);t.click($this.data("index"),$this.data("record"),e)})}else this.selector.find("tbody").append(this.noData())},clear:function(){this.selector.find("tbody tr").remove()},drawGroup:function(group,row,field){var html=this.group.format?this.group.format(group,row,field):group;this.group.escape!==!1&&(html=html.htmlEntity());var $td=$("<td></td>",{colspan:$.app.parseInt(this.headers.length)}).html(html),$tr=$("<tr></tr>",{"class":$.app.htmlEntity(this.group.groupClass)}).append($td);return $tr},drawRow:function(record,index,odd){var tr=$("<tr></tr>").attr("id",this.name+"_row_"+index);this.rowClass&&tr.addClass($.app.htmlEntity(this.rowClass)),odd&&this.oddClass?tr.addClass($.app.htmlEntity(this.oddClass)):!odd&&this.evenClass&&tr.addClass($.app.htmlEntity(this.evenClass));for(var i=0;i<this.headers.length;i++)if($.isPlainObject(record)&&$.isPlainObject(this.headers[i])){if(this.headers[i].dotSeperatedKey===!0)var value=$.app.getByKey(record,this.headers[i].name);else var value=record[this.headers[i].name];if(this.headers[i].format&&$.isFunction(this.headers[i].format))var formatted_value=this.headers[i].format(value,record,this,index);else formatted_value=value;var td=$("<td></td>").attr("id",this.name+"_row_"+index+"_"+i).data("index",index).data("i",i);this.headers[i].cellClasses&&td.addClass(this.headers[i].cellClasses),this.headers[i].escape!==!1?td.html($.app.htmlEntity(formatted_value)):"string"==typeof formatted_value?td.html(formatted_value):td.append(formatted_value),this.headers[i].hook&&$.isFunction(this.headers[i].hook)&&this.headers[i].hook(td,value,record),tr.append(td)}else tr.append($("<td></td>"));return tr},attachRowClick:function(index){for(var i=0;i<this.headers.length;i++)if($.isFunction(this.headers[i].click)){if($.isPlainObject(this.headers[i]))var value=this.data[index][this.headers[i].name];else value=this.data[index][i];{$("#"+this.name+"_row_"+index+"_"+i).data("list_click",{click:this.headers[i].click,value:value,record:this.data[index]}).safeClick(function(e){var list_click=$(this).data("list_click");list_click&&$.isFunction(list_click.click)&&list_click.click.call(this,list_click.value,list_click.record,e)})}}},noData:function(){return'<tr class="non-clickable-row'+(this.evenClass?" "+$.app.htmlEntity(this.evenClass):"")+'"><td colspan='+this.headers.length+'">'+$.app._("NO_RESULTS")+"</td></tr>"},click:function(){$.app.debug&&(console.debug("you can specify a click option to handle row clicks. Default : click(row, record) { }"),console.debug(arguments))},updatePagination:{pages:function(){$.isFunction(this.pagingOptions.pages.next_text)&&(this.pagingOptions.pages.next_text=this.pagingOptions.pages.next_text.call(this)),$.isFunction(this.pagingOptions.pages.prev_text)&&(this.pagingOptions.pages.prev_text=this.pagingOptions.pages.prev_text.call(this)),this.nbPages!=this.pagingOptions.pages.num_pages?(this.pagingOptions.pages.current_page=this.page,this.pagingOptions.pages.num_pages=this.nbPages,1==this.nbPages&&this.pagingOptions.pages.autoHidePagination?$("#"+this.name+"_pagination").empty():$("#"+this.name+"_pagination").pagination(this.nbPages,this.pagingOptions.pages)):this.page!=$("#"+this.name+"_pagination").data("current_page")&&$("#"+this.name+"_pagination").trigger("setPage",[this.page])},more:function(){var $paging=$("#"+this.name+"_pagination").empty().show();if(this.hasMore){var $link=$('<a href="javascript:void(0);">'+$.app._("SHOW_MORE")+"</a>"),t=this;$link.one("click",function(){t.page++,t.fetchData()}),$paging.addClass("show-more"),$paging.append($link)}else $paging.hide()}},setPage:function(page,nbPages,update){return this.page==page&&this.nbPages==nbPages?!1:(this.page=page,"undefined"!=typeof nbPages&&(this.nbPages=nbPages),this.nbPages<1&&(this.nbPages=1),this.page>=this.nbPages&&(this.page=this.nbPages-1),this.updateContext(),this.pagination&&this.updatePagination.pages.call(this),void((update||"undefined"==typeof update)&&this.fetchData()))},update:function(type,params){if("pages"==type){required_params=["page","nbPages","sort","asc","data"];for(p in required_params)if("undefined"==typeof required_params[p])throw new p+" is a required param for update.more (jQuery.list)";this.setPage(params.page,params.nbPages,!1),this.sortHeader(params.sort,params.asc,!1),this.setData(params.data)}else if("more"==type){required_params=["page","hasMore","sort","asc","data"];for(p in required_params)if("undefined"==typeof required_params[p])throw new p+" is a required param for update.pages (jQuery.list)";this.page=params.page,this.sortHeader(params.sort,params.asc,!1),this.data=params.data,this.hasMore=params.hasMore,this.updateContext(),this.updatePagination.more.call(this),this.draw(!0)}},setContextValue:function(key,value,update){this.subContext[key]=value,this.updateContext(),(update||"undefined"==typeof update)&&this.fetchData()},getContextValue:function(key){return this.subContext[key]},getContext:function(){var context={page:this.page,sort:this.sort,asc:this.asc};"pages"==this.paging?$.extend(context,this._extraContextPages()):"more"==this.paging&&$.extend(context,this._extraContextMore());for(var k in this.subContext)context[this.subContextPrefix+"."+k]=this.subContext[k];return context},_extraContextPages:function(){return{nbPages:this.nbPages}},_extaContextMore:function(){return{hasMore:this.hasMore}},setOptions:function(){if(1==arguments.length){if(!$.isPlainObject(arguments[0]))throw"jQuery.list internal setOptions need an object if only one argument is given";var options=arguments[0]}else{if(2!=arguments.length)throw"jQuery.list internal setOptions support only plain object or key/value arguments";var options={};options[arguments[0]]=arguments[1]}var header_changed=!1,page_changed=!1,sort_changed=!1,data_changed=!1,hasMore_changed=!1;for(var k in options)this[k]=options[k],"headers"==k?header_changed=!0:"sort"==k?sort_changed=!0:"asc"==k?sort_changed=!0:"page"==k?page_changed=!0:"nbPages"==k?page_changed=!0:"data"==k?data_changed=!0:"hasMore"==k&&(hasMore_changed=!0);this.updateContext(),header_changed&&this.buildTable(),page_changed&&"pages"==this.pagination&&this.updatePagination.pages.call(this),hasMore_changed&&this.updatePagination.more.call(this),sort_changed&&this.updateHeader(),data_changed&&this.draw()},updateContext:function(){$.app.setContextValue("list."+this.name,this.getContext())}}}(jQuery);
//# sourceMappingURL=list.min.map