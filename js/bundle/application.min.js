!function(e){function t(i){if(n[i])return n[i].exports;var a=n[i]={exports:{},id:i,loaded:!1};return e[i].call(a.exports,a,a.exports,t),a.loaded=!0,a.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";var i=n(1),a=n(2),o=n(3);e.exports={BaseApplication:i,View:a,EditView:o}},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=function(){function e(){n(this,e)}return a(e,[{key:"_JQInit",value:function(){this._JQ=jQuery(this)}},{key:"emit",value:function(e,t){this._JQ||this._JQInit(),this._JQ.trigger(e,t)}},{key:"once",value:function(e,t){this._JQ||this._JQInit(),this._JQ.one(e,t)}},{key:"on",value:function(e,t){this._JQ||this._JQInit(),this._JQ.bind(e,t)}},{key:"off",value:function(e,t){this._JQ||this._JQInit(),this._JQ.unbind(e,t)}}]),e}(),r=function(){function e(){n(this,e),this.view_fetching=!1,this.debug=!1,this.sendErrors=!1,this.sendErrorsOnUnload=!1,this.silent=!1,this.trace_retirement=!1,this._errors=[],this.ajaxQueryLoading=!1,this.pingInterval=!1,this.messages=!1,this.JS_PATH="/",this.IMG_PATH="/",this.VIRTUALPATH="/",this.SESSION_KEY=!1,this._is_observing_hash=!1,this._hash_changed_while_not_observing=!0,this.hash=!1,this._resume_hash="",this._history=[],this.userName="",this.cpanelUserName="",this.userVersion=0,this.menus=!1,this.views=!1,this.default_view="",this.default_goal_death="",this.default_goal_disability="",this.fna_expiration=365,this.currentView=!1,this._view_cache={},this._loadingDelay=3e3,this._loadingTimeout=0,this._view_objects={},this._messages={},this.emailRegex=/^[a-zA-Z0-9!#$%&'*+\-\/=?^_`{|}~]+(?:\.[a-zA-Z0-9!#$%&'*+\-\/=?^_`{|}~]+)*@[a-zA-Z0-9-]+(\.[a-zA-Z0-9-]+)*$/,this.currencyRegex=/^[0-9.,\s]+$/,this.percentageRegex=/^[0-9.,]+$/,this._ongoing_xhrs=[],this.eventEmitter=new o}return a(e,[{key:"init",value:function(){var e=this;window.console&&window.console.firebug||(window.console?window.console.debug||(window.console.debug=function(e){window.console.log(e)}):window.console={log:function(){},debug:function(){}}),$(document).ajaxStart(function(){e.ajaxQueryLoading=!0}),$(document).ajaxStop(function(){e.ajaxQueryLoading=!1}),this.pingInterval&&setInterval(function(){e.ajaxQueryLoading||e.get("CPanel/View","ping","",function(){console.debug("session is still alive")},!1,function(){console.debug("got an error while doing a ping ?")})},this.pingInterval),this._iPad="iPad"===navigator.userAgent.match(/iPad/),this._iPod="iPod"===navigator.userAgent.match(/iPod/),this._iPhone="iPhone"===navigator.userAgent.match(/iPhone/),this._blackberry="BlackBerry"===navigator.userAgent.match("/BlackBerry/")&&$.browser.webkit,this._palm_pre="webOS"===navigator.userAgent.match("/webOS/")&&$.browser.webkit,this._mobile=this._iPad||this._iPod||this._iPhone||this._blackberry||this._palm_pre,this._webkit=$.browser.webkit,this._opera=$.browser.opera,this._msie=$.browser.msie,this._mozilla=$.browser.mozilla,window.onerror=function(t,n,i){return"undefined"!=typeof window.UEInfo&&(window.errors.push(arguments),window.UEInfo.run()),e._onError(t,n,i)},window.onbeforeunload=function(){return e._beforeUnload()},window.name.match(/^GUID-/)||(window.name="GUID-"+$.app.generateGUID()),this.sprintf=this._sprintfWrapper.init,Date.prototype.getDayOfYear=function(){var e=new Date(this.getFullYear(),0,1);return Math.ceil((this-e)/864e5)},Date.prototype.getDaysInYear=function(){var e=new Date(this.getFullYear(),0,1),t=new Date(this.getFullYear(),11,31);return Math.ceil((t-e)/864e5+1)},jQuery.fn.extend({alternateText:function(e,t){return this.text(e&&""!==e?e:t),this},numberText:function(t){var n=e.formatNumber(t);return this.text(""===n?"0":n),this},moneyText:function(t){return this.text(e.formatMoney(t)),this},dateText:function(t){return this.text(e.date.format(t)),this},durationVal:function(e){var t=void 0;if(isFinite(e)){var n=e<0?"-":"",i=Math.floor(Math.abs(e)/12),a=Math.abs(e)-12*i;t=n+(0===i?"":(1===i?$.app._("YEARD").replace("%{years}",i):$.app._("YEARSD").replace("%{years}",i))+" ")+(0===a?"":1===a?$.app._("MONTHD").replace("%{months}",a):$.app._("MONTHSD").replace("%{months}",a))}else t="";return this.val(t),this},booleanText:function(e){return e="YES"===e?$.app._("YES"):"NO"===e?$.app._("NO"):"-",this.text(e),this},dateVal:function(t){return this.val(e.date.format(t,"input")),this},safeClick:function(e){return this.click(function(t){var n=this;this.__clicked?$.app.debug&&console.debug("catched double click"):!function(){n.__clicked=!0,e.call(n,t);var i=n;setTimeout(function(){i.__clicked=!1},500)}()}),this},numberVal:function(t,n){if(arguments.length>0)return $(this).val(e.formatNumber(t,n));var i=$.app.parseFloat(this.val());return $(this).hasClass("positive")&&$(this).hasClass("number")&&i<0?0:i},number:function(e){return $(this).each(function(){$(this).addClass("number"),$(this).val($.app.formatNumber($(this).val(),e)),$(this).blur(function(){$(this).val($.app.formatNumber($(this).val(),e))})})},moneyVal:function(t,n){if(arguments.length>0)return $(this).hasClass("money")?($(this).data("val",$.app.parseFloat(t.replace("$",""))),$(this).val(e.formatMoney(t,n))):$(this).val(e.formatMoney(t,n));if($(this).hasClass("money")){var i=$(this).data("val");return $(this).hasClass("positive")&&i<0?0:i}return $.app.parseFloat($(this).val().replace("$",""))},money:function(e){return $(this).each(function(){var t=$(this);t.addClass("money"),t.focus(function(){return $(this).val($(this).data("val")),this}),$(this).click(function(){$(this).select()}),$(this).blur(function(){var t=void 0,n=$(this).val();return e&&e.canBeNull&&(""===n||null===n)?t="":(t=$.app.parseFloat(n.replace("$","")),e&&e.true_precision&&(t=e.rounded?Math.round(t*Math.pow(10,e.true_precision))/Math.pow(10,e.true_precision):Math.floor(t*Math.pow(10,e.true_precision))/Math.pow(10,e.true_precision))),$(this).data("val",t),$(this).val($.app.formatMoney(t,e)),this}),""!==t.val()&&t.blur()})},percentVal:function(t,n){if(arguments.length>0)return $(this).val(e.formatPercent(t,n));var i=$.app.parseFloat(this.val().replace("%",""));return $(this).hasClass("positive")&&$(this).hasClass("percent")&&i<0?0:i},percent:function(e){return $(this).each(function(){$(this).addClass("percent"),$(this).val($.app.formatPercent($(this).val(),e)),$(this).blur(function(){$(this).val($.app.formatPercent($(this).val(),e))})})},SIN:function(){return $(this).each(function(){$(this).val($.app.formatSIN($(this).val())),$(this).blur(function(){this.value=$.app.formatSIN($(this).val())})})},datepickerInput:function(e){return $(this).each(function(){var t=$(this),n=t.next(".btn.calendar");if(0===t.next(".btn.calendar").length&&(n=$('<a href="javascript:void(0);" class="btn calendar" tabindex=-1><span class="icon"></span></a>')),t.after(n),$.browser.msie&&t.before($('<div class="clear"></div>')),t.width()&&t.css("width","-="+n.outerWidth(!0)).attr("autocomplete","off"),"undefined"!=typeof e){var i=$.extend({dateFormat:"yy-mm-dd",onClose:function(e){try{var t=$.datepicker.parseDate("yymmdd",e);$(this).val($.datepicker.formatDate("yy-mm-dd",t))}catch(t){$(this).val(e)}}},e);t.datepicker(i)}else t.datepicker({dateFormat:"yy-mm-dd",onClose:function(e){try{var t=$.datepicker.parseDate("yymmdd",e);$(this).val($.datepicker.formatDate("yy-mm-dd",t))}catch(t){$(this).val(e)}}});n.bind("click",function(e){e.preventDefault(),t.datepicker("widget").is(":hidden")&&t.datepicker("show")})})},hint:function(e,t){var n=Math.max(parseInt(t,10),200);return $(this).wrap('<span class="hinted"></span>').after('<span class="hint" style="width: '+n+"px; right: -"+(n+50)+'px;">'+e+'<span class="hint-pointer sprite">&nbsp;</span></span>').focus(function(){var e=this;e._focus_timeout=setTimeout(function(){$(e).next(".hint").fadeIn()},1e3)}).blur(function(){this._focus_timeout&&clearTimeout(this._focus_timeout),$(this).next(".hint").fadeOut()}).keypress(function(){this._focus_timeout&&clearTimeout(this._focus_timeout),$(this).next(".hint").fadeOut()})},unhint:function(){return $(this).parent().hasClass("hinted")?($(this).next(".hint").remove(),$(this).unwrap()):$(this).parent().find(".hinted")&&$(this).next(".hint").remove(),this},hintError:function(e,t,n){var i=void 0,a=$(this);a.combobox&&void 0!==a.combobox("instance")&&(a=a.combobox("instance").input,a.data("isCombobox",!0));var o=a;i=o.data("blur-field")?$("#"+o.data("blur-field")):o;var r=["hinted"];return a.data("is-textbox")&&(o=a.next().is(".hinted")?a.next().find(".textboxlist"):a.next(".textboxlist"),o.find(".textboxlist-bit-box-deletable").blur(function(){o.next(".hint").fadeOut()}).focus(function(){o.next(".hint").fadeIn()}).change(function(){$(o).handleHintErrorChange()})),(a.data("is-textbox")||o.hasClass("textboxlist"))&&(r.push("contain-textbox"),i=o.find(".textboxlist-bit-editable-input")),o.unhint(),o.addClass("save_warning"),o.data("no-hinted-span")||o.wrap('<span class="'+r.join(" ")+'"></span>'),o.after('<span class="hint">'+e+'<span class="hint-pointer sprite">&nbsp;</span></span>'),i.blur(function(){o.next(".hint").fadeOut()}).focus(function(){o.next(".hint").fadeIn()}).change(function(){$(o).handleHintErrorChange()}),o.data("hint",o.next(".hint")),o.setHintErrorWidth(t),o.setHintErrorPosition(),o.data("extra-hint-classes")&&o.parents(".hinted").addClass(o.data("extra-hint-classes")),o.data("hint").click(function(e){e.preventDefault(),e.stopPropagation(),$(this).fadeOut()}),n||o.data("hint").fadeIn(),o},handleHintErrorChange:function(){$(this).unhint().removeClass("save_warning")},setHintErrorWidth:function(e){var t=Math.max(parseInt(e,10),200);return $(this).next(".hint").css({width:t}),$(this)},setHintErrorPosition:function(){var e=-(parseInt($(this).data("hint").css("width"))+50);return $(this).data("hint").css({right:e}),$(this)},signal:function(e){return e=parseInt(e),e<=0&&(e=500),$(this).each(function(){$(this).addClass("signal");var t=this;setTimeout(function(){$(t).removeClass("signal")},e)})},checkVal:function(){if(arguments.length>0){var e=!1;return"YES"!=arguments[0]&&arguments[0]!==!0||(e=!0),this.prop("checked",e),this}return this.val()},toggleDisabled:function(e,t){void 0===t&&(t=!0),e?(this.attr("disabled","disabled"),t&&this.addClass("disabled")):(this.removeAttr("disabled"),t&&this.removeClass("disabled"))},getClasses:function(){var e=[];return $(this).each(function(){var t=$(this).attr("class").split(" ");for(var n in t){var i=!1;for(var a in e)e[a]==t[n]&&(i=!0);i||e.push(t[n])}}),e}}),String.prototype.htmlEntity=function(){return $.app.htmlEntity(this.toString())},String.prototype.nl2br=function(){return this.replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g,"$1<br />$2")},$("#hook_confidentiality_policy,#hook_usage_policy").safeClick(function(){$.app.showMessage($(this).text(),$.app._("AVAILABLE_SOON"))}),$.ajaxSetup({beforeSend:function(e){if(!this.crossDomain){var t=$.app.getXSRFHeaders();$.each(t,function(t,n){e.setRequestHeader(t,n)})}}}),this._init()}},{key:"_init",value:function(){}},{key:"configure",value:function(e){if(e.debug&&(this.debug=!0),e.sendError&&(this.sendErrors=!0),e.sendErrorsOnUnload&&(this.sendErrorsOnUnload=!0),e.silent&&(this.silent=!0),e.trace_retirement&&(this.trace_retirement=!0),e.jqueryui&&e.jqueryui.startingday&&(this.startingDay=e.jqueryui.startingday),this.JS_PATH=e.JS_PATH,this.IMG_PATH=e.IMG_PATH,this.VIRTUALPATH=e.VIRTUALPATH,this.SESSION_KEY=e.SESSION_KEY,this.replaced_session_key=!1,this._xsrf_cookie_name=e.xsrf_cookie_name,this._xsrf_header_name=e.xsrf_header_name,this.checkStoredSession(),!e.application_version)throw this._throw("Applicaiton version not defined in configuration",!0);if(this._application_version=e.application_version,"object"!==i(e.user))throw"No user info in application configuration";e&&e.sentry&&(Raven.config("https://"+e.sentry.key+"@app.getsentry.com/"+e.sentry.project,{release:e.application_version}).install(),Raven.setTagsContext({version:e.application_version}),Raven.setUserContext({email:e.user.email,id:e.user.id,name:e.user.name}),Raven.setExtraContext({transaction:e.kronos_transaction_id})),this._configure(e),this.setUserConfig(e.user);for(var t in this.views){var n=this.views[t];"1"===n.default&&(this.default_view=t)}}},{key:"_configure",value:function(){}},{key:"getApplicationVersion",value:function(){return this._application_version}}]),e}();t.default=r},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=n(1),s=(i(r),function(){function e(){a(this,e),this._view="",this._id=!1,this._uri_params={},this._redrawn=!1}return o(e,[{key:"changed",value:function(e){}},{key:"parseHash",value:function(e){var t=$.app.parseHash(e),n=t.view.indexOf("/");if(n>0){var i=t.view.indexOf("/",n+1);i>0&&(n=i,t.id=t.view.substr(n+1),t.view=t.view.substr(0,n))}else t.id=!1;return t}},{key:"onHashChange",value:function(e){var t=this.parseHash(e);return this._onHashChange(e,t)}},{key:"_onHashChange",value:function(e,t){return!1}},{key:"onScrollToAnchor",value:function(e,t){e.focus();var n=e.offset();window.scrollTo(n.left,n.top)}},{key:"init",value:function(e){var t=this.parseHash(e);this._uri=t,this._view=t.view,this._id=t.id,this._uri_params=t.params,this._controls={},this._init(e)}},{key:"_init",value:function(){$.app.debug&&$.app._throw("View does not implement _init function")}},{key:"load",value:function(e){$.app.performUnmounts(),this._load(e)}},{key:"_load",value:function(e){this.params=e}},{key:"draw",value:function(e){if($.app.performUnmounts(),this._onBeforeDraw(),this._canRedraw()){for(var t=this._getRedrawingSelectors(),n=!0,i=0;n&&i<t.length;i++)$(t[i]).length||(n=!1);if(t=null,n)return this._redrawn=!0,$.app.debug&&console.debug("Redrawing content"),void this._onDraw(!0)}this._redrawn=!1,$.app.debug&&console.debug("Drawing view"),$("#content").html(e),this._onDraw()}},{key:"_canRedraw",value:function(){return!1}},{key:"_getRedrawingSelectors",value:function(){return[]}},{key:"_onBeforeDraw",value:function(){}},{key:"_onDraw",value:function(e){}},{key:"hook",value:function(e){var t=this;t._redrawn||($.app.debug&&console.debug("Hooking view"),this._hook(e),t.updateReturnToParentView())}},{key:"_hook",value:function(e){$.app.debug&&$.app._throw("View does not implement _hook function")}},{key:"inject",value:function(e){$.app.debug&&console.debug("Injecting model"),this._inject(e)}},{key:"_inject",value:function(e){$.app.debug&&$.app._throw("View does not implement _inject function")}},{key:"close",value:function(e){var t=this._canClose();return t?this._onClose():this._onCancelClose(),"function"==typeof e&&e(),t}},{key:"_canClose",value:function(){return!0}},{key:"_onCancelClose",value:function(){$.app.debug&&$.app._throw("View does not implement _onCancelClose function")}},{key:"_onClose",value:function(){}},{key:"pushParentView",value:function(e){var t=this,n="";return t._uri_params.parent_view&&(n+=t._uri_params.parent_view+"|"),n+=encodeURIComponent(e)}},{key:"popParentView",value:function(e){if("undefined"==typeof e&&(e=!0),void 0===this._uri_params.parent_view)return!1;var t=this._uri_params.parent_view.split("|"),n=decodeURIComponent(t.pop());0===t.length?this._uri_params.parent_view=void 0:this._uri_params.parent_view=t.join("|");var i="";return i=n?e?"#"+n+"/"+this._id:"#"+n:"#",t.length>0&&(i+="&parent_view="+t.join("|")),i}},{key:"getParentView",value:function(){var e=this;if(void 0===e._uri_params.parent_view)return!1;if(""===e._uri_params.parent_view)return e._uri_params.parent_view;var t=e._uri_params.parent_view.split("|");return decodeURIComponent(t.pop())}},{key:"updateReturnToParentView",value:function(){var e=this,t=e.getParentView();if(t){var n="BACK_TO_"+t.toUpperCase().split("/").splice(0,2).join("_"),i=$.app._(n);$(".hook_back_to_parent_view").text(i)}}}]),e}());t.default=s},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),l=function e(t,n,i){null===t&&(t=Function.prototype);var a=Object.getOwnPropertyDescriptor(t,n);if(void 0===a){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,i)}if("value"in a)return a.value;var r=a.get;if(void 0!==r)return r.call(i)},c=n(1),h=(i(c),n(2)),p=i(h),f=function(e){function t(){a(this,t);var e=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e._can_save=!0,e._modified=!1,e._soft_modified=!1,e._wasClosing=!1,e}return r(t,e),u(t,[{key:"init",value:function(e){l(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"init",this).call(this,e),this._wasClosing=!1}},{key:"changed",value:function(e){$.app.debug&&console.debug("changed"),this._modified||(this._modified=!0)}},{key:"softModified",value:function(){$.app.debug&&console.debug("soft modified"),this._soft_modified||(this._soft_modified=!0)}},{key:"hook",value:function(e){var t=this;this._redrawn||!function(){$.app.debug&&console.debug("Hooking view");var n=t;$("#content form").on("change",":input[name]:not(.no-form-change)",function(){n.changed(this)}),$("#content form").on("keypress",":input[type=text]:not(.no-form-change),:input[type=password]:not(.no-form-change)",function(){n.changed(this)}),$(".number:not(.positive)").number(),$(".number.positive").number({positive:!0}),t._hook(e),n.updateReturnToParentView(),"Microsoft Internet Explorer"===navigator.appName&&($(window).data("beforeunload",window.onbeforeunload),$(document).on("mouseenter",'a[href^="javascript:"]',function(){window.onbeforeunload=null}).on("mouseleave",'a[href^="javascript:"]',function(){window.onbeforeunload=$(window).data("beforeunload")})),window.onbeforeunload=function(e){if($.app._beforeUnload(e),n._modified)return $.app._("SAVE_CHANGES_MESSAGE")}}()}},{key:"inject",value:function(e){$.app.debug&&console.debug("Injecting model"),this._soft_modified=!1,this._inject(e),this._modified=!1}},{key:"close",value:function(e){return $("#edit_form").off("**"),this._modified&&this._can_save?(this._wasClosing=!0,this.showSaveDialog(e),!1):p.default.prototype.close.call(this,e)}},{key:"getSaveChangeDialogHtml",value:function(){return'<div class="modal-dialog"><h2>'+$.app._("SAVE_CHANGES_TITLE")+"</h2><p>"+$.app._("SAVE_CHANGES_MESSAGE")+'</p><p class="submit"><a href="javascript:void(0);" id="hook_cancel_save_changes">'+$.app._("CANCEL")+'</a><input type="submit" id="hook_do_not_save_changes" value="'+$.app._("NO")+'" /><input type="submit" id="hook_do_save_changes" value="'+$.app._("YES")+'" /></p></div>'}},{key:"showSaveDialog",value:function(e){var t=this;"function"!=typeof e&&(e=function(){}),$.app.showModalDialog(t.getSaveChangeDialogHtml(),"normal",function(){$("#hook_do_save_changes").safeClick(function(){$.app.hideModalDialog("normal",function(){var n=t.save(!1,function(){e("save"),t.resume()},!1,!0);n||(t.stop(),e("cancel"))})}),$("#hook_do_not_save_changes").safeClick(function(){$.app.hideModalDialog("normal",function(){window.onbeforeunload=function(e){return $.app._beforeUnload(e)},t._canClose()?(t._modified=!1,t.resume(),e("resume")):(t._onCancelClose(),t.stop(),e("cancel"))})}),$("#hook_cancel_save_changes").safeClick(function(){$.app.hideModalDialog("normal",function(){t.stop(),e("cancel")})})})}},{key:"save",value:function(e,t,n,i){if(!this.validate())return this._onValidateFail(),!1;if(!this._can_save)return this._saveRedirect(e,i);if(!this._canSave())return this._onCancelSave(),!1;if(this._wasClosing&&!this._canClose())return this._onCancelClose(),!1;if("function"==typeof e&&(i=n,"function"==typeof t&&(n=t),t=e,e=!1),this._wasClosing&&(e=$.app.getResumeHash()),!this._modified&&!this._soft_modified)return"function"==typeof t&&(t({},!1),t=null),this._saveRedirect(e,i),!0;this._onSaveStart(),$("input[type=submit],input[type=button]").prop("disabled",!0);var a=this;$.app.showOverlay();var o=this._onSave();return window.onbeforeunload=function(e){return $.app._beforeUnload(e)},$.ajax({url:"index.php?k="+$.app.SESSION_KEY+"&view="+this._view+"&cmd=save&id="+this._id+o,type:"POST",data:this._saveBuildPost(),dataType:"json",headers:$.app.getXSRFHeaders(),success:function(o){o||(o={}),$.app.hideOverlay(),$("input[type=submit],input[type=button]").prop("disabled",!1);var r=o.validation_errors;return void 0===r&&(r=o.data?o.data.validation_errors:r),r&&r.length?void $.each(r,function(e,t){$("#"+t.field).hintError(t.message)}):"error"===o.status?($.app.debug&&console.debug("Save failed with error : "+o.message),void("function"==typeof n?(n(o),n=null):$.app.showError($.app._("SAVE_ERROR_OCCURED")))):(a._modified=!1,a._afterSave(),"function"==typeof t&&(t(o,!0),t=null),void a._saveRedirect(e,i))},error:function(e,t,i){a._saveErrorHandler(e,t,i,n)}}),!0}},{key:"_saveRedirect",value:function(e,t){t||(this._onClose(),"string"==typeof e?$.app.goTo(e):$.app.goBack())}},{key:"_saveErrorHandler",value:function(e,t,n,i){$.app.hideOverlay(),$("input[type=submit]").prop("disabled",!1),$.app.validateXHR(e)&&("function"==typeof i?(i(!1),i=null):$.app.showError($.app._("SAVE_ERROR_OCCURED")))}},{key:"_saveBuildPost",value:function(){return"&model="+encodeURIComponent($.toJSON(this.createModel()))}},{key:"validate",value:function(){return!0}},{key:"_onValidateFail",value:function(){}},{key:"_onSaveStart",value:function(){}},{key:"_canSave",value:function(){return $.app.debug&&$.app._throw("View does not implement _canSave function"),!0}},{key:"_onCancelSave",value:function(){}},{key:"_onSave",value:function(){return""}},{key:"_afterSave",value:function(){}},{key:"_onClose",value:function(){}},{key:"createModel",value:function(){var e={};return $("form input[name],select[name],textarea[name]").each(function(t,n){var i=$(n).val();"radio"===n.type||"checkbox"===n.type?n.checked&&("on"===i?e[n.name]="YES":e[n.name]=i):$(n).hasClass("money")?e[n.name]=$(n).moneyVal():$(n).hasClass("percent")?e[n.name]=$.app.parseFloat(i.replace("%","")):$(n).hasClass("number")?e[n.name]=$.app.parseFloat(i):e[n.name]=i}),this._onCreateModel&&(e=this._onCreateModel(e)),e=this._removeNullValue(e)}},{key:"_onCreateModel",value:function(e){return e}},{key:"_getRedirectionView",value:function(e,t){return(e||"")+"/View/"+(t||"")}},{key:"alternateCreateModel",value:function(e){var t={},n=function(e){return e.replace("]","")},i=function(e,t){var n={};return n[t]=e,n};for(var a in e)if(e.hasOwnProperty(a)){var o=a.split("[").map(n),r=o.reduceRight(i,e[a]);$.extend(!0,t,r)}return t}},{key:"_removeNullValue",value:function(e){if("object"===("undefined"==typeof e?"undefined":s(e)))for(var t in e)e[t]=this._removeNullValue(e[t]);else e||(e="");return e}},{key:"cancel",value:function(e){this._modified=!1,$("input[type=submit],input[type=button]").prop("disabled",!1),$.app.goBack(e)}},{key:"cancelTo",value:function(e){this._modified=!1,$("input[type=submit],input[type=button]").prop("disabled",!1),e=e||"",$.app.navigateBackTo(e)}},{key:"resume",value:function(){$.app.resume(!1)}},{key:"stop",value:function(){$.app.resume(!0)}}]),t}(p.default);t.default=f}]);