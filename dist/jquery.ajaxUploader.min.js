!function($){var defaultCallbacks={onStart:function(options){var progressBarElementId="jUploadPG"+options.id,progressBarNode=$('<span id="'+progressBarElementId+'" style="display:none"></span>');return $(options.uploader).empty().append(progressBarNode),progressBarNode.progressBar(options.config.progressBarConfig),progressBarNode},onProgress:function(options){options.node.progressBar(options.percentage)},onEnd:function(options){options.node.progressBar(100).slideToggle("slow",function(){$(this).progressBar(0)})}};$.extend({ajaxUploader:new function(){this.defaults={uploadFileName:"upload_file",uploadButtonLabel:"Upload",dataType:"json",autoUpload:!1,progressBarConfig:{},validateFileName:function(){return!0},passedInput:!1,callbacks:defaultCallbacks},this.construct=function(config){var argconfig=config;return this.each(function(){function createUploadIframe(id,uri){var frameId="jUploadFrame"+id;if(window.ActiveXObject){var io=document.createElement('<iframe id="'+frameId+'" name="'+frameId+'" />');"boolean"==typeof uri?io.src="javascript:false":"string"==typeof uri&&(io.src=uri)}else{var io=document.createElement("iframe");io.id=frameId,io.name=frameId}return io.style.position="absolute",io.style.top="-1000px",io.style.left="-1000px",document.body.appendChild(io),io}function createUploadForm(id,fileElementId){var formId="jUploadForm"+id,fileId="jUploadFile"+id,apcInputId="jApcProgress"+id,form=$('<form  action="" method="POST" name="'+formId+'" id="'+formId+'" enctype="multipart/form-data"></form>');$('<input id="'+apcInputId+'" name="APC_UPLOAD_PROGRESS" value="'+id+'"></input>').appendTo(form);var oldElement=$("#"+fileElementId),newElement=$(oldElement).clone();return $(oldElement).attr("id",fileId),$(oldElement).before(newElement),$(oldElement).appendTo(form),$(form).css("position","absolute"),$(form).css("top","-1200px"),$(form).css("left","-1200px"),$(form).appendTo("body"),form}function ajaxFileUpload(s){if(s=jQuery.extend({},jQuery.ajaxSettings,s),!s.validateFileName($("#"+s.uploadFileName).val()))return!1;var id=(new Date).getTime()+""+Math.round(1e4*Math.random()),form=createUploadForm(id,s.uploadFileName),frameId=(createUploadIframe(id,s.secureuri),"jUploadFrame"+id),formId="jUploadForm"+id,progressBarNode=config.callbacks.onStart({config:config,uploader:uploader,id:id});s.global&&!jQuery.active++&&jQuery.event.trigger("ajaxStart");var requestDone=!1,xml={};s.global&&jQuery.event.trigger("ajaxSend",[xml,s]);var uploadCallback=function(isTimeout){var io=document.getElementById(frameId);try{io.contentWindow?(xml.responseText=io.contentWindow.document.body?io.contentWindow.document.body.innerHTML:null,xml.responseXML=io.contentWindow.document.XMLDocument?io.contentWindow.document.XMLDocument:io.contentWindow.document):io.contentDocument&&(xml.responseText=io.contentDocument.document.body?io.contentDocument.document.body.innerHTML:null,xml.responseXML=io.contentDocument.document.XMLDocument?io.contentDocument.document.XMLDocument:io.contentDocument.document)}catch(e){$.ajaxUploader.catchError(e)}if(xml||"timeout"==isTimeout){requestDone=!0;var status;try{if(status="timeout"!=isTimeout?"success":"error","error"!=status){var data=uploadHttpData(xml,s.dataType);$.ajaxUploader.stopMonitorAjaxUpload(),config.callbacks.onEnd({node:progressBarNode}),s.success&&s.success(data,status),s.global&&jQuery.event.trigger("ajaxSuccess",[xml,s])}else $.ajaxUploader.catchError(e)}catch(e){$.ajaxUploader.stopMonitorAjaxUpload(),progressBarNode.hide().progressBar(0),status="error",$.ajaxUploader.catchError(e)}s.global&&jQuery.event.trigger("ajaxComplete",[xml,s]),s.global&&!--jQuery.active&&jQuery.event.trigger("ajaxStop"),s.complete&&s.complete(xml,status),jQuery(io).unbind(),setTimeout(function(){try{$(io).remove(),$(form).remove()}catch(e){$.ajaxUploader.catchError(e)}},100),xml=null}};s.timeout>0&&setTimeout(function(){requestDone||uploadCallback("timeout")},s.timeout),progressBarNode.show(),$.ajaxUploader.monitorAjaxUpload(id,progressBarNode,config);try{var form=$("#"+formId);$(form).attr("action",s.url),$(form).attr("method","POST"),$(form).attr("target",frameId),form.encoding?form.encoding="multipart/form-data":form.enctype="multipart/form-data",$(form).submit()}catch(e){$.ajaxUploader.catchError(e)}return window.attachEvent?document.getElementById(frameId).attachEvent("onload",uploadCallback):document.getElementById(frameId).addEventListener("load",uploadCallback,!1),{abort:function(){}}}function uploadHttpData(r,type){var data=!type;return data="xml"==type||data?r.responseXML:r.responseText,"script"==type&&jQuery.globalEval(data),"json"==type&&(data=jQuery.secureEvalJSON(data)),"html"==type&&jQuery("<div>").html(data).evalScripts(),data}var uploader=this,config={};if(null!=uploader.config?null!=argconfig&&(uploader.config=$.extend(!0,uploader.config,argconfig)):config=$.extend(!0,{},$.ajaxUploader.defaults,argconfig),config.passedInput)config.uploadFileName=config.passedInput.attr("id"),config.passedInput.change(function(){ajaxFileUpload(config)});else{var uploadButtonId=config.uploadFileName+"_button",html='<input id="'+config.uploadFileName+'" name="'+config.uploadFileName+'" type="file" size="45" class="input">';config.autoUpload||(html+='<a id="'+uploadButtonId+'" href="javascript:void(0);">'+config.uploadButtonLabel+"</a>"),$(uploader).html(html),config.autoUpload?$("#"+config.uploadFileName).change(function(){ajaxFileUpload(config)}):$("#"+uploadButtonId).click(function(){ajaxFileUpload(config)})}})},this.monitorAjaxUpload=function(progress_key,progressbar_control,config){var t=this;$.get("index.php?k="+$.app.SESSION_KEY+"&apcStat&apcUID="+progress_key,function(data){if(data){var response=$.secureEvalJSON(data);if(response){var percentage=Math.floor(100*parseInt(response.current)/parseInt(response.total));config.callbacks.onProgress({percentage:percentage,node:progressbar_control}),response.done&&t.stopMonitorAjaxUpload()}}}),t.lastAjaxMonitorTimeout=setTimeout(function(){$.ajaxUploader.monitorAjaxUpload(progress_key,progressbar_control,config)},500)},this.stopMonitorAjaxUpload=function(){var t=this;t.lastAjaxMonitorTimeout&&(clearTimeout(t.lastAjaxMonitorTimeout),t.lastAjaxMonitorTimeout=!1)},this.catchError=function(e){console.debug(e.message+" || stack : "+e.stack)}}}),$.fn.extend({ajaxUploader:$.ajaxUploader.construct})}(jQuery);
//# sourceMappingURL=jquery.ajaxUploader.min.map