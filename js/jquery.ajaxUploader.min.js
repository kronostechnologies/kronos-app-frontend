!function(a){var b={onStart:function(b){var c="jUploadPG"+b.id,d=a('<span id="'+c+'" style="display:none"></span>');return a(b.uploader).empty().append(d),d.progressBar(b.config.progressBarConfig),d},onProgress:function(a){a.node.progressBar(a.percentage)},onEnd:function(b){b.node.progressBar(100).slideToggle("slow",function(){a(this).progressBar(0)})}};a.extend({ajaxUploader:new function(){this.defaults={uploadFileName:"upload_file",uploadButtonLabel:"Upload",dataType:"json",autoUpload:!1,progressBarConfig:{},validateFileName:function(){return!0},passedInput:!1,callbacks:b,data:{}},this.construct=function(b){var c=b;return this.each(function(){function b(a){var b="jUploadFrame"+a,c=document.createElement("iframe");return c.id=b,c.name=b,c.style.position="absolute",c.style.top="-1000px",c.style.left="-1000px",document.body.appendChild(c),c}function d(b,c){var d="jUploadForm"+b,e="jUploadFile"+b,f="jApcProgress"+b,g=a('<form action="" method="POST" name="'+d+'" id="'+d+'" enctype="multipart/form-data"></form>');if(a('<input id="'+f+'" name="APC_UPLOAD_PROGRESS" value="'+b+'">').appendTo(g),"object"==typeof h.data)for(var i in h.data)h.data.hasOwnProperty(i)&&a("<input>").attr("name",i).val(h.data[i]).appendTo(g);var j=a("#"+c),k=a(j).clone();return a(j).attr("id",e),a(j).before(k),a(j).appendTo(g),a(g).css("position","absolute"),a(g).css("top","-1200px"),a(g).css("left","-1200px"),a(g).appendTo("body"),g}function e(c){if(c=jQuery.extend({},jQuery.ajaxSettings,c),!c.validateFileName(a("#"+c.uploadFileName).val()))return!1;var e=(new Date).getTime()+""+Math.round(1e4*Math.random()),i=d(e,c.uploadFileName),j=(b(e),"jUploadFrame"+e),k="jUploadForm"+e,l=h.callbacks.onStart({config:h,uploader:g,id:e});c.global&&!jQuery.active++&&jQuery.event.trigger("ajaxStart");var m=!1,n={};c.global&&jQuery.event.trigger("ajaxSend",[n,c]);var o=function(b){var d=document.getElementById(j);try{var e=null;d.contentWindow?e=d.contentWindow.document:d.contentDocument&&(e=d.contentDocument.document),e&&(n.responseText=e.body?e.body.innerText:null,n.responseHTML=e.body?e.body.innerHTML:null,n.responseXML=e.XMLDocument?e.XMLDocument:e)}catch(g){a.ajaxUploader.catchError(g)}if(n||"timeout"==b){m=!0;var k="timeout"!==b?"success":"error";try{if("error"!==k){var o=f(n,c.dataType);a.ajaxUploader.stopMonitorAjaxUpload(),h.callbacks.onEnd({node:l}),c.success&&c.success(o,k),c.global&&jQuery.event.trigger("ajaxSuccess",[n,c])}else a.ajaxUploader.catchError(g)}catch(g){a.ajaxUploader.stopMonitorAjaxUpload(),l.hide().progressBar(0),k="error",a.ajaxUploader.catchError(g)}c.global&&jQuery.event.trigger("ajaxComplete",[n,c]),c.global&&!--jQuery.active&&jQuery.event.trigger("ajaxStop"),c.complete&&c.complete(n,k),jQuery(d).unbind(),setTimeout(function(){try{a(d).remove(),a(i).remove()}catch(b){a.ajaxUploader.catchError(b)}},100),n=null}};c.timeout>0&&setTimeout(function(){m||o("timeout")},c.timeout),l.show(),a.ajaxUploader.monitorAjaxUpload(e,l,h);try{var p=a("#"+k);p.attr("action",c.url),p.attr("method","post"),p.attr("target",j),p.attr("enctype","multipart/form-data"),p.submit()}catch(q){a.ajaxUploader.catchError(q)}return window.attachEvent?document.getElementById(j).attachEvent("onload",o):document.getElementById(j).addEventListener("load",o,!1),{abort:function(){}}}function f(a,b){var c=!1;switch(b){case"script":jQuery.globalEval(a.responseHTML);break;case"json":c=jQuery.secureEvalJSON(a.responseText);break;case"html":jQuery("<div>").html(a.responseHTML).evalScripts();break;default:c=a.responseXML}return c}var g=this,h={};if(null!=g.config?null!=c&&(g.config=a.extend(!0,g.config,c)):h=a.extend(!0,{},a.ajaxUploader.defaults,c),h.passedInput)h.uploadFileName=h.passedInput.attr("id"),h.passedInput.change(function(){e(h)});else{var i=h.uploadFileName+"_button",j='<input id="'+h.uploadFileName+'" name="'+h.uploadFileName+'" type="file" size="45" class="input">';h.autoUpload||(j+='<a id="'+i+'" href="javascript:void(0);">'+h.uploadButtonLabel+"</a>"),a(g).html(j),h.autoUpload?a("#"+h.uploadFileName).change(function(){e(h)}):a("#"+i).click(function(){e(h)})}})},this.monitorAjaxUpload=function(b,c,d){var e=this;a.get("index.php?k="+a.app.SESSION_KEY+"&apcStat&apcUID="+b,function(b){if(b){var f=a.secureEvalJSON(b);if(f){var g=Math.floor(100*parseInt(f.current)/parseInt(f.total));d.callbacks.onProgress({percentage:g,node:c}),f.done&&e.stopMonitorAjaxUpload()}}}),e.lastAjaxMonitorTimeout=setTimeout(function(){a.ajaxUploader.monitorAjaxUpload(b,c,d)},500)},this.stopMonitorAjaxUpload=function(){var a=this;a.lastAjaxMonitorTimeout&&(clearTimeout(a.lastAjaxMonitorTimeout),a.lastAjaxMonitorTimeout=!1)},this.catchError=function(a){console.debug(a.message+" || stack : "+a.stack)}}}),a.fn.extend({ajaxUploader:a.ajaxUploader.construct})}(jQuery);
//# sourceMappingURL=jquery.ajaxUploader.min.map