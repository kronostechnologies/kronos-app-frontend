function View(){this._view="",this._id=!1,this._uri_params={},this._controls={},this._redrawn=!1}function EditView(){this._can_save=!0,this._modified=!1,this._soft_modified=!1,this._wasClosing=!1,this.validation_rules={},this.validation_conditions={}}var app={view_fetching:!1,debug:!1,sendErrors:!1,sendErrorsOnUnload:!1,silent:!1,trace_retirement:!1,_errors:[],ajaxQueryLoading:!1,pingInterval:!1,messages:!1,JS_PATH:"/",IMG_PATH:"/",VIRTUALPATH:"/",SESSION_KEY:!1,hash:!1,_resume_hash:"",_observerInterval:0,_history:[],userName:"",cpanelUserName:"",userVersion:0,menus:!1,views:!1,default_view:"",default_goal_death:"",default_goal_disability:"",fna_expiration:365,currentView:!1,_view_cache:{},_loadingDelay:3e3,_loadingTimeout:0,_view_objects:{},_messages:{},emailRegex:new RegExp("^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.(?:[a-zA-Z]{2}|com|org|net|gov|mil|biz|info|mobi|name|aero|jobs|museum)$"),_visualization_ready:!1,init:function(){var a=this;window.console&&window.console.firebug||(window.console?window.console.debug||(window.console.debug=function(a){window.console.log(a)}):window.console={log:function(){},debug:function(){}}),$(document).ajaxStart(function(){a.ajaxQueryLoading=!0}),$(document).ajaxStop(function(){a.ajaxQueryLoading=!1}),this.pingInterval&&setInterval(function(){a.ajaxQueryLoading||a.get("CPanel/View","ping","",function(){console.debug("session is still alive")},!1,function(){console.debug("got an error while doing a ping ?")})},this.pingInterval),this._iPad="iPad"==navigator.userAgent.match(/iPad/),this._iPod="iPod"==navigator.userAgent.match(/iPod/),this._iPhone="iPhone"==navigator.userAgent.match(/iPhone/),this._blackberry="BlackBerry"==navigator.userAgent.match("/BlackBerry/")&&$.browser.webkit,this._palm_pre="webOS"==navigator.userAgent.match("/webOS/")&&$.browser.webkit,this._mobile=this._iPad||this._iPod||this._iPhone||this._blackberry||this._palm_pre,this._webkit=$.browser.webkit,this._opera=$.browser.opera,this._msie=$.browser.msie,this._mozilla=$.browser.mozilla,window.onerror=function(b,c,d){return a._onError(b,c,d)},window.onbeforeunload=function(){return a._beforeUnload()},this.sprintf=this._sprintfWrapper.init,Date.prototype.getDayOfYear=function(){var a=new Date(this.getFullYear(),0,1);return Math.ceil((this-a)/864e5)},Date.prototype.getDaysInYear=function(){var a=new Date(this.getFullYear(),0,1),b=new Date(this.getFullYear(),11,31);return Math.ceil((b-a)/864e5+1)},$("<div></div>").ajaxSend(function(a,b){b&&"undefined"!=typeof b&&"function"==typeof b.setRequestHeader&&b.setRequestHeader("X-Kronos-Ajax",1)}).ajaxError(function(a,b){return $.app.validateXHR(b)?void 0:!1}),jQuery.fn.extend({alternateText:function(a,b){return this.text(a&&""!==a?a:b),this},numberText:function(b){var c=a.formatNumber(b);return this.text(""===c?"0":c),this},moneyText:function(b){return this.text(a.formatMoney(b)),this},dateText:function(b){return this.text(a.date.format(b)),this},durationVal:function(a){var b;if(isFinite(a)){var c=0>a?"-":"",d=Math.floor(Math.abs(a)/12),e=Math.abs(a)-12*d;b=c+(0===d?"":(1==d?$.app._("YEARD").replace("%{years}",d):$.app._("YEARSD").replace("%{years}",d))+" ")+(0===e?"":1==e?$.app._("MONTHD").replace("%{months}",e):$.app._("MONTHSD").replace("%{months}",e))}else b="";return this.val(b),this},booleanText:function(a){return a="YES"==a?$.app._("YES"):"NO"==a?$.app._("NO"):"-",this.text(a),this},dateVal:function(b){return this.val(a.date.format(b,"input")),this},safeClick:function(a){return this.click(function(b){if(this.__clicked)$.app.debug&&console.debug("catched double click");else{this.__clicked=!0,a.call(this,b);var c=this;setTimeout(function(){c.__clicked=!1},500)}}),this},numberVal:function(b,c){if(arguments.length>0)return $(this).val(a.formatNumber(b,c));var d=$.app.parseFloat(this.val());return $(this).hasClass("positive")&&$(this).hasClass("number")&&0>d?0:d},number:function(a){return $(this).each(function(){$(this).addClass("number"),$(this).val($.app.formatNumber($(this).val(),a)),$(this).blur(function(){$(this).val($.app.formatNumber($(this).val(),a))})})},moneyVal:function(b,c){if(arguments.length>0)return $(this).hasClass("money")?($(this).data("val",$.app.parseFloat(b.replace("$",""))),$(this).val(a.formatMoney(b,c))):$(this).val(a.formatMoney(b,c));if($(this).hasClass("money")){var d=$(this).data("val");return $(this).hasClass("positive")&&0>d?0:d}return $.app.parseFloat($(this).val().replace("$",""))},money:function(a){return $(this).each(function(){var b=$(this);b.addClass("money"),b.focus(function(){return $(this).val($(this).data("val")),this}),$(this).click(function(){$(this).select()}),$(this).blur(function(){var b,c=$(this).val();return a&&a.canBeNull&&(""===c||null===c)?b="":(b=$.app.parseFloat(c.replace("$","")),a&&a.true_precision&&(b=a.rounded?Math.round(b*Math.pow(10,a.true_precision))/Math.pow(10,a.true_precision):Math.floor(b*Math.pow(10,a.true_precision))/Math.pow(10,a.true_precision))),$(this).data("val",b),$(this).val($.app.formatMoney(b,a)),this}),""!==b.val()&&b.blur()})},percentVal:function(b,c){if(arguments.length>0)return $(this).val(a.formatPercent(b,c));var d=$.app.parseFloat(this.val().replace("%",""));return $(this).hasClass("positive")&&$(this).hasClass("percent")&&0>d?0:d},percent:function(a){return $(this).each(function(){$(this).addClass("percent"),$(this).val($.app.formatPercent($(this).val(),a)),$(this).blur(function(){$(this).val($.app.formatPercent($(this).val(),a))})})},SIN:function(){return $(this).each(function(){$(this).val($.app.formatSIN($(this).val())),$(this).blur(function(){this.value=$.app.formatSIN($(this).val())})})},datepickerInput:function(a){return $(this).each(function(){var b=$(this),c=b.next(".btn.calendar");if(0===b.next(".btn.calendar").length&&(c=$('<a href="javascript:void(0);" class="btn calendar" tabindex=-1><span class="icon"></span></a>')),b.after(c),$.browser.msie&&b.before($('<div class="clear"></div>')),b.width()&&b.css("width","-="+c.outerWidth(!0)).attr("autocomplete","off"),"undefined"!=typeof a){var d=$.extend({dateFormat:"yy-mm-dd",onClose:function(a){try{var b=$.datepicker.parseDate("yymmdd",a);$(this).val($.datepicker.formatDate("yy-mm-dd",b))}catch(c){$(this).val(a)}}},a);b.datepicker(d)}else b.datepicker({dateFormat:"yy-mm-dd",onClose:function(a){try{var b=$.datepicker.parseDate("yymmdd",a);$(this).val($.datepicker.formatDate("yy-mm-dd",b))}catch(c){$(this).val(a)}}});c.bind("click",function(a){a.preventDefault(),b.datepicker("widget").is(":hidden")&&b.datepicker("show")})})},hint:function(a,b){var c=Math.max(parseInt(b,10),200);return $(this).wrap('<span class="hinted"></span>').after('<span class="hint" style="width: '+c+"px; right: -"+(c+50)+'px;">'+a+'<span class="hint-pointer sprite">&nbsp;</span></span>').focus(function(){var a=this;a._focus_timeout=setTimeout(function(){$(a).next(".hint").fadeIn()},1e3)}).blur(function(){this._focus_timeout&&clearTimeout(this._focus_timeout),$(this).next(".hint").fadeOut()}).keypress(function(){this._focus_timeout&&clearTimeout(this._focus_timeout),$(this).next(".hint").fadeOut()})},unhint:function(){return $(this).parent().hasClass("hinted")?($(this).next(".hint").remove(),$(this).unwrap()):$(this).parent().find(".hinted")&&$(this).next(".hint").remove(),this},hintError:function(a,b,c){var d,e=$(this),f=this;d=e.data("blur-field")?$("#"+e.data("blur-field")):e;var g=new Array("hinted");return $(this).data("is-textbox")&&(e=$(this).next().is(".hinted")?$(this).next().find(".textboxlist"):$(this).next(".textboxlist"),e.find(".textboxlist-bit-box-deletable").blur(function(){e.next(".hint").fadeOut()}).focus(function(){e.next(".hint").fadeIn()}).change(function(){console.log($(e)),f.handleHintErrorChange.apply(e)})),($(this).data("is-textbox")||e.hasClass("textboxlist"))&&(g.push("contain-textbox"),d=e.find(".textboxlist-bit-editable-input")),e.unhint(),e.addClass("save_warning"),e.data("no-hinted-span")||e.wrap('<span class="'+g.join(" ")+'"></span>'),e.after('<span class="hint">'+a+'<span class="hint-pointer sprite">&nbsp;</span></span>'),d.blur(function(){e.next(".hint").fadeOut()}).focus(function(){e.next(".hint").fadeIn()}).change(function(){console.log($(e)),f.handleHintErrorChange.apply(e)}),e.data("hint",e.next(".hint")),e.setHintErrorWidth(b),e.setHintErrorPosition(),e.data("extra-hint-classes")&&e.parents(".hinted").addClass(e.data("extra-hint-classes")),e.data("hint").click(function(a){a.preventDefault(),a.stopPropagation(),$(this).fadeOut()}),c||e.data("hint").fadeIn(),e},handleHintErrorChange:function(){$(this).unhint().removeClass("save_warning")},setHintErrorWidth:function(a){var b=Math.max(parseInt(a,10),200);return $(this).next(".hint").css({width:b}),$(this)},setHintErrorPosition:function(){var a=-(parseInt($(this).data("hint").css("width"))+50);return $(this).data("hint").css({right:a}),$(this)},tooltip:function(a,b){var c=Math.max(parseInt(b,10),200);return $(this).wrap('<span class="hinted"></span>').after('<span class="hint" style="width: '+c+"px; right: -"+(c+50)+'px;">'+a+'<span class="hint-pointer sprite">&nbsp;</span></span>').mouseenter(function(){$(this).next(".hint").fadeIn()}).mouseleave(function(){$(this).next(".hint").fadeOut()})},signal:function(a){return a=parseInt(a),0>=a&&(a=500),$(this).each(function(){$(this).addClass("signal");var b=this;setTimeout(function(){$(b).removeClass("signal")},a)})},checkVal:function(){if(arguments.length>0){var a=!1;return("YES"==arguments[0]||arguments[0]===!0)&&(a=!0),this.prop("checked",a),this}return this.val()},getClasses:function(){var a=[];return $(this).each(function(){var b=$(this).attr("class").split(" ");for(var c in b){var d=!1;for(var e in a)a[e]==b[c]&&(d=!0);d||a.push(b[c])}}),a}}),$.extend({geocoding:function(a,b){if($.app.geolocation){var c=new google.maps.Geocoder;c.geocode({address:a,language:$.app.lang},function(a,c){if("OK"==c)if(a.length>1){for(var d=0,e=0;e<a.length;e++)("APPROXIMATE"==a[e].geometry.location_type||"GEOMETRIC_CENTER"==a[e].geometry.location_type)&&(a[e]=!1,d++);for(e=0;d>e;e++){for(var f=0;f<a.length-1;f++)a[f]===!1&&(a[f]=a[f+1],a[f+1]=!1);a.pop()}a.length>1?b("ERROR","MULTIPLE",0,0,a):0===a.length?b("ERROR","ZERO_RESULTS",0,0,a):b("SUCCESS",c,a[0].geometry.location.lat(),a[0].geometry.location.lng(),a)}else"APPROXIMATE"==a[0].geometry.location_type||"GEOMETRIC_CENTER"==a[0].geometry.location_type?b("ERROR","INACCURATE",0,0,a):b("SUCCESS",c,a[0].geometry.location.lat(),a[0].geometry.location.lng(),a);else"ZERO_RESULTS"==c?b("ERROR",c,0,0,a):b("TOPROCESS",c,0,0,a)})}else b("TOPROCESS","ZERO_RESULTS",0,0,!1)}}),String.prototype.htmlEntity=function(){return $.app.htmlEntity(this.toString())},String.prototype.nl2br=function(){return this.replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g,"$1<br />$2")},$("#hook_confidentiality_policy,#hook_usage_policy").safeClick(function(){$.app.showMessage($(this).text(),$.app._("AVAILABLE_SOON"))}),this._init()},_init:function(){},configure:function(a){if(a.debug&&(this.debug=!0),a.sendError&&(this.sendErrors=!0),a.sendErrorsOnUnload&&(this.sendErrorsOnUnload=!0),a.silent&&(this.silent=!0),a.trace_retirement&&(this.trace_retirement=!0),a.jqueryui&&a.jqueryui.startingday&&(this.startingDay=a.jqueryui.startingday),this.JS_PATH=a.JS_PATH,this.IMG_PATH=a.IMG_PATH,this.VIRTUALPATH=a.VIRTUALPATH,this.SESSION_KEY=a.SESSION_KEY,!a.application_version)throw this._throw("Applicaiton version not defined in configuration",!0);if(this._application_version=a.application_version,"object"!=typeof a.user)throw"No user info in application configuration";this._configure(a),this.setUserConfig(a.user),a.geolocation?(this.geolocation={},this.geolocation.url="http://maps.google.com/maps/api/geocode/json?"):this.geolocation=!1;for(var b in this.views){var c=this.views[b];"1"==c["default"]&&(this.default_view=b)}},_configure:function(){},getApplicationVersion:function(){return this._application_version},setUserConfig:function(a){var b=this;b.userVersion=a.version,b.userName=a.name,b.userEmail=a.email,b.userType=a.type,b.menus=a.menus,b.views=a.views,b.userIsAssumed=a.assumed,b.userIsCpanelAssumed=a.cpanel_assumed,b.cpanelUserName=a.cpanel_user_name,b.setLocale(a.locale),b._setUserConfig(a),this._buildHeader()},_setUserConfig:function(){},setLocale:function(a){if(this.locale!=a){this.locale=a,this.lang=-1!=a.indexOf("fr")?"fr":"en",this._messages[this.lang]||$.ajax({url:this.JS_PATH+this.lang+".js",data:!1,dataType:"script",async:!1,cache:!0});var b=$.extend($.datepicker.regional[this.lang],{dateFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0,gotoCurrent:!0,yearRange:"-90:+10"});this.startingDay&&(b.firstDay=this.startingDay),$.datepicker.setDefaults(b),$(".localeBound").trigger("setLocaleEvent"),this._setLocale(a)}},_:function(a){if(!this._messages[this.lang])return a;var b=this._messages[this.lang][a];return b?b:a},start:function(){this.hook(),this._observe(),this._checkGears()&&this._initGears()},hook:function(){var a=this;"function"==typeof this._hook&&this._hook(),$(".hook_question_comments").click(function(){a.showQuestionCommentDialog()})},loadMessages:function(a,b){this._messages[a]=b},_beforeUnload:function(){(this.sendErrors||this.sendErrorsOnUnload)&&this._sendErrors()},_throw:function(a,b){return $.toJSON({message:a,type:b?"fatal":"error"})},_onError:function(a,b,c){this.debug&&console.debug(a+" ("+b+":"+c+")");try{var d=$.secureEvalJSON(a.replace("uncaught exception: ",""));"fatal"==d.type&&this._showFatalError(d.message),a=d.message,d=null}catch(e){}return this.sendErrors&&(this._errors.push({description:a,page:b,line:c}),this._errors.length>10&&this._sendErrors()),this.silent},_sendErrors:function(){var a=this;if(this._errors.length>0){for(var b=[],c=0;c<this._errors.length;c++)for(var d in this._errors[c])b.push("error["+c+"]["+d+"]="+encodeURIComponent(this._errors[c][d]));$.ajax({async:!1,url:"index.php?k="+a.SESSION_KEY+"&action=error&"+b.join("&")}),delete this._errors,this._errors=[]}},_showFatalError:function(a){var b=this;this.showModalDialog("<h2>"+$.app._("ERROR")+"</h2>						<p>							<strong>"+$.app._("FATAL_ERROR_OCCURED")+"</strong>							<br />							"+$.app._("CONTACT_SUPPORT_PERSIST")+'						</p>						<p class="submit">							'+$.app._("FATAL_ERROR__YOU_CAN")+" <a href=\"javascript:$.app._hideFatalError('reload');\">"+$.app._("FATAL_ERROR__RELOAD_PAGE")+"</a> "+$.app._("OR")+" <a href=\"javascript:$.app._hideFatalError('stepback');\">"+$.app._("FATAL_ERROR__GO_BACK")+"</a>						</p>","fast",function(){b._errors.push({description:a,page:"$.app.js",line:0})})},_hideFatalError:function(a){this.hideModalDialog("fast",function(){$.app.hideOverlay(),$("#fatal_error").remove(),"reload"==a?location.reload():"stepback"==a&&$.app.forceStepBack()})},_observe:function(){this.debug&&console.debug("Observing hash from now on");var a=this;this._observerInterval=setInterval(function(){a._checkHash()},250),this._checkHash()},_stopObservation:function(){this._observerInterval&&(this.debug&&console.debug("Stopped hash observation"),clearInterval(this._observerInterval),this._observerInterval=0)},_checkHash:function(){var a,b;if(!this.view_fetching&&this.hash!==location.hash){if(this.debug&&console.debug("Hash changed"),this.hash=location.hash,this.hash&&"#"!=this.hash){var c=this.hash.substring(1).split("&");a=c.shift();var d=a.indexOf("/");if(d>0){var e=a.indexOf("/",d+1);e>0&&(d=e,a=a.substring(0,d))}c=null,(""===a||null===a)&&(a=this.default_view)}else a=this.default_view;var f=!0;if(this.currentView&&a==this.currentView&&(b=this._getViewObject(this.currentView),b&&b.onHashChange(this.hash)&&(f=!1)),f&&this.currentView&&!this._resume_hash&&(b=this._getViewObject(this.currentView))){if(!b.close(this.hash))return this.debug&&console.debug("View coulnd't close"),this._stopObservation(),this._resume_hash=this.hash,this.hash=this.stepBack(),void this._observe();this._onViewClose(b),this.debug&&console.debug("Closed view")}this._resume_hash=!1,this._force_clear?(this.addHistory(this.hash),this._force_clear=!1):this._detectStepBack(this.hash)||this.addHistory(this.hash),f&&(this.debug&&console.debug("View : "+a),this.hideModalDialogNow(),this._selectViewMenu(a),this._fetchView(a))}},_onViewClose:function(){},goTo:function(a,b){this.debug&&console.debug('Go To "'+a+'"'),b&&(this._force_clear=!0),location.hash=a},navigateBackTo:function(a){this._history.pop(),this.replace(a)},replace:function(a){return a||(a=""),this.isOpera()?void location.replace(location.protocol+"//"+location.hostname+location.pathname+a):void location.replace(a)},forceGoTo:function(a,b){this._stopObservation(),this.debug&&console.debug('Force Go To "'+a+'"'),b&&(this._force_clear=!0),location.hash=a,location.reload()},resume:function(a){if(this._resume_hash)if(a||"undefined"==typeof a)this._resume_hash=!1,this.addHistory(location.hash),this.debug&&console.debug("View cancelled closing");else{this._onViewClose(this._getViewObject(this.currentView)),this.currentView=!1;var b=this._resume_hash;this._resume_hash=!1,location.hash=b,this.debug&&console.debug("View closed, resuming")}},getResumeHash:function(){return this._resume_hash},parseHash:function(a){var b={view:"",params:{}},c=a.split("&");b.view=c.shift().substr(1);for(var d=0;d<c.length;d++){var e=c[d].split("="),f=e.shift();b.params[f]=e.join("=")}return b},reload:function(a){this._fetchView(this.currentView,a)},_onFetchView:function(){},_onLoadView:function(){},_fetchView:function(a,b){this.currentView=a;var c=this,d=this._isViewCached(a);d&&this.debug&&console.debug('View "'+a+'" is in cache ('+this.lang+")");var e=this._getViewParameters(location.hash);for(var f in e.params)e[f]=e.params[f];if(delete e.params,b&&$.isPlainObject(b))for(f in b)e[f]=b[f];e.k=c.SESSION_KEY,e.view=a,e.cmd="view",e.cached=d,e.version=this.getApplicationVersion(),e.uv=c.userVersion;var g=$.param(e);this.view_fetching=!0,c._onFetchView(this._getViewObject(c.currentView)),$.ajax({url:"index.php?"+g,type:"POST",data:{context:$.app.getContext()},dataType:"json",success:function(d){if(c.view_fetching=!1,c._hideLoading(),"error"==d.status){var e=d.data;return 600==e.code?c._showFatalError('An error occured server side while fetching view data "'+a+'" (600)'):601==e.code||602==e.code?$.app.showModalDialog("<h2>"+$.app._("NAVIGATION_ERROR")+"</h2>										<p>											<strong>"+$.app._("INVALID_PAGE_REQUEST")+'</strong>											<br />										</p>										<p class="submit">											<input type="submit" id="hook_create_error_close" value="'+$.app._("OK")+'" />										</p>',"fast",function(){$("#hook_create_error_close").safeClick(function(){$.app.hideModalDialog("fast"),$.app._stopObservation(),$.app.hash=$.app.stepBack(),$.app._history.push($.app.hash),$.app._observe()})}):c._showFatalError('An unknwon error was sent from server while fetching view data "'+a+'" ('+e.error+")"),!1}c._onLoadView(c._getViewObject(c.currentView)),c._loadView(d.data,b)},error:function(b,d,e){return c.view_fetching=!1,c._hideLoading(),$.app.validateXHR(b)?(this.debug&&(console.debug("AJAX query error"),console.debug(d),console.debug(e)),void c._showFatalError('An error occured while fetching view data "'+a+'" ('+d+")")):!1}}),this._loadingTimeout=setTimeout(function(){c._showLoading()},this._loadingDelay)},_loadView:function(a,b){var c,d=this;if(this.getApplicationVersion()!=a.version&&location.reload(),a.data&&(a=a.data),a.user&&d.userVersion!=a.user.version&&(d.clearViewCache(),d.setUserConfig(a.user)),this._initView(),this._getViewObject(this.currentView)._validateable=a.validateable,a.html)this.debug&&console.debug("Using recieved html"),this._loadContent(a.html),c=$.extend({},a.params,b),this._loadParams(c),this._setViewCache(this.currentView,a.html,a.params);else{if(!this._isViewCached(this.currentView))throw this._throw("View not cached and not recieved from html...",!0);this.debug&&console.debug("Using cached html"),c=$.extend({},this._getViewCachedParams(this.currentView),b),this._loadContent(this._getViewCachedHTML(this.currentView)),this._loadParams(c)}this._hookView(),this._loadModel(a.model),this._checkAnchor(),$("input").each(function(a,b){$(b).attr("maxlength")||$(b).attr("maxlength",255)})},_checkAnchor:function(){var a=this._getViewParameters(this.hash);if(a.params.anchor){var b=a.params.anchor,c=this._getViewObject(this.currentView),d=$("[anchor="+b+"]");if(0===d.length)return this.debug&&console.warn('GET parameter "anchor" found but there is no element associated with it!'),!1;$.isFunction(c.onScrollToAnchor)?c.onScrollToAnchor(d,b):this.debug&&console.warn('GET parameter "anchor" found but there is no `onScrollToAnchor` function on your view!')}},_initView:function(){if(!this.currentView)throw this._throw("No view to initialize",!0);var a=this._getViewObject(this.currentView);a&&a.init(location.hash)},_loadContent:function(a){var b=this._getViewObject(this.currentView);b&&"function"==typeof b.draw?b.draw(a):$("#content").html(a),scrollTo(0,0)},_loadParams:function(a){if(!this.currentView)throw this._throw("No view to load parameters from.",!0);var b=this._getViewObject(this.currentView);b&&b.load(a)},_hookView:function(){if(!this.currentView)throw this._throw("No view to hook",!0);var a=this._getViewObject(this.currentView);a&&("function"==typeof a._preHook&&a._preHook(),a.hook(),this._onViewHook(a))},_onViewHook:function(){},recursiveCleanFloats:function(a){if($.isArray(a))for(var b=0;b<a.length;b++)a[b]=$.app.recursiveCleanFloats(a[b]);else if("object"==typeof a)for(var c in a)a[c]=$.app.recursiveCleanFloats(a[c]);else if("string"==typeof a&&a.match(/^\d+\.\d+$/i)){var d=parseFloat(a);isNaN(d)||(a=d)}return a},_loadModel:function(a){var b=this._getViewObject(this.currentView);b?(a=$.app.recursiveCleanFloats(a),this.debug&&console.debug(a),b.inject(a),"function"==typeof b._postInject&&b._postInject(),this._onViewInject(b,a)):this.debug&&console.debug("No view object, cannot inject model"),$(".page-title").length&&(window.document.title=$(".page-title").text())},_onViewInject:function(){},clearViewCache:function(){this.debug&&console.log("Clearing view cache"),delete this._view_cache,this._view_cache=[]},_isViewCached:function(a){return this._view_cache[a]&&this._view_cache[a].html?!0:!1},_getViewCachedHTML:function(a){if(this._view_cache[a]&&this._view_cache[a].html)return this._view_cache[a].html;throw this._throw("View was supposed to be cached...",!0)},_getViewCachedParams:function(a){return this._view_cache[a].params},_setViewCache:function(a,b,c){delete this._view_cache[a],this._view_cache[a]={html:b,params:c?c:null},this.debug&&console.debug('Cached version of view "'+a+'"')},_getViewParameters:function(a){var b=this._getViewObject(this.currentView);return b?b.parseHash(a):{}},_showLoading:function(){if(this._loadingTimeout){if(clearTimeout(this._loadingTimeout),this._loadingTimeout=0,this.debug&&console.debug("Show loading overlay"),$("#loading-overlay").length>0)return;this.showOverlay(),$("body").append('<img id="loading-overlay-image" src="'+this.IMG_PATH+'ajax-loader-big.gif" /><div id="loading-overlay"></div>');var a=$("#main").height()+parseInt($("#main").css("padding-top"),10)+parseInt($("#main").css("padding-bottom"),10);$("#loading-overlay-image").css({top:$("#main").offset().top,paddingTop:parseInt(a/2,10)+"px",position:"absolute",left:Math.floor($("#main").width()/2),zIndex:89}),$("#loading-overlay").css({height:a,left:0,position:"absolute",top:$("#main").offset().top,width:"100%",zIndex:90,backgroundColor:"#000",opacity:.4}).fadeIn()}},beforeHideLoading:function(){},_hideLoading:function(){this.beforeHideLoading(),clearTimeout(this._loadingTimeout),this._loadingTimeout=0,this.debug&&console.debug("Hide loading overlay"),$("#loading-overlay").remove(),$("#loading-overlay-image").remove(),this.hideOverlay(),this.afterHideLoading()},afterHideLoading:function(){},showOverlay:function(a,b,c,d){d||(d=500),c||(c="overlay"),this.debug&&console.debug("Show overlay"),$("#"+c).length>0||($("body").append('<div id="'+c+'"></div>'),a||(a="transparent"),b||(b="0"),$("#"+c).css({height:$(document).height(),left:0,position:"absolute",top:0,width:this._iPad?$("body").width():"100%",zIndex:d,backgroundColor:a,opacity:b}).fadeIn())},hideOverlay:function(a){this.debug&&console.debug("Hide overlay"),a||(a="overlay"),$("#"+a).remove()},addHistory:function(a){this._history[this._history.length-1]&&this._history[this._history.length-1].hash==a||this._history.push({hash:a,context:{}})},_detectStepBack:function(a){return this._history[this._history.length-2]&&this._history[this._history.length-2].hash==a?(this._history.pop(),!0):!1},stepBack:function(a){var b;do{if(0===this._history.length){b="";break}if(b=this._history.pop().hash,"undefined"==typeof b){b="";break}}while(b==location.hash);return this.debug&&console.debug("Step back to : "+b),(a||"undefined"==typeof a)&&(location.hash=b),b},forceReload:function(){location.reload()},forceStepBack:function(){this._stopObservation(),this.debug&&this._debugHistory();var a=this.stepBack(!1);""!==a?(location.hash=a,location.reload()):(history.back(),location.reload())},goBack:function(a){void 0===typeof a&&(a=""),this._history.length>=2&&(this._history.pop(),a=this._history.pop().hash),this.debug&&console.debug('Go back to "'+a+'"'),location.hash=a},forceGoBack:function(){var a;this._stopObservation(),this._history.length<2?a="":(this._history.pop(),a=this._history.pop().hash),this.debug&&console.debug('Force go back to "'+a+'"'),location.hash=a,location.reload()},setContextValue:function(a,b){this._history.length>0&&($.isPlainObject(this._history[this._history.length-1].context)||(this._history[this._history.length-1].context={}),this._history[this._history.length-1].context[a]=b)},getContextValue:function(a){return this._history.length>0&&$.isPlainObject(this._history[this._history.length-1].context)?this._history[this._history.length-1].context[a]:!1},getContext:function(){return this._history&&this._history.length>0&&$.isPlainObject(this._history[this._history.length-1].context)?this._history[this._history.length-1].context:{}},_debugHistory:function(){for(var a=0;a<this._history.length;a++)console.debug(a+" : "+this._history[a].hash),console.debug(this._history[a].state)},_arrayPop:function(a,b){if(a.length&&b>0&&b<a.length){for(var c=b;c<a.length-1;c++)a[c]=a[c+1];a.pop()}return a},_checkGears:function(){return window.google&&google.gears?(this.debug&&console.debug("Google Gears is installed"),!0):(this.debug&&console.debug("Google Gears is not installed"),!1)},_initGears:function(){return this._checkGears()?!0:!1},registerView:function(a,b){this.debug&&this._view_objects[a]&&console.debug("View "+a+" is already registered"),this.debug&&console.debug('Registered view "'+a+'"'),this._view_objects[a]=b},_getViewObject:function(a){return this._view_objects[a]},_scrollTop:function(){var a=window.pageYOffset?window.pageYOffset:0,b=document.documentElement?document.documentElement.scrollTop:0,c=document.body?document.body.scrollTop:0,d=a?a:0;return d=b&&(!d||d>b)?b:d,d=c&&(!d||d>c)?c:d},showModalDialog:function(a,b,c,d){$.app.debug&&console.debug("Show modal dialog"),this.showOverlay("#000",.4),$("body").append('			<div id="modal_dialog" class="modal" style="display: none; top : '+$.app._scrollTop()+'px">				<div class="modal-2" '+(d?'style="width: '+d+'px;"':"")+'>					<div class="sprite modal-3">						'+a+"					</div>				</div>			</div>"),$.app.isIE7()&&$("div.modal p.submit").prepend('<span style="width: 1px; display: inline-block;">&nbsp;</span>'),$("#modal_dialog").slideDown(b,c)},hideModalDialog:function(a,b,c){$.app.debug&&console.debug("Hide modal dialog"),$("#modal_dialog").fadeOut(a,function(){$.app.hideOverlay(),c?$("#modal_dialog").detach():$("#modal_dialog").remove(),"function"==typeof b&&b()})},hideModalDialogNow:function(){$.app.debug&&console.debug("Hide modal dialog now!"),$("#modal_dialog").remove()},showError:function(a){$.app.showModalDialog("<h2>"+$.app._("ERROR")+"</h2>						<p>							<strong>"+$.app._(a?a:"FATAL_ERROR_OCCURED")+"</strong>							<br />							"+$.app._("ERROR_TRY_AGAIN")+"							<br />							<br />							"+$.app._("CONTACT_SUPPORT_PERSIST")+'						</p>						<p class="submit">							<input type="submit" id="hook_create_error_close" value="'+$.app._("OK")+'" />						</p>',"fast",function(){$("#hook_create_error_close").safeClick(function(){$.app.hideModalDialog("fast")})})},showMessage:function(a,b,c){""===a&&this._throw("Missing title",!0),""===b&&this._throw("Missing message",!0),$.app.showModalDialog("<h2>"+a+"</h2>						<p>							<strong>"+b+"</strong>						</p>						"+(c?"<p>"+c+"</p>":"")+'						<p class="submit">							<input type="submit" id="hook_show_message_close" value="'+$.app._("OK")+'" />						</p>',"fast",function(){$("#hook_show_message_close").safeClick(function(){$.app.hideModalDialog("fast")})})},showQuestionCommentDialog:function(a){var b=this,c="<h2>"+$.app._("QUESTION_COMMENT_SUGGESTION")+'</h2>		<div class="header_line"></div>		<div id="hook_question_comment_form">		<dl class="form left_form">		<dt><label style="width:100px">'+$.app._("COMMENT_TYPE")+'</label></dt>		<dd><select id="hook_question_comment_type">		<option value="QUESTION">'+$.app._("QUESTION")+'</option>		<option value="COMMENT">'+$.app._("COMMENT")+'</option>		<option value="SUGGESTION">'+$.app._("SUGGESTION")+'</option>		</select></dd>		<dt><label style="width:100px">'+$.app._("COMMENT_FROM")+'</label></dt>		<dd><input type="text" id="hook_question_comment_from" style="width:350px" disabled="disabled" /></dd>		<dt><label style="width:100px">'+$.app._("COMMENT_SUBJECT")+'</label></dt>		<dd><input type="text" id="hook_question_comment_subject" style="width:350px" /></dd>		<br />		<dd><textarea id="hook_question_comment_textarea" style="width:500px;height:150px"></textarea></dd>		</dl>		<p class="submit">		<input type="submit" id="hook_send_question_comment" value="'+$.app._("OK")+'" /> <a href="javascript:void(0);" id="hook_cancel_question_comment">'+$.app._("CANCEL")+'</a>		</p>		</div>		<div id="hook_question_comment_sent" style="display:none"><p>'+$.app._("THANK_YOU_FOR_YOUR_COMMENTS")+"</p></div>";$.app.showModalDialog(c,"normal",function(){a&&$("#hook_question_comment_type").val(a),$("#hook_question_comment_from").val($.app.userEmail),$("#hook_send_question_comment").safeClick(function(){var a=$("#hook_question_comment_type").val(),c=$("#hook_question_comment_subject").val(),d=$("#hook_question_comment_from").val(),e=$("#hook_question_comment_textarea").val();if(!c)return $("#hook_question_comment_subject").hintError($.app._("FIELD_REQUIRED")).focus(),!1;if(!e)return $("#hook_question_comment_textarea").hintError($.app._("FIELD_REQUIRED")).focus(),!1;var f="&type="+encodeURIComponent(a)+"&subject="+encodeURIComponent(c)+"&from="+encodeURIComponent(d)+"&message="+encodeURIComponent(e);$.ajax({url:"index.php?k="+b.SESSION_KEY+"&sendComment",type:"POST",data:f,dataType:"json",success:function(a){return a.status&&"error"==a.status?($.app.showError(),$.app.hideModalDialog("fast"),!1):(setTimeout(function(){$.app.hideModalDialog("fast")},2e3),!0)},error:function(a){return $.app.validateXHR(a)?($.app.showError(),$.app.hideModalDialog("fast"),!1):($.app.hideModalDialog("fast"),!1)}}),$("#hook_question_comment_form").fadeOut(function(){$("#hook_question_comment_sent").show()})}),$("#hook_cancel_question_comment").safeClick(function(){$.app.hideModalDialog("fast")}),$("#hook_question_comment_subject").focus()},550)},htmlEntity:function(a){return a?$("<div></div>").text(a).html():""},sleep:function(a){var b,c=new Date;do b=new Date;while(a>b-c)},isNumber:function(a){return"number"==typeof a&&isFinite(a)},parseFloat:function(a){if("number"==typeof a)return a;a+=";",a=a.replace(/[^\d\-.,]/g,""),"fr"==this.lang&&-1!=a.indexOf(",")&&(a=a.replace(/\./g,""),a=a.replace(/\,/g,".")),a=a.replace(/\,/g,"");var b=parseFloat(a);return isNaN(b)&&(b=0),b},parseInt:function(a){return a=parseInt(a,10),isNaN(a)&&(a=0),a},formatMoney:function(a,b){if(b&&b.canBeNull&&(""===a||null===a))return"";
var c;c="fr"==this.lang?"right":"left";var d=this.formatNumber(a,b);return d||(d="0"),"left"==c?b&&b.nbsp?"$"+d:"$"+d:b&&b.nbsp?d+"&nbsp;$":d+" $"},formatPercent:function(a,b){var c;if(b&&b.canBeNull&&!a)return"";c="fr"==this.lang?b&&b.nbsp?"&nbsp":" ":"";var d=this.formatNumber(a,b);return d||(d="0"),d+c+"%"},formatNumber:function(a,b){if(0===arguments.length)return"";if(!a&&0!==a)return"";var c={precision:2,facultative_decimals:!0,positive:!1,nbsp:!1,rounded:!0};c="fr"==this.lang?$.extend({decimal_separator:",",thousand_separator:" "},c):$.extend({decimal_separator:".",thousand_separator:","},c);var d=$.extend(c,b);a+="";var e=!1;"-"==a.charAt(0)&&(d.positive?a="0":(e=!0,a=a.substr(1))),a=a.replace(/[^\d\-.,]/g,""),","==d.decimal_separator&&-1!=a.indexOf(d.decimal_separator)&&(a=a.replace(/\./g,""),a=a.replace(/,/g,".")),""===a&&(a="0"),a=a.replace(/,/g,""),a=parseFloat(a)+"",a==Number.NaN&&(a="");var f,g;0===d.precision?(f=$.app.parseFloat(a).toFixed(0),g=f):(f=d.rounded?(Math.round(a*Math.pow(10,d.precision))/Math.pow(10,d.precision)).toFixed(d.precision):(Math.floor(a*Math.pow(10,d.precision))/Math.pow(10,d.precision)).toFixed(d.precision),g=f.substr(0,f.indexOf(".")));var h="",i=g.length;if(i>3){do{i-=3;var j=3;0>i&&(j=3+i,i=0),h=""!==h?g.substr(i,j)+d.thousand_separator+h:g.substr(i,j)}while(i>0)}else h=g;var k;return 0===d.precision||d.facultative_decimals&&0===parseInt(f.substr(f.indexOf(".")+1))?k=h:(h+=d.decimal_separator,k=h+f.substr(f.indexOf(".")+1)),d.end_space&&(k+=" "),d.nbsp&&(k=k.replace(/ /g,"&nbsp;")),e?"-"+k:k},formatSIN:function(a){var b=a;b=b.replace(new RegExp("[^\\d]","g"),"");var c=b.substr(0,3)+" "+b.substr(3,3)+" "+b.substr(6,3);return $.trim(c)},isSINValid:function(a){if(""===a)return!0;if("*** *** ***"==a)return!0;if(a=a.replace(new RegExp("[^\\d]","g"),""),9!=a.length)return!1;for(var b=parseInt(a.charAt(0))+parseInt(a.charAt(2))+parseInt(a.charAt(4))+parseInt(a.charAt(6)),c=1;7>=c;c+=2){var d=2*parseInt(a.charAt(c));d>=10&&(d-=9),b+=d}return b+=parseInt(a.charAt(8)),b%10!==0?!1:!0},formatFieldValue:function(a){var b=this;if(!a)return"";if("object"==typeof a){var c=a["value_"+b.lang];return"undefined"==typeof c?"":c}return a},parsePhone:function(a){var b;if(/(,|ext|poste|#)/.test(a)){var c=a.indexOf(","),d=a.indexOf("ext"),e=a.indexOf("poste"),f=a.indexOf("#"),g=Math.max(c,d,e,f);-1!=g&&(b=a.substr(g).replace(/[^\d]/g,""),a=a.substr(0,g))}else b="";a=a.replace(/[^\d]/g,"");var h;return"1"==a[0]&&a.length>=11?(h="1 "+a.substr(1,3)+" "+a.substr(4,3)+"-"+a.substr(7,4),a.length>11&&(b=a.substr(11))):a.length>=10?(h=a.substr(0,3)+" "+a.substr(3,3)+"-"+a.substr(6,4),a.length>10&&(b=a.substr(10))):h=7==a.length?a.substr(0,3)+"-"+a.substr(3):a,b&&(h+=$.app._("PHONE_EXTENSION")+b),h},formatPostalCode:function(a){return/^[a-zA-Z]\d[a-zA-Z]\d[a-zA-Z]\d$/.test(a)?(a.substr(0,3)+" "+a.substr(3)).toUpperCase():a},pad:function(a,b){for(var c=""+a;c.length<b;)c="0"+c;return c},validateXHR:function(a){if(!a||"undefined"==typeof a||"function"!=typeof a.getResponseHeader||"function"!=typeof a.getAllResponseHeaders)return!0;var b=a.getResponseHeader("X-Kronos-Ajax-Goto");return b?(document.location=b,!1):a.getAllResponseHeaders()?!0:!1},getXHRRequest:function(a,b,c,d,e,f){var g=this,h=$.ajax({url:a,type:"GET",dataType:"json",success:function(a){f||(g.hideOverlay(),g._hideLoading()),e&&$(e).prop("disabled",!1);var c;c="undefined"!=typeof a.data?a.data:a,a.status&&"error"==a.status?"function"==typeof d?d(c):"undefined"!=typeof c.message?$.app.showError(c.message):$.app.showError():"function"==typeof b&&b(c)},error:function(a,b,c){return f||(g.hideOverlay(),g._hideLoading()),console.debug(a),"abort"!=b&&$.app.validateXHR(a)?(e&&$(e).prop("disabled",!1),this.debug&&(console.debug("AJAX query error"),console.debug(b),console.debug(c)),void("function"==typeof d?d():$.app.showError())):!1}});return h},get:function(a,b,c,d,e,f,g,h){e||h||this.showOverlay(),g&&$(g).prop("disabled",!0);var i=this;c.length>0&&"&"!=c[0]&&(c="&"+c);var j=$.ajax({url:"index.php?k="+i.SESSION_KEY+"&view="+a+"&cmd="+b+c,type:"GET",dataType:"json",success:function(a){h||(i.hideOverlay(),i._hideLoading()),g&&$(g).prop("disabled",!1);var b;b="undefined"!=typeof a.data?a.data:a,a.status&&"error"==a.status?"function"==typeof f?f(b):"undefined"!=typeof b.message?$.app.showError(b.message):$.app.showError():"function"==typeof d&&d(b)},error:function(a,b,c){return h||(i.hideOverlay(),i._hideLoading()),console.debug(a),"abort"!=b&&$.app.validateXHR(a)?(g&&$(g).prop("disabled",!1),this.debug&&(console.debug("AJAX query error"),console.debug(b),console.debug(c)),void("function"==typeof f?f():$.app.showError())):!1}});return e&&(this._loadingTimeout=setTimeout(function(){i._showLoading()},this._loadingDelay)),j},post:function(a,b,c,d,e,f,g,h){var i=this;h&&$(h).prop("disabled",!0),c.length>0&&"&"!=c[0]&&(c="&"+c);var j=$.ajax({url:"index.php?k="+i.SESSION_KEY+"&view="+a+"&cmd="+b+c,type:"POST",data:d,dataType:"json",success:function(a){f&&(i.hideOverlay(),i._hideLoading()),h&&$(h).prop("disabled",!1);var b;b="undefined"!=typeof a.data?a.data:a,a.status&&"error"==a.status?"function"==typeof g?g(b):"undefined"!=typeof b.message?$.app.showError(b.message):$.app.showError():"function"==typeof e&&e(b)},error:function(a,b,c){return i.hideOverlay(),i._hideLoading(),"abort"!=b&&$.app.validateXHR(a)?(h&&$(h).prop("disabled",!1),this.debug&&(console.debug("AJAX query error"),console.debug(b),console.debug(c)),void("function"==typeof g?g():$.app.showError())):!1},ajaxStop:function(){i.ajaxQueryLoading=!1}});return f&&(this._loadingTimeout=setTimeout(function(){i._showLoading()},this._loadingDelay)),j},date:{_date_regex:new RegExp(/^(\d{4})-{0,1}(\d{2})-{0,1}(\d{2})(| (\d{2}):(\d{2}):(\d{2})(|\.\d+))$/),isDate:function(a){var b=this._date_regex.exec(a);return null!=b},parse:function(a){if(null===a)return!1;if("object"==typeof a){if("undefined"==typeof a.date)return a;a=a.date}var b=this._date_regex.exec(a);if(null==b)return $.app.debug&&console.debug('Could not parse date "'+a+'"'),!1;var c=new Date;return c.setDate(1),c.setYear(b[1]),c.setMonth(parseInt(b[2],10)-1),c.setDate(b[3]),b[4]?(c.setHours(b[5]),c.setMinutes(b[6]),c.setSeconds(b[7])):(c.setHours("0"),c.setMinutes("0"),c.setSeconds("0")),c},format:function(a,b){if("undefined"==typeof b&&(b="long"),a=this.parse(a),!a)return"";if("input"==b)return a.getFullYear()+"-"+$.app.pad(a.getMonth()+1,2)+"-"+$.app.pad(a.getDate(),2);if("long"==b)return("en"===$.app.lang?this.getMonthName(a.getMonth())+" "+a.getDate()+", ":a.getDate()+" "+this.getMonthName(a.getMonth())+" ")+a.getFullYear();if("longtime"==b)return("en"===$.app.lang?this.getMonthName(a.getMonth())+" "+a.getDate()+", ":a.getDate()+" "+this.getMonthName(a.getMonth())+" ")+a.getFullYear()+" "+$.app._("AT")+" "+a.getHours()+":"+$.app.pad(a.getMinutes(),2);if("short"==b)return"en"===$.app.lang?this.getMonthName(a.getMonth())+" "+a.getDate():a.getDate()+" "+this.getMonthName(a.getMonth());if("longabbrmonth"==b){var c,d=a.getMonth(),e=$.datepicker.regional[$.app.lang];return c=e?e.monthNamesShort[d]:this.getMonthName(d).substring(0,3),("en"===$.app.lang?c+". "+a.getDate()+", ":a.getDate()+" "+c+". ")+a.getFullYear()}return $.app.debug&&console.debug('Unknown date format "'+b+'"'),""},getMonthName:function(a){switch("undefined"==typeof a&&0===arguments.length&&(a=(new Date).getMonth()),a){case 0:return $.app._("JANUARY");case 1:return $.app._("FEBRUARY");case 2:return $.app._("MARCH");case 3:return $.app._("APRIL");case 4:return $.app._("MAY");case 5:return $.app._("JUNE");case 6:return $.app._("JULY");case 7:return $.app._("AUGUST");case 8:return $.app._("SEPTEMBER");case 9:return $.app._("OCTOBER");case 10:return $.app._("NOVEMBER");case 11:return $.app._("DECEMBER");default:$.app._throw('Unknown month "'+a+'"')}},getAge:function(a){if(a=this.parse(a)){var b=new Date,c=b.getFullYear()-a.getFullYear();return(b.getMonth()<a.getMonth()||b.getMonth()==a.getMonth()&&b.getDate()<a.getDate())&&c--,a=null,c}return 0},getFakeBirthdate:function(a){if(a=parseInt(a),!a)return"";var b=new Date;return b.getFullYear()-a+"-01-01"},getInsuranceAge:function(a){var b=this.parse(a);if(b){var c=this.getAge(a),d=new Date,e=new Date,f=new Date;return d.setMonth(b.getMonth()),d.setDate(b.getDate()),f.setMonth(b.getMonth()),f.setDate(b.getDate()),d>e&&d.setFullYear(d.getFullYear()-1),f.setFullYear(d.getFullYear()+1),Math.abs(e-f)<Math.abs(e-d)&&c++,b=null,d=null,e=null,f=null,c}return 0},getYear:function(a){return a=this.parse(a),a?a.getFullYear():0}},datepicker:function(a,b){return $(a).bind("change",function(){this.value=$.app.date.format(this.value,"input")}).datepicker(b)},_formatAddress:function(a,b,c,d,e,f){var g="",h=!0;return""!==a&&a!==!1&&(h=!1,g+=this.htmlEntity(a)),""!==b&&b!==!1&&(h||(g+=", "),h=!1,g+=this.htmlEntity(b)),""!==c&&c!==!1&&(h||(g+=", "),h=!1,g+=this.htmlEntity(c)),""!==d&&"QC"!=d&&(h||(g+=", "),h=!1,g+=this.htmlEntity(d)),""!==f&&f!==!1&&(h||(g+=", "),h=!1,g+=this.htmlEntity(f)),""!==e&&e!==!1&&"Canada"!=e&&(h||(g+=", "),h=!1,g+=this.htmlEntity(e)),g},formatAddress:function(a,b,c,d,e,f){return this._formatAddress(a,b,c,d,e,f)},formatGMapAddress:function(a,b,c,d,e,f){return a=$.trim(a),b=$.trim(b),c=$.trim(c),e=$.trim(e),f=$.trim(f),a=a.replace(/\bboul\./i,"Boulevard"),a=a.replace(/,\s?\b(bur|bureau|app|appartement|appartment|local|office|porte|door)\b\.?\s*\d*/i,""),(a?a+", ":"")+(b?b+", ":"")+(c?c+", ":"")+(d?d+", ":"")+(f?f+", ":"")+e},isMobile:function(){return navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/Pre/i)||navigator.userAgent.match(/Android/i)},_sprintfWrapper:{init:function(){if("undefined"==typeof arguments)return null;if(arguments.length<1)return null;if("string"!=typeof arguments[0])return null;if("undefined"==typeof RegExp)return null;for(var a=arguments[0],b=new RegExp(/(%([%]|(\-)?(\+|\x20)?(0)?(\d+)?(\.(\d)?)?([bcdfosxX])))/g),c=[],d=[],e=0,f=0,g=0,h=0,i="",j=null;j=b.exec(a);)j[9]&&(e+=1),f=h,g=b.lastIndex-j[0].length,d[d.length]=a.substring(f,g),h=b.lastIndex,c[c.length]={match:j[0],left:j[3]?!0:!1,sign:j[4]||"",pad:j[5]||" ",min:j[6]||0,precision:j[8],code:j[9]||"%",negative:parseInt(arguments[e])<0?!0:!1,argument:String(arguments[e])};if(d[d.length]=a.substring(h),0===c.length)return a;if(arguments.length-1<e)return null;j=null;var k=null;for(k=0;k<c.length;k++){var l;"%"==c[k].code?l="%":"b"==c[k].code?(c[k].argument=String(Math.abs(parseInt(c[k].argument,10)).toString(2)),l=$.app._sprintfWrapper.convert(c[k],!0)):"c"==c[k].code?(c[k].argument=String(String.fromCharCode(parseInt(Math.abs(parseInt(c[k].argument,10))))),l=$.app._sprintfWrapper.convert(c[k],!0)):"d"==c[k].code?(c[k].argument=String(Math.abs(parseInt(c[k].argument,10))),l=$.app._sprintfWrapper.convert(c[k])):"f"==c[k].code?(c[k].argument=String(Math.abs(parseFloat(c[k].argument,10)).toFixed(c[k].precision?c[k].precision:6)),l=$.app._sprintfWrapper.convert(c[k])):"o"==c[k].code?(c[k].argument=String(Math.abs(parseInt(c[k].argument,10)).toString(8)),l=$.app._sprintfWrapper.convert(c[k])):"s"==c[k].code?(c[k].argument=c[k].argument.substring(0,c[k].precision?c[k].precision:c[k].argument.length),l=$.app._sprintfWrapper.convert(c[k],!0)):"x"==c[k].code?(c[k].argument=String(Math.abs(parseInt(c[k].argument,10)).toString(16)),l=$.app._sprintfWrapper.convert(c[k])):"X"==c[k].code?(c[k].argument=String(Math.abs(parseInt(c[k].argument,10)).toString(16)),l=$.app._sprintfWrapper.convert(c[k]).toUpperCase()):l=c[k].match,i+=d[k],i+=l}return i+=d[k]},convert:function(a,b){a.sign=b?"":a.negative?"-":a.sign;var c=a.min-a.argument.length+1-a.sign.length,d=new Array(0>c?0:c).join(a.pad);return a.left?"0"==a.pad||b?a.sign+a.argument+d.replace(/0/g," "):a.sign+a.argument+d:"0"==a.pad||b?a.sign+d+a.argument:d+a.sign+a.argument}},downloadFile:function(a){var b=this;if(b._iPad){var c="<h2>"+$.app._("DOWNLOAD_FILE_DIALOG_TITLE")+'</h2>			<div class="header_line"></div>			<a id="hook_download_file" href="javascript:void(0);">'+b._("DOWNLOAD_FILE")+"</a>			<br /><br />";$.app.showModalDialog(c,"normal",function(){$("#hook_download_file").click(function(){window.open(a,"_blank"),$.app.hideModalDialog("fast")})})}else{var d="download_iframe",e=document.getElementById(d);e||(e=document.createElement("iframe"),e.id=d,e.name=d,e.style.position="absolute",e.style.top="-1000px",e.style.left="-1000px",document.body.appendChild(e)),e.src=a}},sprintf:function(){},getIEVersion:function(){var a=null;if("Microsoft Internet Explorer"==navigator.appName){var b=navigator.userAgent,c=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})");null!=c.exec(b)&&(a=parseFloat(RegExp.$1))}return a},isIE7:function(){var a=this.getIEVersion();return a=null!==a?a:999,8>a},isIE9:function(){var a=this.getIEVersion();return a>=9&&10>a},isOpera:function(){return"Opera"==navigator.appName},forceElementRedraw:function(a){a.hide().show()},autocompleter:function(a,b,c,d,e){var f={selector:!1,selectorIsDomRef:!1,view:"",command:"",callback:!1,width:300,matchContains:!1,listSize:10,minChars:2,showAll:!1,showDescription:!1,_doHighlight:!1,_customHighlight:!1,_customItemFormat:!1,_customDescriptionFormat:!1,_filters:[],_init:function(a,b,c,d,e){this.selector=a,this.view=b,this.command=c,this.callback=d,e.width&&(this.width=e.width),"boolean"==typeof e.matchContains&&(this.matchContains=e.matchContains),e.listSize&&(this.listSize=parseInt(e.listSize,10)),e.minChars&&(this.minChars=parseInt(e.minChars,10)),"boolean"==typeof e.showAll&&(this.showAll=e.showAll),"boolean"==typeof e.showDescription&&(this.showDescription=e.showDescription),"boolean"==typeof e.highlight&&(this._doHighlight=e.highlight),"function"==typeof e.customHighlight&&(this._customHighlight=e.customHighLight),"function"==typeof e.itemFormat&&(this._customItemFormat=e.itemFormat),"function"==typeof e.descriptionFormat&&(this._customDescriptionFormat=e.descriptionFormat),"function"==typeof e.parse&&(this.parse=e.parse),"boolean"==typeof e.selectorIsDomRef&&(this.selectorIsDomRef=e.selectorIsDomRef),"string"==typeof e.query_string_param_name&&""!==$.trim(e.query_string_param_name)&&(this.queryStringParamName=e.query_string_param_name),e.params&&(this.params=e.params)},_build:function(){var a=this,b={};return b.width=this.width,b.position="fixed",b.max=this.listSize,b.matchContains=this.matchContains,b.minChars=this.minChars,b.selectFirst=!1,b.scrollHeight=450,b.queryStringParamName=this.queryStringParamName,b.formatItem=function(b,c,d,e){return a._formatItem(b,c,d,e)},b.highlight=function(b,c){return a._highlight(b,c)},b.extraParams=a._extraParams(),this.parse&&(b.parse=this.parse),b},_formatItem:function(a,b,c,d){if(this._filtered(a[2]))return!1;var e;return e="function"==typeof this._customItemFormat?this._customItemFormat(a,b,c,d):a[2],this.showDescription&&(e+="function"==typeof this._customDescriptionFormat?this._customDescriptionFormat(a,b,c,d):'<br /><span class="description">'+a[3]+"</span>"),e},_filtered:function(a){for(var b=0;b<this._filters.length;b++)if(this._filters[b]==a)return!0;return!1},_highlight:function(a,b){return this._doHighlight?"function"==typeof this.custom_highlight?this.custom_highlight(a,b):a.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+b.replace(/([\^\$\(\)\[\]\{\}\*\.\+\?\|\\])/gi,"\\$1")+")(?![^<>]*>)(?![^&;]+;)","gi"),'<span class="ac_match">$1</span>'):a},_extraParams:function(){var a={};if(this.matchContains&&(a.contains="true"),this.params)if("function"==typeof this.params){var b=this.params();"object"==typeof b?$.each(b,function(b,c){a[b]=c}):a.param=this.params}else"object"==typeof this.params?$.each(this.params,function(b,c){a[b]=c}):a.param=this.params;return a.view=this.view,a.cmd=this.command,a.k=$.app.SESSION_KEY,a},_result:function(a,b){"function"==typeof this.callback&&this.callback(b)},filterValue:function(a,b){for(var c=!1,d=0;d<this._filters.length;d++)if(a==this._filters[d]){if(!b&&"undefined"!=typeof b){delete this._filters[d];for(var e=d+1;e<this._filters.length;e++)this._filters[e-1]=this._filters[e];return this._filters.pop(),!0}c=!0}return!b&&"undefined"!=typeof b||c?!1:(this._filters.push(a),!0)}};f._init(a,b,c,d,e);var g=f._build(),h=!1;return h=g.selectorIsDomRef?a:$(a),h.autocomplete("index.php",g).bind("result",function(a,b,c){f._result(a,b,c)}),f},visualizationReady:function(){this.debug&&console.debug("Google Visualization API ready"),this._visualization_ready=!0},isVisualizationReady:function(){return this._visualization_ready||google&&google.visualization&&(this._visualization_ready=!0),this._visualization_ready},getByKey:function(a,b){for(var c=a,d=b.split("."),e=0;e<d.length;e++){if("object"!=typeof c)return void 0;c=c[d[e]]}return c}};$.extend({app:app}),Function.prototype.inherits=function(a){return this.prototype&&(this.own_prototype=this.prototype,delete this.prototype),a.constructor==Function?(this.prototype={},this.prototype=new a,this.prototype.constructor=this,this.prototype.parent=a.prototype):(this.prototype=a,this.prototype.constructor=this,this.prototype.parent=a),this.own_prototype&&(this.extend(this.own_prototype),delete this.own_prototype),this},Function.prototype.extend=function(a){for(var b in a)this.prototype[b]=a[b]},Array.prototype.reduce||(Array.prototype.reduce=function(a){var b=this.length;if("function"!=typeof a)throw new TypeError;if(0===b&&1==arguments.length)throw new TypeError;var c,d=0;if(arguments.length>=2)c=arguments[1];else for(;;){if(d in this){c=this[d++];break}if(++d>=b)throw new TypeError}for(;b>d;d++)d in this&&(c=a.call(null,c,this[d],d,this));return c}),Function.prototype.method=function(a,b){return this.prototype[a]?void 0:(this.prototype[a]=b,this)},Array.method("sum",function(){return this.reduce(function(a,b){return a+b},0)}),Array.prototype.extend=function(a){var b=this;return a.map(function(a,c){return b.hasOwnProperty(c)?b[c]:a})},"indexOf"in Array.prototype||(Array.prototype.indexOf=function(a,b){void 0===b&&(b=0),0>b&&(b+=this.length),0>b&&(b=0);for(var c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1}),"lastIndexOf"in Array.prototype||(Array.prototype.lastIndexOf=function(a,b){for(void 0===b&&(b=this.length-1),0>b&&(b+=this.length),b>this.length-1&&(b=this.length-1),b++;b-->0;)if(b in this&&this[b]===a)return b;return-1}),"forEach"in Array.prototype||(Array.prototype.forEach=function(a,b){for(var c=0,d=this.length;d>c;c++)c in this&&a.call(b,this[c],c,this)}),"map"in Array.prototype||(Array.prototype.map=function(a,b){for(var c=new Array(this.length),d=0,e=this.length;e>d;d++)d in this&&(c[d]=a.call(b,this[d],d,this));return c}),"filter"in Array.prototype||(Array.prototype.filter=function(a,b){for(var c,d=[],e=0,f=this.length;f>e;e++)e in this&&a.call(b,c=this[e],e,this)&&d.push(c);return d}),"every"in Array.prototype||(Array.prototype.every=function(a,b){for(var c=0,d=this.length;d>c;c++)if(c in this&&!a.call(b,this[c],c,this))return!1;return!0}),"some"in Array.prototype||(Array.prototype.some=function(a,b){for(var c=0,d=this.length;d>c;c++)if(c in this&&a.call(b,this[c],c,this))return!0;return!1}),$.range=function(a,b){var c=[],d=0;if(b>=a)for(d=a;b>=d;d++)c.push(d);if(a>b)for(d=b;d>a;d--)c.push(d);return c},$.zeros=function(a){return $.range(1,a).map(function(){return 0})},View.prototype={parseHash:function(a){var b=$.app.parseHash(a),c=b.view.indexOf("/");if(c>0){var d=b.view.indexOf("/",c+1);d>0&&(c=d,b.id=b.view.substr(c+1),b.view=b.view.substr(0,c))}else b.id=!1;return b},onHashChange:function(a){var b=this.parseHash(a);return this._onHashChange(a,b)},_onHashChange:function(){return!1},onScrollToAnchor:function(a){a.focus();var b=a.offset();window.scrollTo(b.left,b.top)},init:function(a){var b=this.parseHash(a);this._uri=b,this._view=b.view,this._id=b.id,this._uri_params=b.params,this._controls={},this._init(a)},_init:function(){$.app.debug&&$.app._throw("View does not implement _init function")},load:function(a){this._load(a)},_load:function(a){this.params=a},draw:function(a){if(this._onBeforeDraw(),this._canRedraw()){for(var b=this._getRedrawingSelectors(),c=!0,d=0;c&&d<b.length;d++)$(b[d]).length||(c=!1);if(b=null,c)return this._redrawn=!0,$.app.debug&&console.debug("Redrawing content"),void this._onDraw(!0)}this._redrawn=!1,$.app.debug&&console.debug("Drawing view"),$("#content").html(a),this._onDraw()},_canRedraw:function(){return!1},_getRedrawingSelectors:function(){return[]},_onBeforeDraw:function(){},_onDraw:function(){},hook:function(a){var b=this;b._redrawn||($.app.debug&&console.debug("Hooking view"),this._hook(a),b.updateReturnToParentView())},_hook:function(){$.app.debug&&$.app._throw("View does not implement _hook function")},inject:function(a){$.app.debug&&console.debug("Injecting model"),this._inject(a)},_inject:function(){$.app.debug&&$.app._throw("View does not implement _inject function")},close:function(a){var b=this._canClose(a);return b?this._onClose():this._onCancelClose(),b},_canClose:function(){return!0},_onCancelClose:function(){$.app.debug&&$.app._throw("View does not implement _onCancelClose function")},_onClose:function(){},pushParentView:function(a){var b=this,c="";return b._uri_params.parent_view&&(c+=b._uri_params.parent_view+"|"),c+=encodeURIComponent(a)},popParentView:function(a){if("undefined"==typeof a&&(a=!0),void 0===this._uri_params.parent_view)return!1;var b=this._uri_params.parent_view.split("|"),c=decodeURIComponent(b.pop());this._uri_params.parent_view=0===b.length?void 0:b.join("|");var d="";return d=c?a?"#"+c+"/"+this._id:"#"+c:"#",b.length>0&&(d+="&parent_view="+b.join("|")),d},getParentView:function(){var a=this;if(void 0===a._uri_params.parent_view)return!1;if(""===a._uri_params.parent_view)return a._uri_params.parent_view;var b=a._uri_params.parent_view.split("|");return b.pop()},updateReturnToParentView:function(){var a=this,b=a.getParentView();if(b){var c="BACK_TO_"+b.toUpperCase().split("/").splice(0,2).join("_"),d=$.app._(c);$(".hook_back_to_parent_view").text(d)}}},EditView.prototype={init:function(a){this._wasClosing=!1,View.prototype.init.call(this,a)},changed:function(){$.app.debug&&console.debug("changed"),this._modified||(this._modified=!0)},softModified:function(){$.app.debug&&console.debug("soft modified"),this._soft_modified||(this._soft_modified=!0)},hook:function(a){if(!this._redrawn){$.app.debug&&console.debug("Hooking view");var b=this;$("#content form").delegate(":input[name]:not(.no-form-change)","change",function(){b.changed()}),$("#content form").delegate(":input[type=text]:not(.no-form-change)","keypress",function(){b.changed()}),$(".number:not(.positive)").number(),$(".number.positive").number({positive:!0}),this._hook(a),b.updateReturnToParentView(),"Microsoft Internet Explorer"==navigator.appName&&($(window).data("beforeunload",window.onbeforeunload),$(document).on("mouseenter",'a[href^="javascript:"]',function(){window.onbeforeunload=null}).on("mouseleave",'a[href^="javascript:"]',function(){window.onbeforeunload=$(window).data("beforeunload")})),window.onbeforeunload=function(){return b._modified?$.app._("SAVE_CHANGES_MESSAGE"):void 0}}},inject:function(a){$.app.debug&&console.debug("Injecting model"),this._soft_modified=!1,this._inject(a),this._modified=!1},close:function(a){if($("#edit_form").off("**"),this._modified&&this._can_save)return this._wasClosing=!0,this.showSaveDialog(),!1;var b=this._canClose(a);return b?this._onClose():this._onCancelClose(),b},showSaveDialog:function(){var a=this;$.app.showModalDialog("<h2>"+$.app._("SAVE_CHANGES_TITLE")+"</h2><p>"+$.app._("SAVE_CHANGES_MESSAGE")+'</p><p class="submit"><input type="submit" id="hook_do_save_changes" value="'+$.app._("YES")+'" /> <input type="submit" id="hook_do_not_save_changes" value="'+$.app._("NO")+'" /> <a href="javascript:void(0);" id="hook_cancel_save_changes">'+$.app._("CANCEL")+"</a></p>","normal",function(){$("#hook_do_save_changes").safeClick(function(){a.hideSaveDialog("save")}),$("#hook_do_not_save_changes").safeClick(function(){a.hideSaveDialog("resume")}),$("#hook_cancel_save_changes").safeClick(function(){a.hideSaveDialog()})})},hideSaveDialog:function(a){var b=this;$.app.hideModalDialog("normal",function(){if("save"==a){var c=b.save(function(){b.resume()});c||b.stop()}else"resume"==a?(window.onbeforeunload=function(){},b._canClose()?b.resume():(b._onCancelClose(),b.stop())):b.stop()})},save:function(a,b,c,d){if(!this._can_save)return this._saveRedirect(a,d);if(!this._canSave())return this._onCancelSave(),!1;if(this._wasClosing&&!this._canClose())return this._onCancelClose(),!1;if("function"==typeof a&&("function"==typeof b&&(c=b),b=a,a=!1),this._wasClosing&&(a=$.app.getResumeHash()),!this._modified&&!this._soft_modified)return"function"==typeof b&&(b({},!1),b=null),this._saveRedirect(a,d),!0;$("input[type=submit],input[type=button]").prop("disabled",!0);var e=this;$.app.showOverlay();var f=this._onSave();return window.onbeforeunload=function(){},$.ajax({url:"index.php?k="+$.app.SESSION_KEY+"&view="+this._view+"&cmd=save&id="+this._id+f,type:"POST",data:this._saveBuildPost(),dataType:"json",success:function(f){return f||(f={}),f.data&&(f=f.data),$.app.hideOverlay(),$("input[type=submit],input[type=button]").prop("disabled",!1),f.validation_errors&&f.validation_errors.length?void $.each(f.validation_errors,function(a,b){$("#"+b.field).hintError(b.message)}):"error"==f.status?($.app.debug&&console.debug("Save failed with error : "+f.message),void("function"==typeof c?(c(f),c=null):$.app.showError($.app._("SAVE_ERROR_OCCURED")))):(e._modified=!1,e._afterSave(),"function"==typeof b&&(b(f,!0),b=null),void e._saveRedirect(a,d))},error:function(a,b,d){e._saveErrorHandler(a,b,d,c)}}),!0},_saveRedirect:function(a,b){b||(this._onClose(),"string"==typeof a?$.app.goTo(a):$.app.goBack())},_saveErrorHandler:function(a,b,c,d){return $.app.validateXHR(a)?($.app.debug&&console.debug("error..."),"function"==typeof d&&(d(!1),d=null),$.app.hideOverlay(),$("input[type=submit]").prop("disabled",!1),void $.app.showError($.app._("SAVE_ERROR_OCCURED"))):!1},_saveBuildPost:function(){return"&model="+encodeURIComponent($.toJSON(this.createModel()))},_canSave:function(){return $.app.debug&&$.app._throw("View does not implement _canSave function"),!0},_onCancelSave:function(){},_onSave:function(){return""},_afterSave:function(){},_onClose:function(){},createModel:function(){var a={};return $("form input[name],select[name],textarea[name]").each(function(b,c){var d=$(c).val();"radio"==c.type||"checkbox"==c.type?c.checked&&(a[c.name]="on"==d?"YES":d):a[c.name]=$(c).hasClass("money")?$(c).moneyVal():$(c).hasClass("percent")?$.app.parseFloat(d.replace("%","")):$(c).hasClass("number")?$.app.parseFloat(d):d}),this._onCreateModel&&(a=this._onCreateModel(a)),a=this._removeNullValue(a)},_onCreateModel:function(a){return a},alternateCreateModel:function(a){var b={},c=function(a){return a.replace("]","")},d=function(a,b){var c={};return c[b]=a,c};for(var e in a)if(a.hasOwnProperty(e)){var f=e.split("[").map(c),g=f.reduceRight(d,a[e]);$.extend(!0,b,g)}return b},_removeNullValue:function(a){if("object"==typeof a)for(var b in a)a[b]=this._removeNullValue(a[b]);else a||(a="");return a},cancel:function(a){this._modified=!1,$("input[type=submit],input[type=button]").prop("disabled",!1),$.app.goBack(a)},resume:function(){$.app.resume(!1)},stop:function(){$.app.resume(!0)}},EditView.inherits(View),$.app.lang="fr";
//# sourceMappingURL=application.min.map