!function(a){var b={onStart:function(b){var c="jUploadPG"+b.id,d=a('<span id="'+c+'" style="display:none"></span>');return a(b.uploader).empty().append(d),d.progressBar(b.config.progressBarConfig),d},onProgress:function(a){a.node.progressBar(a.percentage)},onEnd:function(b){b.node.progressBar(100).slideToggle("slow",function(){a(this).progressBar(0)})}};a.extend({ajaxUploader:new function(){this.defaults={uploadFileName:"upload_file",uploadButtonLabel:"Upload",dataType:"json",autoUpload:!1,progressBarConfig:{},validateFileName:function(){return!0},passedInput:!1,callbacks:b},this.construct=function(b){var c=b;return this.each(function(){function b(b,c){var d="jUploadFrame"+b;if(a.browser.msie&&a.browser.version<9){var e=document.createElement('<iframe id="'+d+'" name="'+d+'" />');"boolean"==typeof c?e.src="javascript:false":"string"==typeof c&&(e.src=c)}else{var e=document.createElement("iframe");e.id=d,e.name=d}return e.style.position="absolute",e.style.top="-1000px",e.style.left="-1000px",document.body.appendChild(e),e}function d(b,c){var d="jUploadForm"+b,e="jUploadFile"+b,f="jApcProgress"+b,g=a('<form  action="" method="POST" name="'+d+'" id="'+d+'" enctype="multipart/form-data"></form>');a('<input id="'+f+'" name="APC_UPLOAD_PROGRESS" value="'+b+'"></input>').appendTo(g);var h=a("#"+c),i=a(h).clone();return a(h).attr("id",e),a(h).before(i),a(h).appendTo(g),a(g).css("position","absolute"),a(g).css("top","-1200px"),a(g).css("left","-1200px"),a(g).appendTo("body"),g}function e(c){if(c=jQuery.extend({},jQuery.ajaxSettings,c),!c.validateFileName(a("#"+c.uploadFileName).val()))return!1;var e=(new Date).getTime()+""+Math.round(1e4*Math.random()),i=d(e,c.uploadFileName),j=(b(e,c.secureuri),"jUploadFrame"+e),k="jUploadForm"+e,l=h.callbacks.onStart({config:h,uploader:g,id:e});c.global&&!jQuery.active++&&jQuery.event.trigger("ajaxStart");var m=!1,n={};c.global&&jQuery.event.trigger("ajaxSend",[n,c]);var o=function(b){var d=document.getElementById(j);try{d.contentWindow?(n.responseText=d.contentWindow.document.body?d.contentWindow.document.body.innerHTML:null,n.responseXML=d.contentWindow.document.XMLDocument?d.contentWindow.document.XMLDocument:d.contentWindow.document):d.contentDocument&&(n.responseText=d.contentDocument.document.body?d.contentDocument.document.body.innerHTML:null,n.responseXML=d.contentDocument.document.XMLDocument?d.contentDocument.document.XMLDocument:d.contentDocument.document)}catch(e){a.ajaxUploader.catchError(e)}if(n||"timeout"==b){m=!0;var g;try{if(g="timeout"!=b?"success":"error","error"!=g){var k=f(n,c.dataType);a.ajaxUploader.stopMonitorAjaxUpload(),h.callbacks.onEnd({node:l}),c.success&&c.success(k,g),c.global&&jQuery.event.trigger("ajaxSuccess",[n,c])}else a.ajaxUploader.catchError(e)}catch(e){a.ajaxUploader.stopMonitorAjaxUpload(),l.hide().progressBar(0),g="error",a.ajaxUploader.catchError(e)}c.global&&jQuery.event.trigger("ajaxComplete",[n,c]),c.global&&!--jQuery.active&&jQuery.event.trigger("ajaxStop"),c.complete&&c.complete(n,g),jQuery(d).unbind(),setTimeout(function(){try{a(d).remove(),a(i).remove()}catch(b){a.ajaxUploader.catchError(b)}},100),n=null}};c.timeout>0&&setTimeout(function(){m||o("timeout")},c.timeout),l.show(),a.ajaxUploader.monitorAjaxUpload(e,l,h);try{var i=a("#"+k);a(i).attr("action",c.url),a(i).attr("method","POST"),a(i).attr("target",j),i.encoding?i.encoding="multipart/form-data":i.enctype="multipart/form-data",a(i).submit()}catch(p){a.ajaxUploader.catchError(p)}return window.attachEvent?document.getElementById(j).attachEvent("onload",o):document.getElementById(j).addEventListener("load",o,!1),{abort:function(){}}}function f(a,b){var c=!b;return c="xml"==b||c?a.responseXML:a.responseText,"script"==b&&jQuery.globalEval(c),"json"==b&&(c=jQuery.secureEvalJSON(c)),"html"==b&&jQuery("<div>").html(c).evalScripts(),c}var g=this,h={};if(null!=g.config?null!=c&&(g.config=a.extend(!0,g.config,c)):h=a.extend(!0,{},a.ajaxUploader.defaults,c),h.passedInput)h.uploadFileName=h.passedInput.attr("id"),h.passedInput.change(function(){e(h)});else{var i=h.uploadFileName+"_button",j='<input id="'+h.uploadFileName+'" name="'+h.uploadFileName+'" type="file" size="45" class="input">';h.autoUpload||(j+='<a id="'+i+'" href="javascript:void(0);">'+h.uploadButtonLabel+"</a>"),a(g).html(j),h.autoUpload?a("#"+h.uploadFileName).change(function(){e(h)}):a("#"+i).click(function(){e(h)})}})},this.monitorAjaxUpload=function(b,c,d){var e=this;a.get("index.php?k="+a.app.SESSION_KEY+"&apcStat&apcUID="+b,function(b){if(b){var f=a.secureEvalJSON(b);if(f){var g=Math.floor(100*parseInt(f.current)/parseInt(f.total));d.callbacks.onProgress({percentage:g,node:c}),f.done&&e.stopMonitorAjaxUpload()}}}),e.lastAjaxMonitorTimeout=setTimeout(function(){a.ajaxUploader.monitorAjaxUpload(b,c,d)},500)},this.stopMonitorAjaxUpload=function(){var a=this;a.lastAjaxMonitorTimeout&&(clearTimeout(a.lastAjaxMonitorTimeout),a.lastAjaxMonitorTimeout=!1)},this.catchError=function(a){console.debug(a.message+" || stack : "+a.stack)}}}),a.fn.extend({ajaxUploader:a.ajaxUploader.construct})}(jQuery);
//# sourceMappingURL=jquery.ajaxUploader.min.map