!function(a){var b={init:function(b){var c=0;return this.each(function(){var d=a(this),e={};if(a.extend(!0,e,a.fn.list.defaults,b),e.ignoreLocaleEvent||(d.addClass("localeBound"),d.bind("setLocaleEvent",function(){a.app.debug&&console.log("Locale event triggered element : ",this),d.find(".pagination .prev").text(a.app._("PREVIOUS")),d.find(".pagination .next").text(a.app._("NEXT"))})),0!==c&&(e.name+="."+c),c++,!e.name)throw"jQuery.list requires a name to be specified";if(!a.isArray(e.headers))throw"jQuery.list requires headers to be specified, must be an array";if(e.headers.length<1)throw"jQuery.list headers must contain at least one item, header can be a string or an object { field : string, label : string, sortable : boolean (default : false), escape : boolean (default : true), format : forgetrmatting function }";if(!a.isFunction(e.source))throw"jQuery.list requires a source callback";if(e.group&&!a.isPlainObject(e.group))throw'jQuery.list group option must be an object { field : "field_name", groupClass : "css-class", reset : boolean}';e.selector=d,0===e.nbPages&&(e.nbPages=1),e.page>=e.nbPages&&(e.page=e.nbPages-1),e.pagingOptions.pages.current_page=e.page,e.pagingOptions.pages.items_per_page=0,e.pagingOptions.pages.link_to="javascript:void(0);",e.pagingOptions.pages.callback||(e.pagingOptions.pages.callback=function(a){e.setPage(a,e.nbPages)},e.pagingOptions.pages.callback(0,!1));var f=a.app.getContextValue("list."+e.name);if(a.isPlainObject(f)){e.page=f.page,e.pagingOptions.pages.current_page=f.page,e.sort=f.sort,e.asc=f.asc;for(var g in f)g.substr(0,e.subContextPrefix.length+1)==e.subContextPrefix+"."&&(e.subContext[g.substr(e.subContextPrefix.length+1)]=f[g])}e.buildTable(d),e.pagination&&"undefined"!=typeof e.updatePagination[e.pagination]&&(e.updatePagination[e.pagination].call(e),d.trigger("setLocaleEvent")),e.draw(),d.data("list",e)})},options:function(){var b=arguments;if(0===arguments.length||1==arguments.length&&"string"==typeof arguments[0]){var c=[];return this.each(function(){var d=a(this).data("list");d&&c.push({selector:this,options:d.getOptions.apply(d,b)})}),1==c.length?c[0].options:c}return this.each(function(){var c=a(this).data("list");c&&c.setOptions.apply(c,b)})},update:function(b,c){return this.each(function(){var d=a(this).data("list");d&&d.update[b].call(d,c)})},fetch:function(){return this.each(function(){var b=a(this).data("list");b&&b.fetchData()})},data:function(b){if(0===arguments.length){var c=[];return this.each(function(){var b=a(this).data("list");b&&c.push({selector:this,data:b.data})}),1==c.length?c[0].data:c}return this.each(function(){var c=a(this).data("list");c&&c.setData(b)})},sort:function(b,c,d){if(0===arguments.length){var e=[];return this.each(function(){var b=a(this).data("list");b&&e.push({selector:this,sort:{field:b.sort,asc:b.asc}})}),1==e.length?e[0].sort:e}return this.each(function(){var e=a(this).data("list");e&&e.sortHeader(b,c,d)})},page:function(b,c){if(0===arguments.length){var d=[];return this.each(function(){var b=a(this).data("list");b&&d.push({selector:this,page:{page:b.page,nbPages:b.nbPages}})}),1==d.length?d[0].page:d}return this.each(function(){var d=a(this).data("list");d&&d.setPage(b,d.nbPages,c)})},setContextValue:function(b,c,d){return this.each(function(){var e=a(this).data("list");e&&e.setContextValue(b,c,d)})},getContextValue:function(b){var c=[];return this.each(function(){var d=a(this).data("list");d&&c.push({selector:this,context:d.getContextValue(b)})}),1==c.length?c[0].context:c},updateOddClasses:function(){return this.each(function(){var b=a(this),c=b.data("list"),d=b.find("tbody tr");c.data&&a.isArray(c.data)&&0!==c.data.length&&(c.group&&c.group.groupClass&&(d=d.not("."+c.group.groupClass)),d.each(function(b){var d=a(this);c.oddClass&&d.removeClass(c.oddClass),c.evenClass&&d.removeClass(c.evenClass),b%2!==0&&c.oddClass?d.addClass(c.oddClass):b%2===0&&c.evenClass&&d.addClass(c.evenClass)}))})}};a.fn.list=function(c){if(!a.app)throw"jQuery.list cannot be used outside kronos-libs framework";return b[c]?b[c].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof c&&c?void a.error("Method "+c+" does not exist on jQuery.list"):b.init.apply(this,arguments)},a.fn.list.defaults={headerClass:"",evenClass:"",oddClass:"",tableClass:"",data:!1,group:!1,pagination:!1,pagingOptions:{pages:{callback:!1,current_page:0,num_pages:0,items_per_page:1,link_to:"javascript:void(0);",num_display_entries:11,next_text:function(){return a.app._("NEXT")},next_show_always:!0,prev_text:function(){return a.app._("PREVIOUS")},prev_show_always:!0,num_edge_entries:1,ellipse_text:"...",autoHidePagination:!1},more:{text:a.app._("SHOW_MORE"),click:null}},page:0,nbPages:1,hasMore:!1,sort:!1,asc:!0,sortSafeClick:!0,subContext:{},subContextPrefix:"sub",ignoreLocaleEvent:!1,buildTable:function(){var b,c="<table"+(this.tableClass?' class="'+this.tableClass+'"':"")+">";for(c+="<thead><tr>",b=0;b<this.headers.length;b++)c+='<th id="'+this.name+"_header_"+b+'" />';c+='</tr></thead><tbody></tbody></table><div id = "'+this.name+'_pagination" class="pagination-wrapper"></div>',this.selector.html(c),this.tableClass&&this.selector.find("table").addClass(this.tableClass),this.headerClass&&this.selector.find("thead tr").addClass(this.headerClass);var d=function(){e.setPage(0,e.nbPages,!1),e.sortHeader(a(this).data("sortField"))},e=this;for(b=0;b<this.headers.length;b++)if(a.isPlainObject(this.headers[b])&&this.headers[b].sortable){this.headers[b].sortField||(this.headers[b].sortField=this.headers[b].name);var f=a("#"+this.name+"_header_"+b);f.data("sortField",this.headers[b].sortField),f.addClass("sortable"),this.sortSafeClick?f.safeClick(d):f.click(d)}this.updateHeader()},updateHeader:function(){for(var b,c=0;c<this.headers.length;c++)if(b=a("#"+this.name+"_header_"+c),a.isPlainObject(this.headers[c])){var d=this.headers[c].label;if(this.headers[c].sortable===!0){var e=d.lastIndexOf(" "),f=d.substring(0,e),g='<span class="nowrap">'+d.substring(e)+'<span class="sort-arrow"></span></span>';d=f+g}this.sort==this.headers[c].sortField?(b.addClass("sorted"),this.asc?b.addClass("asc"):b.removeClass("asc")):b.hasClass("sorted")&&b.removeClass("sorted"),this.headers[c].headerClasses&&b.addClass(this.headers[c].headerClasses),this.headers[c].nbsp&&(d=d.replace(" ","&nbsp;")),b.html(d)}else b.text(a.app.htmlEntity(this.headers[c]))},sortHeader:function(a,b,c){for(var d=0;d<this.headers.length;d++)if(this.headers[d].sortField==a)return this.asc="undefined"==typeof b?this.sort==this.headers[d].sortField?!this.asc:!0:b,this.sort=a,this.updateContext(),this.updateHeader(),(c||"undefined"==typeof c)&&this.fetchData(),!1;this.asc="undefined"==typeof b?this.sort==a?!this.asc:!0:b,this.sort=a,this.updateHeader(),(c||"undefined"==typeof c)&&this.fetchData()},fetchData:function(){0===this.page&&"more"==this.pagination&&this.clear(),this.source(this,this.page,this.sort,this.asc,this.subContext)},setData:function(a){this.data=a,this.draw()},draw:function(b){if(b||this.clear(),this.data&&a.isArray(this.data)&&0!==this.data.length)for(var c=this,d=null,e=!1,f=this.selector.find("tbody"),g=f.find("tr").length,h=function(b){var d=a(this);c.click(d.data("index"),d.data("record"),b)},i=0;i<this.data.length;i++){var j=g+i;if(this.group&&a.isPlainObject(this.group)){var k;k=this.group.dotSeperatedKey===!0?a.app.getByKey(this.data[i],this.group.field):this.data[i][this.group.field],k!=d&&(f.append(this.drawGroup(k,this.data[i],this.group.field)),d=k,(this.group.reset||"undefined"==typeof this.group.reset)&&(e=!1))}f.append(this.drawRow(this.data[i],j,e)),this.attachRowClick(i),e=!e,a.isFunction(this.click)&&a("#"+this.name+"_row_"+j).data("index",j).data("record",this.data[i]).safeClick(h)}else this.selector.find("tbody").append(this.noData())},clear:function(){this.selector.find("tbody tr").remove()},drawGroup:function(b,c,d){var e=this.group.format?this.group.format(b,c,d):b;this.group.escape!==!1&&(e=e.htmlEntity());var f=a("<td></td>",{colspan:a.app.parseInt(this.headers.length)}).html(e),g=a("<tr></tr>",{"class":a.app.htmlEntity(this.group.groupClass)}).append(f);return g},drawRow:function(b,c,d){var e=a("<tr></tr>").attr("id",this.name+"_row_"+c);this.rowClass&&e.addClass(a.app.htmlEntity(this.rowClass)),d&&this.oddClass?e.addClass(a.app.htmlEntity(this.oddClass)):!d&&this.evenClass&&e.addClass(a.app.htmlEntity(this.evenClass));for(var f=0;f<this.headers.length;f++)if(a.isPlainObject(b)&&a.isPlainObject(this.headers[f])){var g;g=this.headers[f].dotSeperatedKey===!0?a.app.getByKey(b,this.headers[f].name):b[this.headers[f].name];var h;h=this.headers[f].format&&a.isFunction(this.headers[f].format)?this.headers[f].format(g,b,this,c):g;var i=a("<td></td>").attr("id",this.name+"_row_"+c+"_"+f).data("index",c).data("i",f);this.headers[f].cellClasses&&i.addClass(this.headers[f].cellClasses),this.headers[f].escape!==!1?i.html(a.app.htmlEntity(h)):"string"==typeof h?i.html(h):i.append(h),this.headers[f].hook&&a.isFunction(this.headers[f].hook)&&this.headers[f].hook(i,g,b),e.append(i)}else e.append(a("<td></td>"));return e},attachRowClick:function(b){for(var c=function(b){var c=a(this).data("list_click");c&&a.isFunction(c.click)&&c.click.call(this,c.value,c.record,b)},d=0;d<this.headers.length;d++)if(a.isFunction(this.headers[d].click)){var e;e=a.isPlainObject(this.headers[d])?this.data[b][this.headers[d].name]:this.data[b][d];{a("#"+this.name+"_row_"+b+"_"+d).data("list_click",{click:this.headers[d].click,value:e,record:this.data[b]}).safeClick(c)}}},noData:function(){return'<tr class="non-clickable-row'+(this.evenClass?" "+a.app.htmlEntity(this.evenClass):"")+'"><td colspan='+this.headers.length+'">'+a.app._("NO_RESULTS")+"</td></tr>"},click:function(){a.app.debug&&(console.debug("you can specify a click option to handle row clicks. Default : click(row, record) { }"),console.debug(arguments))},updatePagination:{pages:function(){a.isFunction(this.pagingOptions.pages.next_text)&&(this.pagingOptions.pages.next_text=this.pagingOptions.pages.next_text.call(this)),a.isFunction(this.pagingOptions.pages.prev_text)&&(this.pagingOptions.pages.prev_text=this.pagingOptions.pages.prev_text.call(this)),this.nbPages!=this.pagingOptions.pages.num_pages?(this.pagingOptions.pages.current_page=this.page,this.pagingOptions.pages.num_pages=this.nbPages,1==this.nbPages&&this.pagingOptions.pages.autoHidePagination?a("#"+this.name+"_pagination").empty():a("#"+this.name+"_pagination").pagination(this.nbPages,this.pagingOptions.pages)):this.page!=a("#"+this.name+"_pagination").data("current_page")&&a("#"+this.name+"_pagination").trigger("setPage",[this.page])},more:function(){var b=a("#"+this.name+"_pagination").empty().show();if(this.hasMore){var c=a('<a href="javascript:void(0);">'+a.app._("SHOW_MORE")+"</a>"),d=this;c.one("click",function(){d.page++,d.fetchData()}),b.addClass("show-more"),b.append(c)}else b.hide()}},setPage:function(a,b,c){return this.page==a&&this.nbPages==b?!1:(this.page=a,"undefined"!=typeof b&&(this.nbPages=b),this.nbPages<1&&(this.nbPages=1),this.page>=this.nbPages&&(this.page=this.nbPages-1),this.updateContext(),this.pagination&&this.updatePagination.pages.call(this),void((c||"undefined"==typeof c)&&this.fetchData()))},update:function(a,b){var c,d;if("pages"==a){d=["page","nbPages","sort","asc","data"];for(c in d)if("undefined"==typeof d[c])throw new c+" is a required param for update.more (jQuery.list)";this.setPage(b.page,b.nbPages,!1),this.sortHeader(b.sort,b.asc,!1),this.setData(b.data)}else if("more"==a){d=["page","hasMore","sort","asc","data"];for(c in d)if("undefined"==typeof d[c])throw new c+" is a required param for update.pages (jQuery.list)";this.page=b.page,this.sortHeader(b.sort,b.asc,!1),this.data=b.data,this.hasMore=b.hasMore,this.updateContext(),this.updatePagination.more.call(this),this.draw(!0)}},setContextValue:function(a,b,c){this.subContext[a]=b,this.updateContext(),(c||"undefined"==typeof c)&&this.fetchData()},getContextValue:function(a){return this.subContext[a]},getContext:function(){var b={page:this.page,sort:this.sort,asc:this.asc};"pages"==this.paging?a.extend(b,this._extraContextPages()):"more"==this.paging&&a.extend(b,this._extraContextMore());for(var c in this.subContext)b[this.subContextPrefix+"."+c]=this.subContext[c];return b},_extraContextPages:function(){return{nbPages:this.nbPages}},_extaContextMore:function(){return{hasMore:this.hasMore}},setOptions:function(){var b;if(1==arguments.length){if(!a.isPlainObject(arguments[0]))throw"jQuery.list internal setOptions need an object if only one argument is given";b=arguments[0]}else{if(2!=arguments.length)throw"jQuery.list internal setOptions support only plain object or key/value arguments";b={},b[arguments[0]]=arguments[1]}var c=!1,d=!1,e=!1,f=!1,g=!1;for(var h in b)this[h]=b[h],"headers"==h?c=!0:"sort"==h?e=!0:"asc"==h?e=!0:"page"==h?d=!0:"nbPages"==h?d=!0:"data"==h?f=!0:"hasMore"==h&&(g=!0);this.updateContext(),c&&this.buildTable(),d&&"pages"==this.pagination&&this.updatePagination.pages.call(this),g&&this.updatePagination.more.call(this),e&&this.updateHeader(),f&&this.draw()},updateContext:function(){a.app.setContextValue("list."+this.name,this.getContext())}}}(jQuery);
//# sourceMappingURL=list.min.map